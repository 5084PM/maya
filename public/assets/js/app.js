!function(){"use strict";const s=Symbol("render"),r=Symbol("isolatedView"),i=Symbol(),n=Symbol(),o=Symbol(),a=Symbol(),c=Symbol(),l=Symbol(),u=Symbol(),d=Symbol(),p=Symbol(),f=Symbol(),g=Symbol(),m=Symbol(),v=Symbol("mounted"),y=Symbol.for("init"),w=Symbol("component"),b=Symbol.for("attrs"),x=Symbol.for("attributes"),E=Symbol.for("tmpl"),k=Symbol.for("options"),S=Symbol.for("site"),O=Symbol.for("error"),T=Symbol();var C=Array.isArray,N=Object.prototype.toString,M=C||function(t){return"[object Array]"===N.call(t)},A="2";P.NONE=0,P.VTEXT=1,P.VNODE=2,P.WIDGET=3,P.PROPS=4,P.ORDER=5,P.INSERT=6,P.REMOVE=7,P.THUNK=8;var j=P;function P(t,e,s){this.type=Number(t),this.vNode=e,this.patch=s}P.prototype.version=A,P.prototype.type="VirtualPatch";var R=function(t){return t&&"VirtualNode"===t.type&&t.version===A},$=function(t){return t&&"VirtualText"===t.type&&t.version===A},I=function(t){return t&&"Widget"===t.type},D=function(t){return t&&"Thunk"===t.type},z=function(t,e){var s=t,r=e;return D(e)&&(r=F(e,t)),D(t)&&(s=F(t,null)),{a:s,b:r}};function F(t,e){var s=t.vnode;if(s||(s=t.vnode=t.render(e)),!(R(s)||$(s)||I(s)))throw new Error("thunk did not return a valid node");return s}var q=function(t){return"object"==typeof t&&null!==t},W=function(t){return t&&("function"==typeof t.hook&&!t.hasOwnProperty("hook")||"function"==typeof t.unhook&&!t.hasOwnProperty("unhook"))},V=function t(e,s){var r;for(var i in e){i in s||((r=r||{})[i]=void 0);var n=e[i],o=s[i];if(n!==o)if(q(n)&&q(o))if(U(o)!==U(n))(r=r||{})[i]=o;else if(W(o))(r=r||{})[i]=o;else{var a=t(n,o);a&&((r=r||{})[i]=a)}else(r=r||{})[i]=o}for(var h in s)h in e||((r=r||{})[h]=s[h]);return r};function U(t){return Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__?t.__proto__:t.constructor?t.constructor.prototype:void 0}function H(t,e){var s={a:t};return B(t,e,s,0),s}function B(t,e,s,r){if(t!==e){var i=s[r],n=!1;if(D(t)||D(e))Y(t,e,s,r);else if(null==e)I(t)||(X(t,s,r),i=s[r]),i=Z(i,new j(j.REMOVE,t,e));else if(R(e))if(R(t))if(t.tagName===e.tagName&&t.namespace===e.namespace&&t.key===e.key){var o=V(t.properties,e.properties);o&&(i=Z(i,new j(j.PROPS,t,o))),i=function(t,e,s,r,i){for(var n=t.children,o=function(t,e){var s=Q(e),r=s.keys,i=s.free;if(i.length===e.length)return{children:e,moves:null};var n=Q(t),o=n.keys;if(n.free.length===t.length)return{children:e,moves:null};for(var a=[],h=0,c=i.length,l=0,u=0;u<t.length;u++){var d,p=t[u];p.key?r.hasOwnProperty(p.key)?(d=r[p.key],a.push(e[d])):(d=u-l++,a.push(null)):h<c?(d=i[h++],a.push(e[d])):(d=u-l++,a.push(null))}for(var f=h>=i.length?e.length:i[h],g=0;g<e.length;g++){var m=e[g];m.key?o.hasOwnProperty(m.key)||a.push(m):g>=f&&a.push(m)}for(var v,y=a.slice(),w=0,b=[],x=[],E=0;E<e.length;){var _=e[E];for(v=y[w];null===v&&y.length;)b.push(K(y,w,null)),v=y[w];v&&v.key===_.key?(w++,E++):_.key?(v&&v.key&&r[v.key]!==E+1?(b.push(K(y,w,v.key)),(v=y[w])&&v.key===_.key?w++:x.push({key:_.key,to:E})):x.push({key:_.key,to:E}),E++):v&&v.key&&b.push(K(y,w,v.key))}for(;w<y.length;)v=y[w],b.push(K(y,w,v&&v.key));return b.length!==l||x.length?{children:a,moves:{removes:b,inserts:x}}:{children:a,moves:null}}(n,e.children),a=o.children,h=n.length,c=a.length,l=h>c?h:c,u=0;u<l;u++){var d=n[u],p=a[u];i+=1,d?B(d,p,s,i):p&&(r=Z(r,new j(j.INSERT,null,p))),R(d)&&d.count&&(i+=d.count)}return o.moves&&(r=Z(r,new j(j.ORDER,t,o.moves))),r}(t,e,s,i,r)}else i=Z(i,new j(j.VNODE,t,e)),n=!0;else i=Z(i,new j(j.VNODE,t,e)),n=!0;else $(e)?$(t)?t.text!==e.text&&(i=Z(i,new j(j.VTEXT,t,e))):(i=Z(i,new j(j.VTEXT,t,e)),n=!0):I(e)&&(I(t)||(n=!0),i=Z(i,new j(j.WIDGET,t,e)));i&&(s[r]=i),n&&X(t,s,r)}}function X(t,e,s){J(t,e,s),G(t,e,s)}function G(t,e,s){if(I(t))"function"==typeof t.destroy&&(e[s]=Z(e[s],new j(j.REMOVE,t,null)));else if(R(t)&&(t.hasWidgets||t.hasThunks))for(var r=t.children,i=r.length,n=0;n<i;n++){var o=r[n];G(o,e,s+=1),R(o)&&o.count&&(s+=o.count)}else D(t)&&Y(t,null,e,s)}function Y(t,e,s,r){var i=z(t,e),n=H(i.a,i.b);(function(t){for(var e in t)if("a"!==e)return!0;return!1})(n)&&(s[r]=new j(j.THUNK,null,n))}function J(t,e,s){if(R(t)){if(t.hooks&&(e[s]=Z(e[s],new j(j.PROPS,t,function(t){var e={};for(var s in t)e[s]=void 0;return e}(t.hooks)))),t.descendantHooks||t.hasThunks)for(var r=t.children,i=r.length,n=0;n<i;n++){var o=r[n];J(o,e,s+=1),R(o)&&o.count&&(s+=o.count)}}else D(t)&&Y(t,null,e,s)}function K(t,e,s){return t.splice(e,1),{from:e,key:s}}function Q(t){for(var e={},s=[],r=t.length,i=0;i<r;i++){var n=t[i];n.key?e[n.key]=i:s.push(i)}return{keys:e,free:s}}function Z(t,e){return t?(M(t)?t.push(e):t=[t,e],t):e}var tt=H,et="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},st=Array.prototype.slice,rt=function(t,e){"length"in t||(t=[t]),t=st.call(t);for(;t.length;){var s=t.shift(),r=e(s);if(r)return r;s.childNodes&&s.childNodes.length&&(t=st.call(s.childNodes).concat(t))}},it=nt;function nt(t,e){if(!(this instanceof nt))return new nt(t,e);this.data=t,this.nodeValue=t,this.length=t.length,this.ownerDocument=e||null}nt.prototype.nodeType=8,nt.prototype.nodeName="#comment",nt.prototype.toString=function(){return"[object Comment]"};var ot=at;function at(t,e){if(!(this instanceof at))return new at(t);this.data=t||"",this.length=this.data.length,this.ownerDocument=e||null}at.prototype.type="DOMTextNode",at.prototype.nodeType=3,at.prototype.nodeName="#text",at.prototype.toString=function(){return this.data},at.prototype.replaceData=function(t,e,s){var r=this.data,i=r.substring(0,t),n=r.substring(t+e,r.length);this.data=i+s+n,this.length=this.data.length};var ht=function(t){var e=this,s=t.type;t.target||(t.target=e),e.listeners||(e.listeners={});var r=e.listeners[s];if(r)return r.forEach(function(s){t.currentTarget=e,"function"==typeof s?s(t):s.handleEvent(t)});e.parentNode&&e.parentNode.dispatchEvent(t)},ct=function(t,e){var s=this;s.listeners||(s.listeners={}),s.listeners[t]||(s.listeners[t]=[]),-1===s.listeners[t].indexOf(e)&&s.listeners[t].push(e)},lt=function(t,e){var s=this;if(s.listeners&&s.listeners[t]){var r=s.listeners[t],i=r.indexOf(e);-1!==i&&r.splice(i,1)}},ut=function t(e){switch(e.nodeType){case 3:return gt(e.data);case 8:return"\x3c!--"+e.data+"--\x3e";default:return function(e){var s=[],r=e.tagName;return"http://www.w3.org/1999/xhtml"===e.namespaceURI&&(r=r.toLowerCase()),s.push("<"+r+function(t){var e=[];for(var s in t)pt(t,s)&&e.push({name:s,value:t[s]});for(var r in t._attributes)for(var i in t._attributes[r]){var n=t._attributes[r][i],o=(n.prefix?n.prefix+":":"")+i;e.push({name:o,value:n.value})}return t.className&&e.push({name:"class",value:t.className}),e.length?ft(e):""}(e)+function(t){var e=t.dataset,s=[];for(var r in e)s.push({name:"data-"+r,value:e[r]});return s.length?ft(s):""}(e)),dt.indexOf(r)>-1?s.push(" />"):(s.push(">"),e.childNodes.length?s.push.apply(s,e.childNodes.map(t)):e.textContent||e.innerText?s.push(gt(e.textContent||e.innerText)):e.innerHTML&&s.push(e.innerHTML),s.push("</"+r+">")),s.join("")}(e)}},dt=["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"];function pt(t,e){var s=typeof t[e];return"style"===e&&Object.keys(t.style).length>0||t.hasOwnProperty(e)&&("string"===s||"boolean"===s||"number"===s)&&"nodeName"!==e&&"className"!==e&&"tagName"!==e&&"textContent"!==e&&"innerText"!==e&&"namespaceURI"!==e&&"innerHTML"!==e}function ft(t){var e=[];return t.forEach(function(t){var s=t.name,r=t.value;"style"===s&&(r=function(t){if("string"==typeof t)return t;var e="";return Object.keys(t).forEach(function(s){var r=t[s];s=s.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()}),e+=s+":"+r+";"}),e}(r)),e.push(s+'="'+gt(r).replace(/"/g,"&quot;")+'"')}),e.length?" "+e.join(" "):""}function gt(t){var e="";return"string"==typeof t?e=t:t&&(e=t.toString()),e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var mt="http://www.w3.org/1999/xhtml",vt=yt;function yt(t,e,s){if(!(this instanceof yt))return new yt(t);var r=void 0===s?mt:s||null;this.tagName=r===mt?String(t).toUpperCase():t,this.nodeName=this.tagName,this.className="",this.dataset={},this.childNodes=[],this.parentNode=null,this.style={},this.ownerDocument=e||null,this.namespaceURI=r,this._attributes={},"INPUT"===this.tagName&&(this.type="text")}yt.prototype.type="DOMElement",yt.prototype.nodeType=1,yt.prototype.appendChild=function(t){return t.parentNode&&t.parentNode.removeChild(t),this.childNodes.push(t),t.parentNode=this,t},yt.prototype.replaceChild=function(t,e){t.parentNode&&t.parentNode.removeChild(t);var s=this.childNodes.indexOf(e);return e.parentNode=null,this.childNodes[s]=t,t.parentNode=this,e},yt.prototype.removeChild=function(t){var e=this.childNodes.indexOf(t);return this.childNodes.splice(e,1),t.parentNode=null,t},yt.prototype.insertBefore=function(t,e){t.parentNode&&t.parentNode.removeChild(t);var s=null==e?-1:this.childNodes.indexOf(e);return s>-1?this.childNodes.splice(s,0,t):this.childNodes.push(t),t.parentNode=this,t},yt.prototype.setAttributeNS=function(t,e,s){var r=null,i=e,n=e.indexOf(":");n>-1&&(r=e.substr(0,n),i=e.substr(n+1)),"INPUT"===this.tagName&&"type"===e?this.type=s:(this._attributes[t]||(this._attributes[t]={}))[i]={value:s,prefix:r}},yt.prototype.getAttributeNS=function(t,e){var s=this._attributes[t],r=s&&s[e]&&s[e].value;return"INPUT"===this.tagName&&"type"===e?this.type:"string"!=typeof r?null:r},yt.prototype.removeAttributeNS=function(t,e){var s=this._attributes[t];s&&delete s[e]},yt.prototype.hasAttributeNS=function(t,e){var s=this._attributes[t];return!!s&&e in s},yt.prototype.setAttribute=function(t,e){return this.setAttributeNS(null,t,e)},yt.prototype.getAttribute=function(t){return this.getAttributeNS(null,t)},yt.prototype.removeAttribute=function(t){return this.removeAttributeNS(null,t)},yt.prototype.hasAttribute=function(t){return this.hasAttributeNS(null,t)},yt.prototype.removeEventListener=lt,yt.prototype.addEventListener=ct,yt.prototype.dispatchEvent=ht,yt.prototype.focus=function(){},yt.prototype.toString=function(){return ut(this)},yt.prototype.getElementsByClassName=function(t){var e=t.split(" "),s=[];return rt(this,function(t){if(1===t.nodeType){var r=(t.className||"").split(" ");e.every(function(t){return-1!==r.indexOf(t)})&&s.push(t)}}),s},yt.prototype.getElementsByTagName=function(t){t=t.toLowerCase();var e=[];return rt(this.childNodes,function(s){1!==s.nodeType||"*"!==t&&s.tagName.toLowerCase()!==t||e.push(s)}),e},yt.prototype.contains=function(t){return rt(this,function(e){return t===e})||!1};var wt=bt;function bt(t){if(!(this instanceof bt))return new bt;this.childNodes=[],this.parentNode=null,this.ownerDocument=t||null}bt.prototype.type="DocumentFragment",bt.prototype.nodeType=11,bt.prototype.nodeName="#document-fragment",bt.prototype.appendChild=vt.prototype.appendChild,bt.prototype.replaceChild=vt.prototype.replaceChild,bt.prototype.removeChild=vt.prototype.removeChild,bt.prototype.toString=function(){return this.childNodes.map(function(t){return String(t)}).join("")};var xt=Et;function Et(t){}Et.prototype.initEvent=function(t,e,s){this.type=t,this.bubbles=e,this.cancelable=s},Et.prototype.preventDefault=function(){};var _t=kt;function kt(){if(!(this instanceof kt))return new kt;this.head=this.createElement("head"),this.body=this.createElement("body"),this.documentElement=this.createElement("html"),this.documentElement.appendChild(this.head),this.documentElement.appendChild(this.body),this.childNodes=[this.documentElement],this.nodeType=9}var St=kt.prototype;St.createTextNode=function(t){return new ot(t,this)},St.createElementNS=function(t,e){var s=null===t?null:String(t);return new vt(e,this,s)},St.createElement=function(t){return new vt(t,this)},St.createDocumentFragment=function(){return new wt(this)},St.createEvent=function(t){return new xt(t)},St.createComment=function(t){return new it(t,this)},St.getElementById=function(t){return t=String(t),rt(this.childNodes,function(e){if(String(e.id)===t)return e})||null},St.getElementsByClassName=vt.prototype.getElementsByClassName,St.getElementsByTagName=vt.prototype.getElementsByTagName,St.contains=vt.prototype.contains,St.removeEventListener=lt,St.addEventListener=ct,St.dispatchEvent=ht;var Ot,Tt=new _t,Ct=void 0!==et?et:"undefined"!=typeof window?window:{};"undefined"!=typeof document?Ot=document:(Ot=Ct["__GLOBAL_DOCUMENT_CACHE@4"])||(Ot=Ct["__GLOBAL_DOCUMENT_CACHE@4"]=Tt);var Nt=Ot,Mt=function(t,e,s){for(var r in e){var i=e[r];void 0===i?At(t,r,i,s):W(i)?(At(t,r,i,s),i.hook&&i.hook(t,r,s?s[r]:void 0)):q(i)?jt(t,0,s,r,i):t[r]=i}};function At(t,e,s,r){if(r){var i=r[e];if(W(i))i.unhook&&i.unhook(t,e,s);else if("attributes"===e)for(var n in i)t.removeAttribute(n);else if("style"===e)for(var o in i)t.style[o]="";else t[e]="string"==typeof i?"":null}}function jt(t,e,s,r,i){var n=s?s[r]:void 0;if("attributes"!==r)if(n&&q(n)&&Pt(n)!==Pt(i))t[r]=i;else{q(t[r])||(t[r]={});var o="style"===r?"":void 0;for(let e in i)c(e,i[e],t[r])}else for(var a in i){var h=i[a];void 0===h?t.removeAttribute(a):t.setAttribute(a,h)}function c(t,e,s){if((r=e)&&r.constructor===Object){if(!q(s[t]))return void(s[t]=e);for(let r in e)c(r,e[r],s[t])}else s[t]=void 0===e?o:e;var r}}function Pt(t){return Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__?t.__proto__:t.constructor?t.constructor.prototype:void 0}var Lt=function t(e,s){var r=s&&s.document||Nt,i=s?s.warn:null;if(e=z(e).a,I(e))return e.init();if($(e))return r.createTextNode(e.text);if(!R(e))return i&&i("Item is not a valid virtual dom node",e),null;var n=null===e.namespace?r.createElement(e.tagName):r.createElementNS(e.namespace,e.tagName),o=e.properties;Mt(n,o);for(var a=e.children,h=0;h<a.length;h++){var c=t(a[h],s);c&&n.appendChild(c)}return n},Rt={},$t=function(t,e,s,r){return s&&0!==s.length?(s.sort(zt),It(t,e,s,r,0)):{}};function It(t,e,s,r,i){if(r=r||{},t){Dt(s,i,i)&&(r[i]=t);var n=e.children;if(n)for(var o=t.childNodes,a=0;a<e.children.length;a++){i+=1;var h=n[a]||Rt,c=i+(h.count||0);Dt(s,i,c)&&It(o[a],h,s,r,i),i=c}}return r}function Dt(t,e,s){if(0===t.length)return!1;for(var r,i,n=0,o=t.length-1;n<=o;){if(i=t[r=(o+n)/2|0],n===o)return i>=e&&i<=s;if(i<e)n=r+1;else{if(!(i>s))return!0;o=r-1}}return!1}function zt(t,e){return t>e?1:-1}var Ft=function(t,e,s){var r,i,n=t.type,o=t.vNode,a=t.patch;switch(n){case j.REMOVE:return function(t,e){var s=t.parentNode;return s&&s.removeChild(t),qt(t,e),null}(e,o);case j.INSERT:return function(t,e,s){var r=s.render(e,s);return t&&t.appendChild(r),t}(e,a,s);case j.VTEXT:return function(t,e,s,r){var i;if(3===t.nodeType)t.replaceData(0,t.length,s.text),i=t;else{var n=t.parentNode;i=r.render(s,r),n&&i!==t&&n.replaceChild(i,t)}return i}(e,0,a,s);case j.WIDGET:return function(t,e,s,r){var i,n,o,a=(o=s,!(!I(n=e)||!I(o))&&("name"in n&&"name"in o?n.id===o.id:n.init===o.init));i=a?s.update(e,t)||t:r.render(s,r);var h=t.parentNode;return h&&i!==t&&h.replaceChild(i,t),a||qt(t,e),i}(e,o,a,s);case j.VNODE:return function(t,e,s,r){var i=t.parentNode,n=r.render(s,r);return i&&n!==t&&i.replaceChild(n,t),n}(e,0,a,s);case j.ORDER:return function(t,e){for(var s,r,i,n=t.childNodes,o={},a=0;a<e.removes.length;a++)s=n[(r=e.removes[a]).from],r.key&&(o[r.key]=s),t.removeChild(s);for(var h=n.length,c=0;c<e.inserts.length;c++)s=o[(i=e.inserts[c]).key],t.insertBefore(s,i.to>=h++?null:n[i.to])}(e,a),e;case j.PROPS:return Mt(e,a,o.properties),e;case j.THUNK:return r=e,i=s.patch(e,a,s),r&&i&&r!==i&&r.parentNode&&r.parentNode.replaceChild(i,r),i;default:return e}};function qt(t,e){"function"==typeof e.destroy&&I(e)&&e.destroy(t)}function Wt(t,e,s){var r=function(t){var e=[];for(var s in t)"a"!==s&&e.push(Number(s));return e}(e);if(0===r.length)return t;var i=$t(t,e.a,r),n=t.ownerDocument;s.document||n===Nt||(s.document=n);for(var o=0;o<r.length;o++){var a=r[o];t=Vt(t,i[a],e[a],s)}return t}function Vt(t,e,s,r){if(!e)return t;var i;if(M(s))for(var n=0;n<s.length;n++)i=Ft(s[n],e,r),e===t&&(t=i);else i=Ft(s,e,r),e===t&&(t=i);return t}var Ut=function t(e,s,r){return(r=r||{}).patch=r.patch&&r.patch!==t?r.patch:Wt,r.render=r.render||Lt,r.patch(e,s,r)},Ht=Lt,Bt=Yt,Xt={},Gt=[];function Yt(t,e,s,r,i){this.tagName=t,this.properties=e||Xt,this.children=s||Gt,this.key=null!=r?String(r):void 0,this.namespace="string"==typeof i?i:null;var n,o=s&&s.length||0,a=0,h=!1,c=!1,l=!1;for(var u in e)if(e.hasOwnProperty(u)){var d=e[u];W(d)&&d.unhook&&(n||(n={}),n[u]=d)}for(var p=0;p<o;p++){var f=s[p];R(f)?(a+=f.count||0,!h&&f.hasWidgets&&(h=!0),!c&&f.hasThunks&&(c=!0),l||!f.hooks&&!f.descendantHooks||(l=!0)):!h&&I(f)?"function"==typeof f.destroy&&(h=!0):!c&&D(f)&&(c=!0)}this.count=o+a,this.hasWidgets=h,this.hasThunks=c,this.hooks=n,this.descendantHooks=l}Yt.prototype.version=A,Yt.prototype.type="VirtualNode";var Jt=Kt;function Kt(t){this.text=String(t)}Kt.prototype.version=A,Kt.prototype.type="VirtualText";var Qt,Zt=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},te="object"==typeof et&&et&&et.Object===Object&&et,ee="object"==typeof self&&self&&self.Object===Object&&self,se=te||ee||Function("return this")(),re=function(){return se.Date.now()},ie=se.Symbol,ne=Object.prototype,oe=ne.hasOwnProperty,ae=ne.toString,he=ie?ie.toStringTag:void 0,ce=Object.prototype.toString,le=ie?ie.toStringTag:void 0,ue=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":le&&le in Object(t)?function(t){var e=oe.call(t,he),s=t[he];try{t[he]=void 0;var r=!0}catch(t){}var i=ae.call(t);return r&&(e?t[he]=s:delete t[he]),i}(t):function(t){return ce.call(t)}(t)},de=function(t){return null!=t&&"object"==typeof t},pe=function(t){return"symbol"==typeof t||de(t)&&"[object Symbol]"==ue(t)},fe=/^\s+|\s+$/g,ge=/^[-+]0x[0-9a-f]+$/i,me=/^0b[01]+$/i,ve=/^0o[0-7]+$/i,ye=parseInt,we=function(t){if("number"==typeof t)return t;if(pe(t))return NaN;if(Zt(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Zt(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(fe,"");var s=me.test(t);return s||ve.test(t)?ye(t.slice(2),s?2:8):ge.test(t)?NaN:+t},be=Math.max,xe=Math.min,Ee=function(t,e,s){var r,i,n,o,a,h,c=0,l=!1,u=!1,d=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){var s=r,n=i;return r=i=void 0,c=e,o=t.apply(n,s)}function f(t){var s=t-h;return void 0===h||s>=e||s<0||u&&t-c>=n}function g(){var t=re();if(f(t))return m(t);a=setTimeout(g,function(t){var s=e-(t-h);return u?xe(s,n-(t-c)):s}(t))}function m(t){return a=void 0,d&&r?p(t):(r=i=void 0,o)}function v(){var t=re(),s=f(t);if(r=arguments,i=this,h=t,s){if(void 0===a)return function(t){return c=t,a=setTimeout(g,e),l?p(t):o}(h);if(u)return clearTimeout(a),a=setTimeout(g,e),p(h)}return void 0===a&&(a=setTimeout(g,e)),o}return e=we(e)||0,Zt(s)&&(l=!!s.leading,n=(u="maxWait"in s)?be(we(s.maxWait)||0,e):n,d="trailing"in s?!!s.trailing:d),v.cancel=function(){void 0!==a&&clearTimeout(a),c=0,r=h=i=a=void 0},v.flush=function(){return void 0===a?o:m(re())},v},_e=Array.isArray,ke=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Se=/^\w*$/,Oe=se["__core-js_shared__"],Te=(Qt=/[^.]+$/.exec(Oe&&Oe.keys&&Oe.keys.IE_PROTO||""))?"Symbol(src)_1."+Qt:"",Ce=Function.prototype.toString,Ne=/^\[object .+?Constructor\]$/,Me=Function.prototype,Ae=Object.prototype,je=Me.toString,Pe=Ae.hasOwnProperty,Le=RegExp("^"+je.call(Pe).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Re=function(t){return!(!Zt(t)||(e=t,Te&&Te in e))&&(function(t){if(!Zt(t))return!1;var e=ue(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}(t)?Le:Ne).test(function(t){if(null!=t){try{return Ce.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e},$e=function(t,e){var s=function(t,e){return null==t?void 0:t[e]}(t,e);return Re(s)?s:void 0},Ie=$e(Object,"create"),De=Object.prototype.hasOwnProperty,ze=Object.prototype.hasOwnProperty;function Fe(t){var e=-1,s=null==t?0:t.length;for(this.clear();++e<s;){var r=t[e];this.set(r[0],r[1])}}Fe.prototype.clear=function(){this.__data__=Ie?Ie(null):{},this.size=0},Fe.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Fe.prototype.get=function(t){var e=this.__data__;if(Ie){var s=e[t];return"__lodash_hash_undefined__"===s?void 0:s}return De.call(e,t)?e[t]:void 0},Fe.prototype.has=function(t){var e=this.__data__;return Ie?void 0!==e[t]:ze.call(e,t)},Fe.prototype.set=function(t,e){var s=this.__data__;return this.size+=this.has(t)?0:1,s[t]=Ie&&void 0===e?"__lodash_hash_undefined__":e,this};var qe=Fe,We=function(t,e){return t===e||t!=t&&e!=e},Ve=function(t,e){for(var s=t.length;s--;)if(We(t[s][0],e))return s;return-1},Ue=Array.prototype.splice;function He(t){var e=-1,s=null==t?0:t.length;for(this.clear();++e<s;){var r=t[e];this.set(r[0],r[1])}}He.prototype.clear=function(){this.__data__=[],this.size=0},He.prototype.delete=function(t){var e=this.__data__,s=Ve(e,t);return!(s<0||(s==e.length-1?e.pop():Ue.call(e,s,1),--this.size,0))},He.prototype.get=function(t){var e=this.__data__,s=Ve(e,t);return s<0?void 0:e[s][1]},He.prototype.has=function(t){return Ve(this.__data__,t)>-1},He.prototype.set=function(t,e){var s=this.__data__,r=Ve(s,t);return r<0?(++this.size,s.push([t,e])):s[r][1]=e,this};var Be=He,Xe=$e(se,"Map"),Ge=function(t,e){var s,r,i=t.__data__;return("string"==(r=typeof(s=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==s:null===s)?i["string"==typeof e?"string":"hash"]:i.map};function Ye(t){var e=-1,s=null==t?0:t.length;for(this.clear();++e<s;){var r=t[e];this.set(r[0],r[1])}}Ye.prototype.clear=function(){this.size=0,this.__data__={hash:new qe,map:new(Xe||Be),string:new qe}},Ye.prototype.delete=function(t){var e=Ge(this,t).delete(t);return this.size-=e?1:0,e},Ye.prototype.get=function(t){return Ge(this,t).get(t)},Ye.prototype.has=function(t){return Ge(this,t).has(t)},Ye.prototype.set=function(t,e){var s=Ge(this,t),r=s.size;return s.set(t,e),this.size+=s.size==r?0:1,this};var Je=Ye;function Ke(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var s=function(){var r=arguments,i=e?e.apply(this,r):r[0],n=s.cache;if(n.has(i))return n.get(i);var o=t.apply(this,r);return s.cache=n.set(i,o)||n,o};return s.cache=new(Ke.Cache||Je),s}Ke.Cache=Je;var Qe,Ze,ts=Ke,es=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ss=/\\(\\)?/g,rs=function(t){var e=ts(t,function(t){return 500===s.size&&s.clear(),t}),s=e.cache;return e}(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(es,function(t,s,r,i){e.push(r?i.replace(ss,"$1"):s||t)}),e}),is=ie?ie.prototype:void 0,ns=is?is.toString:void 0,os=function t(e){if("string"==typeof e)return e;if(_e(e))return function(t,e){for(var s=-1,r=null==t?0:t.length,i=Array(r);++s<r;)i[s]=e(t[s],s,t);return i}(e,t)+"";if(pe(e))return ns?ns.call(e):"";var s=e+"";return"0"==s&&1/e==-1/0?"-0":s},as=function(t,e){return _e(t)?t:function(t,e){if(_e(t))return!1;var s=typeof t;return!("number"!=s&&"symbol"!=s&&"boolean"!=s&&null!=t&&!pe(t))||Se.test(t)||!ke.test(t)||null!=e&&t in Object(e)}(t,e)?[t]:rs(function(t){return null==t?"":os(t)}(t))},hs=function(t){if("string"==typeof t||pe(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e},cs=function(){try{var t=$e(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),ls=Object.prototype.hasOwnProperty,us=function(t,e,s){var r=t[e];ls.call(t,e)&&We(r,s)&&(void 0!==s||e in t)||function(t,e,s){"__proto__"==e&&cs?cs(t,e,{configurable:!0,enumerable:!0,value:s,writable:!0}):t[e]=s}(t,e,s)},ds=/^(?:0|[1-9]\d*)$/,ps=function(t,e){var s=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==s||"symbol"!=s&&ds.test(t))&&t>-1&&t%1==0&&t<e},fs=(Qe=Object.getPrototypeOf,Ze=Object,function(t){return Qe(Ze(t))}),gs=Function.prototype,ms=Object.prototype,vs=gs.toString,ys=ms.hasOwnProperty,ws=vs.call(Object);!function(){if("undefined"!=typeof window&&("performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0)){var t=window.performance.timing&&window.performance.timing.navigationStart?window.performance.timing.navigationStart:Date.now();window.performance.now=function(){return Date.now()-t}}}();const bs=function(t){var e,s,r=function(e){return t?t(e):window.performance.now()},i=(e=[],{getAll:function(){return e},removeAll:function(){e=[]},add:function(t){e.push(t)},remove:function(t){var s=e.indexOf(t);-1!==s&&e.splice(s,1)},update:function(t){if(0===e.length)return!1;var s=0;for(t=void 0!==t?t:r();s<e.length;)e[s].update(t)?s++:e.splice(s,1);return!0}});return i.Tween=function(t){var e=t,s={},n={},o={},a=1e3,h=0,c=!1,l=!1,u=0,d=null,p=i.Easing.Linear.None,f=i.Interpolation.Linear,g=[],m=null,v=!1,y=null,w=null,b=null;for(var x in t)s[x]=parseFloat(t[x],10);this.to=function(t,e){return void 0!==e&&(a=e),n=t,this},this.start=function(t){for(var a in i.add(this),l=!0,v=!1,d=void 0!==t?t:r(this),d+=u,n){if(n[a]instanceof Array){if(0===n[a].length)continue;n[a]=[e[a]].concat(n[a])}void 0!==s[a]&&(s[a]=e[a],s[a]instanceof Array==0&&(s[a]*=1),o[a]=s[a]||0)}return this},this.stop=function(){return l?(i.remove(this),l=!1,null!==b&&b.call(e),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var t=0,e=g.length;t<e;t++)g[t].stop()},this.delay=function(t){return u=t,this},this.duration=function(t){return a=t,this},this.repeat=function(t){return h=t,this},this.yoyo=function(t){return c=t,this},this.easing=function(t){return p=t,this},this.interpolation=function(t){return f=t,this},this.chain=function(){return g=arguments,this},this.onStart=function(t){return m=t,this},this.onUpdate=function(t){return y=t,this},this.onComplete=function(t){return w=t,this},this.onStop=function(t){return b=t,this},this.update=function(t){var r,i,l;if(t<d)return!0;for(r in!1===v&&(null!==m&&m.call(e),v=!0),l=p(i=(i=(t-d)/a)>1?1:i),n)if(void 0!==s[r]){var b=s[r]||0,x=n[r];x instanceof Array?e[r]=f(x,l):("string"==typeof x&&(x=x.startsWith("+")||x.startsWith("-")?b+parseFloat(x,10):parseFloat(x,10)),"number"==typeof x&&(e[r]=b+(x-b)*l))}if(null!==y&&y.call(e,l),1===i){if(h>0){for(r in isFinite(h)&&h--,o){if("string"==typeof n[r]&&(o[r]=o[r]+parseFloat(n[r],10)),c){var E=o[r];o[r]=n[r],n[r]=E}s[r]=o[r]}return d=t+u,!0}null!==w&&w.call(e);for(var _=0,k=g.length;_<k;_++)g[_].start(d+a);return!1}return!0}},i.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var e,s=.1;return 0===t?0:1===t?1:(!s||s<1?(s=1,e=.1):e=.4*Math.asin(1/s)/(2*Math.PI),-s*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4))},Out:function(t){var e,s=.1;return 0===t?0:1===t?1:(!s||s<1?(s=1,e=.1):e=.4*Math.asin(1/s)/(2*Math.PI),s*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)},InOut:function(t){var e,s=.1;return 0===t?0:1===t?1:(!s||s<1?(s=1,e=.1):e=.4*Math.asin(1/s)/(2*Math.PI),(t*=2)<1?s*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4)*-.5:s*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4)*.5+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-i.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*i.Easing.Bounce.In(2*t):.5*i.Easing.Bounce.Out(2*t-1)+.5}},Random:{None:function(t){return Math.random()}}},i.Interpolation={Linear:function(t,e){var s=t.length-1,r=s*e,n=Math.floor(r),o=i.Interpolation.Utils.Linear;return e<0?o(t[0],t[1],r):e>1?o(t[s],t[s-1],s-r):o(t[n],t[n+1>s?s:n+1],r-n)},Bezier:function(t,e){for(var s=0,r=t.length-1,n=Math.pow,o=i.Interpolation.Utils.Bernstein,a=0;a<=r;a++)s+=n(1-e,r-a)*n(e,a)*t[a]*o(r,a);return s},CatmullRom:function(t,e){var s=t.length-1,r=s*e,n=Math.floor(r),o=i.Interpolation.Utils.CatmullRom;return t[0]===t[s]?(e<0&&(n=Math.floor(r=s*(1+e))),o(t[(n-1+s)%s],t[n],t[(n+1)%s],t[(n+2)%s],r-n)):e<0?t[0]-(o(t[0],t[0],t[1],t[1],-r)-t[0]):e>1?t[s]-(o(t[s],t[s],t[s-1],t[s-1],r-s)-t[s]):o(t[n?n-1:0],t[n],t[s<n+1?s:n+1],t[s<n+2?s:n+2],r-n)},Utils:{Linear:function(t,e,s){return(e-t)*s+t},Bernstein:function(t,e){var s=i.Interpolation.Utils.Factorial;return s(t)/s(e)/s(t-e)},Factorial:(s=[1],function(t){var e=1;if(s[t])return s[t];for(var r=t;r>1;r--)e*=r;return s[t]=e,e}),CatmullRom:function(t,e,s,r,i){var n=.5*(s-t),o=.5*(r-e),a=i*i;return(2*e-2*s+n+o)*(i*a)+(-3*e+3*s-2*n-o)*a+n*i+e}}},i},xs=bs(),Es={diff:tt,patch:Ut,createElement:Ht,create:Ht,VNode:Bt,VText:Jt},_s={debounce:Ee,throttle:function(t,e,s){var r=!0,i=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return Zt(s)&&(r="leading"in s?!!s.leading:r,i="trailing"in s?!!s.trailing:i),Ee(t,e,{leading:r,maxWait:e,trailing:i})},get:function(t,e,s){var r=null==t?void 0:function(t,e){for(var s=0,r=(e=as(e,t)).length;null!=t&&s<r;)t=t[hs(e[s++])];return s&&s==r?t:void 0}(t,e);return void 0===r?s:r},set:function(t,e,s){return null==t?t:function(t,e,s,r){if(!Zt(t))return t;for(var i=-1,n=(e=as(e,t)).length,o=n-1,a=t;null!=a&&++i<n;){var h=hs(e[i]),c=s;if(i!=o){var l=a[h];void 0===(c=r?r(l,h,a):void 0)&&(c=Zt(l)?l:ps(e[i+1])?[]:{})}us(a,h,c),a=a[h]}return t}(t,e,s)},isPlainObject:function(t){if(!de(t)||"[object Object]"!=ue(t))return!1;var e=fs(t);if(null===e)return!0;var s=ys.call(e,"constructor")&&e.constructor;return"function"==typeof s&&s instanceof s&&vs.call(s)==ws}},ks={window:{},document:{}},Ss={get window(){return"undefined"==typeof window?ks.window:window},get document(){return"undefined"==typeof document?ks.document:document},get CSS(){return"undefined"==typeof window?ks.CSS:window.CSS},set(t,e){ks[t]=e,t in this||Object.defineProperty(this,t,{get:()=>ks[t]})},vdom:Es,TWEENJS:bs,TWEEN:xs,_:_s},Os={svg:["svg","http://www.w3.org/2000/svg"],math:["math","http://www.w3.org/1998/Math/MathML"]};class Ts{static get RENDER(){return s}constructor(t,e){this[l]=t;var[s,r]=Os[this[l]]||[];this.ns=s,this.nsURI=r,this[a]=e,this[d]=0}get nodeName(){return this[l]}get nextSibling(){return this._nextSibling}get namespaceURI(){return this.nsURI||(this[o]?this[o].namespaceURI:null)}get value(){}get selected(){}get disabled(){}appendChild(t){var e=this._childCount++;return this[n][e]=t,t[o]=this,0==e?this._firstChild=t:this._lastChild._nextSibling=t,t[d]=e,this._lastChild=t,t}removeChild(t){var e=this[n].indexOf(t);if(-1!==e)return this[n].splice(e,1),t}get parent(){return this[o]}get ancestors(){return this.parent?this.parent.ancestors.concat([this.parent]):[]}get children(){return this[n]}set children(t){this[i]=t}get firstChild(){var t=this._firstChild;return t&&11===t[p]?t.firstChild||t.nextSibling:t}get lastChild(){var t=this._lastChild;return t&&11===t[p]?t.lastChild:t}get nextSibling(){var t=this._nextSibling;if(t){if(11===t[p])return t.firstChild||t.nextSibling}else{var e=this[o];if(e&&11===e[p])return e.nextSibling}return t}hasAttributeNS(t,e){}clear(t,e=!0){t&&(this[n]=null),delete this[u],e&&this[o]&&this[o].clear(t)}setScope(t){this.context.set(t),this.render()}render(t){this[v]&&setTimeout(()=>{this.pending||(this[n]=null,t||this[s](),this._render(t))})}_render(t){delete this[u],t&&(this[n]=null),this[o]?this[o]._render(t):this[r]&&this[r].render(t)}hook(t,e,s){}debug(){}[s](){}}const{VText:Cs}=Es;class Ns extends Ts{constructor(t){super("text",null),this[f]=t,this[p]=3}get vnode(){return new Cs(this[f])}cloneNode(){return new Ns(this[f])}}const Ms={};class As{static register(t,e){Ms[t]=e}static has(t){return Ms.hasOwnProperty(t)}static get(t){return Ms[t]}constructor(t,e){this.component=e,this.options=t}init(t,e){this.config=t,this.context=e}update(t,e){this.config=t,this.context=e}destroy(){}hook(t,e,s){var r=this.options(this.component.context);s?(this.modifier=s.modifier,this.modifier.component=this.component,this.modifier.options=r):this.modifier=this.create(t,r)}unhook(t){this.modifier&&this.modifier.destroy&&this.modifier.destroy(t)}}class js{constructor(t,e,s){this.elem=t,this.component=s,this.options=e,this.options.path&&(this.onChange=t=>{this.setModelValue(),this.component.clear(!0),this.component.render()},this.setElemValue(),t.addEventListener("input",this.onChange,!0),this.destroy=t=>{t.removeEventListener("input",this.onChange,!0)})}get path(){return this.options.path}getValue(){this.path;var{context:t}=this.component;return _.get(t,this.path)}setModelValue(){var t=this.elem.value,{context:e}=(this.path,this.component);return _.set(e,this.path,t)}setElemValue(){var t=this.getValue();this.elem.value=t}}As.register("bind",class extends As{create(t,e){return new js(t,e,this.component)}});class Ps{constructor(t,e,s){this.elem=t,this.component=s,this.options=e||{};var r=this.component.animate([{background:"green"},{background:"yellow"},{background:"blue"}],{fill:"both"});const i=t=>{"paused"==r.playState?r.play():r.pause()};switch(this.options.on){case"click":this.elem.addEventListener("click",i,!0);break;case"load":play()}this.destroy=t=>{r.cancel(),this.elem.removeEventListener("click",i,!0)}}}As.register("animate",class extends As{create(t,e){return new Ps(t,e,this.component)}});var Ls=4,Rs={get level(){return Ls},set level(t){Ls=t},log(...t){},warn(...t){},error(...t){}};const $s=new Map,Is=Symbol("data");class Ds{constructor(t,e,s="app"){Object.defineProperty(this,"app",{get:()=>e}),Object.assign(this,t),this.id=s,this.root=this}assign(t){Object.assign(this,t)}define(t){this[Is]=Object.assign({},this[Is],t),Object.keys(t).forEach(t=>{void 0!==this[t]&&Rs.warn("overwriting key",t),Object.defineProperty(this,t,{configurable:!0,get:()=>this[Is][t],set:e=>{this[Is][t]=e}})})}$instance(t,e,s,r){var i=$s.get(e);return i&&Object.getPrototypeOf(i)===t?(Object.assign(i,r),i):(i=Object.create(t),Object.assign(i,r),i.parent=t,i.id=e,$s.set(e,i),i)}$new(t,e,s={}){return t=`${this.id}-${t}`,this.$instance(this.root,t,e,s)}$ext(t,e,s={}){return t=`${this.id}-${t}`,this.$instance(this,t,e,s)}get router(){return this.app.router}set errors(t){this[O]=t}get errors(){return this[O]}set(t){this.assign(t)}get(t){return this[Is][t]}hook(t){}}class zs{constructor(t,e){this.comp=e,Object.assign(this,t)}template(t){var e=this.comp.context.app;return"function"==typeof t?t:e.getTemplate(t)}get(t,e,s={}){const r=this[t];return"function"==typeof r?r(e,s):r}}class Fs{constructor(t){this.val=t}hook(t,e,s){try{if(!s)return void(t[e]=this.val||"");s.val!==this.val&&(t[e]=this.val||"")}catch(t){}}}class qs{constructor(t){this.events=t}bind(t){var e=(t,s)=>{var[r,i]=er.find(t);if(i){if(i[s]&&"function"==typeof i[s])return i;if(r.parentNode)return e(r.parentNode,s)}};this.evts=Object.keys(this.events).reduce((s,r)=>{var[i,n]=this.events[r];return s[r]=s=>{var r=e(t,i);r&&r[i].call(r,s,t,...n)},s},{}),Object.keys(this.evts).forEach(e=>{t.addEventListener(e,this.evts[e])})}unbind(t){Object.keys(this.evts||{}).forEach(e=>{t.removeEventListener(e,this.evts[e])})}hook(t,e,s){s&&s.unbind(t),this.bind(t)}}const{VNode:Ws,VText:Vs}=Es,Us=Symbol("props"),Hs=new WeakMap;class Bs{constructor(t,e,s){this.key=s,this.vnode=t,this.children=e}get type(){return"Widget"}init(){var t=Es.create(this.vnode),e=t.attachShadow({mode:"open"});return this.shadow=e,this.contents=Es.create(this.children),e.appendChild(this.contents),t}update(t,e){var s=Es.diff(t.vnode,this.vnode);Es.patch(e,s),this.shadow=t.shadow;var r=t.contents;return s=Es.diff(t.children,this.children),Es.patch(r,s),this.contents=r,e}destroy(t,e){const{document:s}=Ss;t&&s.body.contains(t)}}class Xs{get type(){return"Thunk"}constructor(t,e){this.comp=t,this.Delegate=e}compare(t){if(!t)return!1;var e=t.comp.delegate;return!e||!e.compare||e.compare(this.comp.context,t.comp.context)}render(t){return this.compare(t)?t.vnode:this.comp.createVNode()}}class Gs{constructor(t){this.comp=t}hook(t,e,s){if(this.elem=this.comp.elem=t,Hs.set(t,this.comp),s)"function"==typeof this.comp.updated&&this.comp.updated(t,s),s.comp.tick=null,this.delegate=s.delegate&&s.delegate[y](this.comp[Us],this.comp,s);else{"function"==typeof this.comp.created&&this.comp.created(t);var r=this.comp[w],i=null;r&&r.prototype[y]&&(this.delegate=i=new r(t)[y](this.comp[Us],this.comp)),("function"==typeof this.comp.attached||i)&&setTimeout(()=>{this.comp.attached&&this.comp.attached(t),i&&i.initialize&&i.initialize()},0)}}unhook(t,e,s){!s&&this.comp.destroy&&this.comp.destroy(t),!s&&this.delegate&&"function"==typeof this.delegate.destroyed&&this.delegate.destroyed(t),this.comp.tick=null}}class Ys extends Ts{static find(t){if(!t)return[];var e=Hs.get(t);return!e&&t.parentNode||t.host?Ys.find(t.parentNode||t.host):[t,e]}constructor(t,e,s){super(t,e,s),this[p]=1,this[b]=e.a||e.attributes,this[i]=s,this[a].__scope&&(this.__scope=this[a].__scope)}set[w](t){this.__delegateClass=t}get[w](){return this.__delegateClass}clone(t){var e=Object.assign({},this[a]);return t&&(e.__scope=t),h(this[l],e,this[i])}_renderNodes(t){}[s](t,e={}){var r=[],o=this.context;this[n]=this[n]||[],this[n].length=0,this._childCount=0;var h=t||this[i],c=this[w];if(c&&c.render&&(h=[c.render(this[l],this[a],h)]),h&&("function"==typeof h&&(h=h(o,e)),h)){Array.isArray(h)||(h=[h]);var d=t=>{if(Array.isArray(t))for(var i=0,n=t.length;i<n;i++)d(t[i]);else{if("function"==typeof t)return d(t(o));if(t instanceof Promise){var a=new Ys("div",{},["loading..."]);r.push(new Promise((e,r)=>{t.then(t=>{this.clear(!0),Promise.all(this[s](t)).then(e,r)}).catch(t=>{this.clear(!0);const r=this.context.errors||[];return e(this[s](new Ys("div",{attributes:{class:"errors"}},[new Ys("div",{attributes:{class:"message"}},[t.message]),new Ys("div",{attributes:{class:"error"}},r.map(t=>new Ys("div",{},[t.error])))])))})})),a[s](),this.appendChild(a)}else{"object"==typeof t&&t[s]||(null==t&&(t=""),t=new Ns(String(t)));try{this.appendChild(t);let i=t[s](null,e);r=i?r.concat(i):r}catch(e){let r=new Ys("div",{attributes:{class:"error",style:"color:red;"}},[new Ys("pre",{},[`\nError in <${t[l]}> tag!\n${e.stack}\n\t\t\t\t\t`])]);this.appendChild(r),r[s]()}}}};return(t=>{let e;for(let s=0,r=t.length;s<r;s++){let r=t[s];if(!r)continue;let i=((r[a]||{})._m||[]).filter(t=>{let e=As.get(t.name);if(e&&e.render)return!0});if(i.length){let t,s,n=1;for(let e of i){let i=As.get(e.name);t||(t=[r]),s=[].concat.apply([],t),t=[];for(let r of s){if(!r)continue;let s=i.render(r,r.context||o,e,n);Array.isArray(s)?t=t.concat(s):s&&t.push(s)}n+=1}e=d(t||r)}else e=d(r)}})(h),this[u]=null,this[v]=!0,r}}get context(){return this.__scope?this.__scope:this[o]?this[o].context:null}set context(t){this.__scope=t}set styles(t){this[g]=this[g]||{},Object.assign(this[g],t)}get styles(){return this[g]||(this[g]={})}get[c](){const t={},e={attributes:this.attributes,key:this[a].key};this.__scope&&(e.__scope=this.__scope,e.key=e.key||e.__scope.id);const s=this[a].style;s&&("string"==typeof s?Object.assign(t,s.split(";").map(t=>t.split(":")).reduce((t,[e,s])=>(t[e]=s,t),{})):Object.assign(t,s)),this[g]&&Object.assign(t,this[g]);let r=Object.keys(t).reduce((e,s)=>e+`${s}:${t[s]};`,"");const i=this[a]._h;if(i){const t=i(this.context,this);if(t&&t.exprs){const e=t.properties;t.exprs.expr.exec(this.context,e);const s=e.collect();s&&(r+=s)}Object.assign(e,t)}r&&(e.attributes=e.attributes||{},e.attributes.style=r),this[a].scrollable&&(e.scrollable=this[a].scrollable(this.context)),(this.constructor.isComponent||this[w]||this.__scope)&&Object.assign(e,{component:new Gs(this)});const n=this[a].on;n&&Object.keys(n).forEach(t=>{e[`on${t}`]=n[t]});const o=this[a].events;o&&(e.events=new qs(o,this));const h=this[a].logic;h&&(e.logic=new zs(h,this));const c=this[a].value;c&&(e.value=new Fs(c,this));const l=this[a].mods;if(Object.keys(l||{}).forEach(t=>{const s=As.get(t);s&&(e.component=new Gs(this),e[t]=new s(l[t],this))}),this.isMedia&&e.attributes.src&&this.entity){const t=this.entity.site.findFileByUrl(e.attributes.src);if(t){const s=t.cueEvents;s&&(e.cue=s)}}return e}get isMedia(){return"audio"==this.nodeName||"video"==this.nodeName}set[c](t){}get vnode(){var t=this[w];return t?new Xs(this,t):this.createVNode()}createVNode(){for(var t,e=[],s=this.firstChild,r=this.namespaceURI,i=0;s&&t!==s&&!(i>4e3);)e.push(s.vnode),t=s,s=s.nextSibling,i+=1;var n=this[c];const o=n.key||this[a].key;return this[a].shadow?new Bs(new Ws(this[l],n,[],o,r),new Ws("contents",{attributes:{style:"display:contents;",key:o}},e,o),o):(this[u]=new Ws(this[l],n,e,o,r),this[u])}get attributes(){const t="function"==typeof this[b]?this[b](this.context):Object.assign({},this[b]);return this[x]&&Object.assign(t,this[x]),t}set attributes(t){this[x]=this[x]||{},Object.assign(this[x],t)}getAttribute(t){return this[x][t]}setAttribute(t,e){this[x]=this[x]||{},this[x][t]=e}animate(t,e={}){const s=Object.assign({duration:1e3,iterations:1/0},e);var r=this.elem.animate(t,s);return r.pause(),r}}const Js={ce:{}},Ks={},Qs={};var Zs=[];class tr{static define(t,e,s={}){Ks[t]=e}static register(t,e,s={}){const{window:r,document:i}=Ss,n=r.customElements,o=r.HTMLElement,a=n?n.define.bind(n):null;try{var h;if("string"==typeof s?(h=s,s={}):h=s.ns||"html",o&&e.prototype instanceof o){if(!a)return;a(t,e),h="ce"}if(h in Qs||(Qs[h]={}),h in Js||(Js[h]={}),t in Js[h])throw new Error(`${t} is already registered in the ${h} namespace`);Js[h][t]=e,Qs[h][t]=s,Zs=Object.keys(Js)}catch(t){throw new Error(`Component registration failed: ${t.message}`)}}static has(t,e="html"){return Js[e]&&Js[e].hasOwnProperty(t)}static hasDelegate(t,e){return Ks.hasOwnProperty(t)}static getDelegate(t,e){return Ks[t]}static get(t,e){if(e&&Js[e])return Js[e][t];for(let e of Zs)if("ce"!=e&&t in Js[e])return[Js[e][t],Qs[e][t]]}static all(){return Qs}}class er extends Ys{static register(t,e,s={}){tr.register(t,e,s)}static define(t,e,s={}){tr.define(t,e,s)}static has(t,e="html"){return tr.has(t,e)}static get(t,e){return tr.get(t,e)}static all(){return tr.all()}static get isComponent(){return!0}static renderTree(t){return t[s]()}constructor(t,e,s){super(t,e,s)}createElement(t,e,s){var r=document.createElement(t);return Object.keys(e||{}).map(t=>{"style"===t?Object.assign(r.style,e[t]):r.setAttribute(t,e[t])}),s&&s.appendChild(r),r}compare(t){}get root(){return this.elem.shadowRoot?this.elem.shadowRoot:this.elem}$(t){return this.root.querySelector(t)}$$(t){return this.root.querySelectorAll(t)}setScope(...t){let e=t[0];t.length>1&&e instanceof Event&&(e=t[2]),super.setScope(e)}set(t,e){}unset(t,e){}fireEvent(t,e={}){let s;return this.elem&&(s=new Event(t,e),this.elem.dispatchEvent(s)),s}}class sr extends Ys{constructor(t,e,s){super(t,e,s),this[p]=11}}class rr{constructor(t){this.comp=t}resolve(){var t=this.comp.async;return this.resolved=t.resolved=!1,t.promise.then(async t=>t).finally(()=>{this.resolved=t.resolved=!0})}}class ir{constructor(t,e){this.vnode=t,this.comp=e}get type(){return"Widget"}init(){var t=Es.create(this.vnode),e=this.comp.async;return Promise.all(e[s](null,{})).then(()=>{var s=e.vnode;this.contents=Es.create(s),t.appendChild(this.contents),this.resolver=new rr(this.comp),this.patch(s)}),this.node=t,t}patch(t){let e=this.comp.async;const r=async r=>{e.clear(!0,!1),await Promise.all(e[s](null,r));var i=Es.diff(t,e.vnode);Es.patch(this.contents,i)};e.error=null,this.resolver.resolve().then(r).catch(t=>{e.error=e.context.error=t,r({error:t})})}update(t,e){return t&&!t.resolver.resolved?(this.vnode=t.vnode,this.resolver=t.resolver,e):(t&&this.patch(t.vnode),e)}destroy(t,e){t&&document.body.contains(t)}}class nr extends er{constructor(t,e,s){super("div",e,s)}get promise(){var t=this[c].logic.get("expr",this.context);return Promise.all(Object.keys(t).map(e=>Promise.resolve(t[e]).then(t=>[e,t]))).then(t=>t.reduce((t,[e,s])=>(t[e]=s,t),{}))}}function or(t){return class extends sr{[s](e,r){if(t(this[o])){const t=this[c].logic.get("expr",this.context);return super[s](e,t)}}}}er.register("loading",or(t=>!t.resolved),"logic"),er.register("then",or(t=>!t.error&&t.resolved),"logic"),er.register("catch",or(t=>!!t.error),"logic"),er.register("finally",or(t=>t.resolved),"logic"),er.register("await",class extends er{constructor(t,e,s){super("div",e,[]),this.async=new nr("async",e,s)}createVNode(){return new ir(super.createVNode(),this)}},"logic");var ar=/^(?:submit|button|image|reset|file)$/i,hr=/^(?:input|select|textarea|keygen)/i,cr=/(\[[^\[\]]*\])/g;function lr(t,e){"object"!=typeof e?e={hash:!!e}:void 0===e.hash&&(e.hash=!0);for(var s=e.hash?{}:"",r=e.serializer||(e.hash?dr:pr),i=t.querySelectorAll("input, select, textarea"),n=Object.create(null),o=0;o<i.length;++o){var a=i[o];if((e.disabled||!a.disabled)&&a.name&&hr.test(a.nodeName)&&!ar.test(a.type)){var h=a.name,c=a.value;if("checkbox"!==a.type&&"radio"!==a.type||a.checked||(c=void 0),e.empty){if("checkbox"!==a.type||a.checked||(c=""),"radio"===a.type&&(n[a.name]||a.checked?a.checked&&(n[a.name]=!0):n[a.name]=!1),null==c&&"radio"==a.type)continue}else if(!c)continue;if("select-multiple"!==a.type)s=r(s,h,c);else{c=[];for(var l=a.options,u=!1,d=0;d<l.length;++d){var p=l[d],f=e.empty&&!p.value,g=p.value||f;p.selected&&g&&(u=!0,s=e.hash&&"[]"!==h.slice(h.length-2)?r(s,h+"[]",p.value):r(s,h,p.value))}!u&&e.empty&&(s=r(s,h,""))}}}if(e.empty)for(var h in n)n[h]||(s=r(s,h,""));return s}function ur(t,e,s){if(0===e.length)return s;var r=e.shift(),i=r.match(/^\[(.+?)\]$/);if("[]"===r)return t=t||[],Array.isArray(t)?t.push(ur(null,e,s)):(t._values=t._values||[],t._values.push(ur(null,e,s))),t;if(i){var n=i[1],o=+n;isNaN(o)?(t=t||{})[n]=ur(t[n],e,s):(t=t||[])[o]=ur(t[o],e,s)}else t[r]=ur(t[r],e,s);return t}function dr(t,e,s){if(e.match(cr))ur(t,function(t){var e=[],s=new RegExp(cr),r=/^([^\[\]]*)/.exec(t);for(r[1]&&e.push(r[1]);null!==(r=s.exec(t));)e.push(r[1]);return e}(e),s);else{var r=t[e];r?(Array.isArray(r)||(t[e]=[r]),t[e].push(s)):t[e]=s}return t}function pr(t,e,s){return s=s.replace(/(\r)?\n/g,"\r\n"),s=(s=encodeURIComponent(s)).replace(/%20/g,"+"),t+(t?"&":"")+encodeURIComponent(e)+"="+s}var fr=Object.freeze({__proto__:null,serialize:lr,items:function(t){return Promise.resolve(t).then(t=>{return e=t,(s={})[Symbol.iterator]=function*(){for(let t of e)yield t},s;var e,s})}});function gr(t,e,s,r,i){e&&e._uid;var n=i||t.toLowerCase(),[o,a]=tr.get(n,r)||[Ys,{}],h=tr.getDelegate(n,r),c=new o(t,e,s,a);return h&&(c[w]=h),c}er.register("repeat",class extends sr{[s](){var t,e=this[i],r=this[c],n=this.context,o=r.logic,h=o.get("expr",n)||1,l=o.get("as",n)||"item";const u=({items:t})=>{var s,r=[];t="number"==typeof t?Array.from({length:t},(t,e)=>e+1):(s=t,Array.isArray(s)?s:s instanceof Map?Array.from(s.entries()):Array.from(s.valueOf()));try{for(let s=0,i=t.length;s<i;s++){if(s>12500)throw"Too many iterations! Max is 12500";let i=t[s],o=n.$ext(s,s);o.item=i,o.index=s,o.first=0===s,o.last=s===t.length-1,"item"!==l&&(o[l]=i);let h=e(o,i,s,i);for(let t=0,e=h.length;t<e;t++){let e=o.$ext(t,t),r=h[t];r[a]&&(r[a].key=r[a].key||(o.id||"r"+s)+"-"+t,r.__scope||(r.context=e))}r=r.concat(h)}return r}catch(t){return[]}};return t=h instanceof Promise?[gr("view",{attributes:{name:"repeat"},__scope:n,resolve:h.then(t=>({items:t}))},u)]:u({items:h}),super[s](t)}},"logic"),er.register("if",class extends sr{[s](){this.renderElse=!1;const t=this[c].logic,e=t.get("params",this.context);if(t.get("expr",this.context,e))return super[s](null,e);this.renderElse=!0}},"logic"),er.register("else",class extends sr{[s](){const t=this[o],e=t[n].indexOf(this),r=t[n][e-1];if(r&&r.renderElse){let t=this[c].logic;if(!t)return super[s]();if(t.get("expr",this.context))return super[s]();this.renderElse=!0}}},"logic"),er.register("switch",class extends sr{[s](){var t=this[c].logic.get("expr",this.context);return this.result=t,this.renderDefault=!0,super[s]()}},"logic"),er.register("case",class extends sr{[s](){var t=this[c].logic.get("expr",this.context),e=this[o];if(e&&"switch"===e[l]&&e.result==t)return e.renderDefault=!1,super[s]()}},"logic"),er.register("default",class extends sr{[s](){var t=this[o];if(t&&"switch"===t[l]&&t.renderDefault)return super[s]()}},"logic");const mr=Symbol("_asyncRender");er.register("include",class extends sr{[s](){return null}async[mr](){var t,e,r,n=this[i],o=this[c].logic,a=this.context,h=o.get("src",a);if(r=o.get("params",a),t=o.template(h)){await t.loadTemplate();var l=((t,s)=>{if("function"==typeof t)return t(a);var r=this.ancestors.find(e=>e[E]===t);return r&&(r.loopCount=(r.loopCount||0)+1,r.loopCount>10)?void 0:(this[E]=t,l=t.render(a,s),(e=o.get("css",a))&&(l.styles=e),l.attributes={id:`block_${o.id}_${r?r.loopCount:0}`,class:`block ${o.name} ${t.name}`},this.transclude=n,l)})(t,r);return Promise.all(super[s]([l]))}}},"logic"),er.register("transclude",class extends sr{[s](){for(var t,e=this[o];e&&!t;)t=e.transclude,e=e[o];t&&super[s](t)}},"logic");const{VNode:vr,VText:yr}=Es;function wr(t){if(t&&t.length){var e=[];for(let s=0,r=t.length;s<r;s++){let r=t[s],i="http://www.w3.org/1999/xhtml"==r.namespaceURI?null:r.namespaceURI;if(3==r.nodeType)e.push(new yr(r.nodeValue));else if(8!=r.nodeType){let t={};for(let e=0,s=r.attributes.length;e<s;e++){let s=r.attributes[e];t[s.name]=s.value}e.push(new vr(r.tagName,{attributes:t},wr(r.childNodes),null,i))}}return e}}class br{constructor(t,e={}){const{window:s,document:r}=Ss,i=e.window||s,n=Ss.vdom,o=void 0===e.delay?32:e.delay,a=e.document||r,h=[];var c,l,u,d="string"==typeof t?a.querySelector(t):t;d||(d=a.createElement("div"),a.body.appendChild(d)),d.children&&d.children[0]&&(l=wr(d.children)[0],u=d.children[0]);const p=t=>Promise.resolve("function"==typeof t?t():t);this.render=async(t,e)=>{if(e&&h.push(e),!c){if(!l)return l=await p(t),u=n.create(l,{document:a}),d.appendChild(u),c=!1,h.map(t=>t()),void(h.length=0);c=!0,i.setTimeout(()=>{(t=>{p(t).then(t=>{const e=n.diff(l,t);n.patch(u,e,{document:a}),l=t,c=!1,u=d.children[0],h.map(t=>t()),h.length=0})})(t)},o)}}}}const{_:xr}=Ss;class Er{constructor(t,e,s,r){this.tree=e,this.context=r,this.resolver=s,this.view=new br(t,{delay:0}),this._render()}async resolve(t){const e=this.resolver;if(e){const s="function"==typeof e?e(t):e,r=await Promise.resolve(s);xr.isPlainObject(r)&&Object.keys(r).forEach(e=>{t[e]=r[e]})}return t}render(){this._renderView()}get id(){return this.context.id}update(t,e,s){this.tree=t,this.resolver=e,this.context=s,this._render()}_render(){const t=t=>{var e=this.tree;return"function"==typeof e&&(e=e(t)),gr("div",{attributes:{class:"view-container"},key:`container-${this.id}`},e)};var e,r;const i=t=>{clearTimeout(r),e=t,t[o]=this;var i=t[s](null,this.context);const a=()=>{this.view.render(t.vnode,()=>{this.view.rendering=!1})};if(i&&i.length)return Promise.all(i||[]).then(t=>{a()}).catch(n);a()};this._renderView=()=>{i(e)};const n=t=>{clearTimeout(r);const e=gr("div",{attributes:{class:"error"},key:`error-${this.id}`},["error...",t.message]);i(e)};this.resolver?(r=setTimeout(()=>{const t=gr("div",{attributes:{class:"loading"},key:`loading-${this.id}`},["loading..."]);i(t)},16),setTimeout(()=>{this.resolve(this.context).then(e=>{i(t(e))}).catch(n)})):i(t(this.context))}}er.register("view",class extends er{constructor(t,e,s){super(t,e,[]),this.tree=s}get id(){return this.context.id}get resolver(){return this[c].logic.get("expr")}created(t){this.el=t,this.view=new Er(t,this.tree,this.resolver,this.context)}updated(t,e){this.view=e&&e.comp.view,this.context.site.treeChanged?this.view.update(this.tree,this.resolver,this.context):(this.view.context=this.context,this.view.render())}render(){this.view&&this.view.render()}tick(){}},"logic");class _r extends Ts{constructor(t,e,s){super(),this.innerHTML=s}init(){return this.tmpl=document.createElement("div"),this.tmpl.style.display="contents",this.tmpl.innerHTML=this.innerHTML.join("\n"),this.tmpl}update(t,e){this.tmpl=t.tmpl;var s=this.innerHTML.join("\n");return this.tmpl.innerHTML=s,this.tmpl}destroy(){}get vnode(){return this}}class kr extends Ts{constructor(t,e,s){super(),this.innerText=s}init(){return this.tmpl=document.createElementNS("tspan"),this.tmpl.textContent=this.innerText.join("\n"),this.tmpl}update(t,e){this.tmpl=t.tmpl;var s=this.innerText.join("\n");return this.tmpl.textContent=s,this.tmpl}destroy(){}get vnode(){return this}}_r.prototype.type="Widget",kr.prototype.type="Widget",er.register("content",_r,"html"),er.register("content",kr,"svg"),er.register("route",class extends sr{[s](){var t=this[i],e=this.context.router,r=this[c].logic,n=e.matches(r);if(n){let e=this.context;return e.route=n,super[s](t(e,n))}}},{ns:"html"});const Sr=Symbol("events");class Or{bind(t,e){this[Sr]=this[Sr]||{},this[Sr][t]=this[Sr][t]||[],this[Sr][t].push(e)}unbind(t,e){this[Sr]&&t in this[Sr]!=0&&this[Sr][t].splice(this[Sr][t].indexOf(e),1)}unbindAll(){if(this[Sr]){for(const t of Object.keys(this[Sr]))for(const e of this[Sr][t])this.unbind(t,e);delete this[Sr]}}trigger(t,...e){if(this[Sr]&&t in this[Sr]!=0)for(const s of this[Sr][t])s.apply(this,e)}}const{window:Tr,document:Cr}=Ss;class Nr extends Error{constructor(t,e,s={}){super(s.message||s.error||t),this.length=0,this.status=s.status||e,this.code=s.code||"Error",this.data=s,this.errors=new Map(s.errors||[])}toString(){return`${this.code}: ${this.message}`}get(t){return this.errors.get(t)}has(t){return this.errors.has(t)}}class Mr extends Error{constructor(t,e={},s=500){super(t),this.status=s,this.errors=e}}class Ar extends Or{headers(t={},e={}){var s=Object.assign({Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},t);if(e)switch(e.value){case"html":s.Accept=s["Content-Type"]="text/html";break;case"text":s.Accept=s["Content-Type"]="text/plain"}return this.token&&(s.Authorization=`Bearer ${this.token}`),s}options({method:t="GET",credentials:e="include",data:s,headers:r,response:i}){var n={method:t,credentials:e,headers:this.headers(r,i)};return s instanceof FormData?delete n.headers["Content-Type"]:s=JSON.stringify(s),s&&(n.body=s),n}post(t,e,s={}){return s.method="POST",s.data=e,this.send(t,s)}get(t,e={}){return e.method="GET",this.send(t,e)}put(t,e,s={}){return s.method="PUT",s.data=e,this.send(t,s)}async query(t,e,s){"string"==typeof e&&(e={query:e});const r=await this.post(t,e,{});if(r.errors){let t=500;for(const e of r.errors)"Authentication required"==e.message&&(t=401);throw new Mr("Fetch error",r.errors,t)}return r.data}send(t,e={}){var s=this.options(e);return Tr.fetch(t,s).then(function(t){return t.json().then(function(e){if(t.status>=200&&t.status<300)return e;throw new Nr(t.statusText,t.status,e)})}).catch(t=>{throw t})}}var jr=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function Pr(t,e){for(var s,r=[],i=0,n=0,o="",a=e&&e.delimiter||"/",h=e&&e.delimiters||"./",c=!1;null!==(s=jr.exec(t));){var l=s[0],u=s[1],d=s.index;if(o+=t.slice(n,d),n=d+l.length,u)o+=u[1],c=!0;else{var p="",f=t[n],g=s[2],m=s[3],v=s[4],y=s[5];if(!c&&o.length){var w=o.length-1;h.indexOf(o[w])>-1&&(p=o[w],o=o.slice(0,w))}o&&(r.push(o),o="",c=!1);var b=""!==p&&void 0!==f&&f!==p,x="+"===y||"*"===y,E="?"===y||"*"===y,_=p||a,k=m||v;r.push({name:g||i++,prefix:p,delimiter:_,optional:E,repeat:x,partial:b,pattern:k?Rr(k):"[^"+Lr(_)+"]+?"})}}return(o||n<t.length)&&r.push(o+t.substr(n)),r}function Lr(t){return t.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function Rr(t){return t.replace(/([=!:$/()])/g,"\\$1")}function $r(t){return t&&t.sensitive?"":"i"}function Ir(t,e,s){return t instanceof RegExp?function(t,e){if(!e)return t;var s=t.source.match(/\((?!\?)/g);if(s)for(var r=0;r<s.length;r++)e.push({name:r,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,pattern:null});return t}(t,e):Array.isArray(t)?function(t,e,s){for(var r=[],i=0;i<t.length;i++)r.push(Ir(t[i],e,s).source);return new RegExp("(?:"+r.join("|")+")",$r(s))}(t,e,s):function(t,e,s){return function(t,e,s){for(var r=(s=s||{}).strict,i=!1!==s.start,n=!1!==s.end,o=Lr(s.delimiter||"/"),a=s.delimiters||"./",h=[].concat(s.endsWith||[]).map(Lr).concat("$").join("|"),c=i?"^":"",l=0===t.length,u=0;u<t.length;u++){var d=t[u];if("string"==typeof d)c+=Lr(d),l=u===t.length-1&&a.indexOf(d[d.length-1])>-1;else{var p=d.repeat?"(?:"+d.pattern+")(?:"+Lr(d.delimiter)+"(?:"+d.pattern+"))*":d.pattern;e&&e.push(d),d.optional?d.partial?c+=Lr(d.prefix)+"("+p+")?":c+="(?:"+Lr(d.prefix)+"("+p+"))?":c+=Lr(d.prefix)+"("+p+")"}}return n?(r||(c+="(?:"+o+")?"),c+="$"===h?"$":"(?="+h+")"):(r||(c+="(?:"+o+"(?="+h+"))?"),l||(c+="(?="+o+"|"+h+")")),new RegExp(c,$r(s))}(Pr(t,s),e,s)}(t,e,s)}class Dr extends Error{constructor(t){super(t),this.aborted=!0}}class zr{constructor(t,e,s){var r;this.conf=t,this.router=e,this.parent=s,this.re=new RegExp(t.re||"","i"),r=(t.tokens||[]).map(t=>{try{return JSON.parse(t||"")}catch(e){return t}}),this._params=t.keys.reduce((t,e)=>(t[e]="",t),{}),this.toPath=function(t){for(var e=new Array(t.length),s=0;s<t.length;s++)"object"==typeof t[s]&&(e[s]=new RegExp("^(?:"+t[s].pattern+")$"));return function(s,r){for(var i="",n=r&&r.encode||encodeURIComponent,o=0;o<t.length;o++){var a=t[o];if("string"!=typeof a){var h,c=s?s[a.name]:void 0;if(Array.isArray(c)){if(!a.repeat)throw new TypeError('Expected "'+a.name+'" to not repeat, but got array');if(0===c.length){if(a.optional)continue;throw new TypeError('Expected "'+a.name+'" to not be empty')}for(var l=0;l<c.length;l++){if(h=n(c[l],a),!e[o].test(h))throw new TypeError('Expected all "'+a.name+'" to match "'+a.pattern+'"');i+=(0===l?a.prefix:a.delimiter)+h}}else if("string"!=typeof c&&"number"!=typeof c&&"boolean"!=typeof c){if(!a.optional)throw new TypeError('Expected "'+a.name+'" to be '+(a.repeat?"an array":"a string"));a.partial&&(i+=a.prefix)}else{if(h=n(String(c),a),!e[o].test(h))throw new TypeError('Expected "'+a.name+'" to match "'+a.pattern+'", but got "'+h+'"');i+=a.prefix+h}}else i+=a}return i}}(r),this.response={}}get url(){return this.conf.url}get methods(){return this.conf.methods}get keys(){return this.conf.keys}get params(){return this._params}set params(t){Object.assign(this._params,t)}set(t){Object.assign(this.response,t)}unset(){delete this.error,this.response={}}async resolve(t=this.params,e={}){this.unset(),this.params=t,this.loading=!0;const s=this.conf;try{var r=this.parent?await this.parent.resolve(t,e):{},i=!0===s.resolve?i=s=>this.fetch(t,e):t=>"function"==typeof s.resolve?s.resolve(this):s.resolve||{};this.set(Object.assign(r,await i()))}catch(t){throw this.error=t,t}return this.loading=!1,this.response}toUrl(t){return this.toPath(t)}fetch(t=this.params,e={}){this.aborted=!1;var s=this.toUrl(t);return this.router.resolve(s,Object.assign({route:this},e)).then(t=>{if(this.aborted)throw this.aborted=!1,new Dr("Route change aborted");return t})}abort(){this.aborted=!0}}class Fr extends Or{constructor(t,e){super(),this.root="",this.site=e,this.routes=t;const{window:s,document:r}=Ss;var i=(t,e)=>{const{location:r}=s;var i=t&&t.path||r.pathname;i=this.getPath(i);var n=this.find(i)||this.tempRoute();this.resolveRoute(n).then(()=>{this.trigger("change",n)})};const n=t=>{t.preventDefault(),i(t.state)};s.addEventListener("load",t=>{const{history:e}=s;e&&(e.state&&"default"===e.state.state||i(e.state))}),s.addEventListener("popstate",n),this.destroy=()=>{s.removeEventListener("popstate",n),this.unbindAll()}}set routes(t){Array.isArray(t)||(t=Object.keys(t).map(e=>this.createRoute(e,t[e])));var e=(t,s,r)=>{var i=new zr(s,this,r);return t.push(i),s.children&&s.children.map(s=>e(t,s,i)),t};this._routes=(t||[]).reduce((t,s)=>e(t,s),[])}get routes(){return this._routes}createRoute(t,e={}){const{resolve:s,routes:r}=e,i=[],n=Pr(t),o=Ir(t,i);let a;return r&&(a=Object.keys(r).map(e=>this.createRoute(t+e,r[e]))),Object.assign({re:o,url:t,tokens:n,keys:i.map(t=>t.name),children:a},e)}tempRoute(t){const{location:e}=Ss.window;return new zr(this.createRoute(t||e.pathname,{resolve:!1}),this)}get hash(){return(window.location.hash||"").replace("#","")}find(t){return this.routes.find(e=>{var s=e.re.exec(t);if(s)return e.params=e.keys.reduce((t,e,r)=>(t[e]=s[r+1],t),{}),!0})}getPath(t){return t&&"/index"!=t&&"/home"!=t||(t="/"),t}get current(){return this.find(this.hash)}clearSlashes(t){return t.toString().replace(/\/$/,"").replace(/^\//,"")}add(t,...e){var s,r=new zr(t,this);return"function"==typeof e[0]?(e[0],s=e[1]):s=e[0],r.template=s,this.routes.push(r),r}remove(t){var e=this.routes.indexOf(t);e>=0&&this.routes.splice(e,1)}matches(t){var e=new zr(t,this),s=location.pathname,r=e.re.exec(s);if(r){return this.find(s)||(e.params=e.keys.reduce((t,e,s)=>(t[e]=r[s+1],t),{}),e)}}navigate(t="",e=!1){const{window:s,document:r}=Ss,{location:i,history:n,URL:o}=s;t=new o(t,i.origin);var a=this.getPath(t.pathname),h=this.find(a)||this.tempRoute(a);(e||this.loading!==h)&&(async t=>{n.pushState({path:a},null,a),await this.resolveRoute(t),t&&t.handler?t.handler(t):this.trigger("change",t),s.scrollTo(0,0)})(h)}get session(){return this.site.session}triggerEvent(...t){this.site.triggerEvent(...t),this.trigger(...t)}resolveAuth(t={}){return new Promise((t,e)=>{const s=()=>{this.triggerEvent("auth:start",{}),this.navigate(this.session.options.login)},r=()=>{this.triggerEvent("auth:end",{}),this.session.unbind("success",r),t()},i=()=>{this.session.unbind("success",r),this.session.unbind("cancel",i),this.triggerEvent("auth:cancel",{}),e(new Error("Auth Cancelled"))};this.session.bind("success",r),this.session.bind("cancel",i),this.session.authenticate().then(t=>{t?r():s()},t=>{s()}).catch(t=>{s()})})}resolveRoute(t){this.loading&&this.loading.abort(),this.loading=t,this.site.setScope({loading:!0,error:null}).render({clean:!0});const e=async()=>{try{return await t.resolve(),this.site.setScope({loading:!1}),t}catch(t){if(t.aborted,401===t.status)try{return await this.resolveAuth(),e()}catch(e){this.site.setScope({loading:!1,error:t}).render({clean:!0})}else this.site.setScope({loading:!1,error:t}).render({clean:!0})}finally{this.loading===t&&(this.loading=null)}};return e()}resolve(t,e){return this.site.resolveUrl(t,e)}}const qr=Symbol("info");class Wr extends Error{}class Vr extends Or{constructor(t,e){super(),this[T]=t,this[S]=e,Object.keys(t).forEach(e=>{Object.defineProperty(this,e,{get:function(){return t[e]},set:function(s){t[e]=s}})})}get _data(){return this[T]}get site(){return this[S]}get savedInfo(){if(!this[qr])try{this[qr]=JSON.parse(localStorage.getItem("user")||"{}")}catch(t){this[qr]={}}return this[qr]}get authenticated(){var t=this.savedInfo;return!(!t||!t._id)}get confirm_password(){return this._confirm_password||""}set confirm_password(t){this._confirm_password=t}get username(){var t=this.savedInfo;return this._data.email||t.email}set username(t){this._data.email=t}get id(){return this._data._id}set id(t){this._data._id=t}getCredentials(){return new Promise((t,e)=>{window.PasswordCredential||window.FederatedCredential?navigator.credentials.get({password:!0,mediation:"optional"}).then(t,e):e(new Wr("No Credential Support"))})}login(){return this.getCredentials()}persist(){if((window.PasswordCredential||window.FederatedCredential)&&this.username&&this.password){var t=new PasswordCredential({id:this.username,name:this.username,password:this.password});return navigator.credentials.store(t).then(()=>{this.password=null})}}save(t){t?(this.id=t._id,this.persist(),localStorage.setItem("user",JSON.stringify(t)),this[qr]=null):this.remove()}remove(){navigator.credentials&&navigator.credentials.preventSilentAccess&&navigator.credentials.preventSilentAccess(),localStorage.removeItem("user"),this[qr]=null}toJSON(){return this._confirm_password?Object.assign({confirm_password:this._confirm_password},this._data):this._data}}class Ur extends Or{constructor(t,e={}){super(),this[S]=t,this[k]=Object.assign({login:"/auth/login",signup:"/auth/signup",logout:"/auth/logout",forgotPass:"/auth/forgot_password"},e),this.user=e.user||new Vr({type:"guest",name:"anonymous",email:"",password:""})}get options(){return this[k]}get site(){return this[S]}get request(){return this.site.request}get isLoggedIn(){return this.user.authenticated}get error(){return this[O]}set error(t){this[O]=t}authenticate(t){return this.user.login().then(t=>t?(this.user.username=t.name,this.login({username:t.name,password:t.password}).then(()=>t)):null)}_success(){let t=this.onSuccess;if(this.trigger("success"),t)return this.onSuccess=null,t();this.site.navigateTo("/")}login(t){this.user.remove(),this.error=null;var e=this.request,s=t||this.user.toJSON();return e.post(this.options.login,s).then(t=>(t&&t.loggedIn&&this.user.save(t.user),this.request.token=t.token,this._success(),t))}logout(){return this.request.post(this.options.logout,{}).then(t=>(this.request.token=null,this.user.remove(),this.trigger("logout"),t))}signup(t={}){var e={};if(this.user.remove(),this.error=null,t.formdata){var s=document.querySelector(t.formdata);s&&(e=lr(s,{hash:!0}))}else e=this.user.toJSON();return Array.isArray(t.params)&&t.params.forEach(({key:t,val:s})=>{t&&(e[t]=s)}),this.request.post(this.options.signup,e).then(t=>(t&&t.success&&this.user.save(t.user),this.request.token=t.token,this._success(),t)).catch(t=>{throw this.error=t,t})}forgotPassword(t){return this.request.post(this.options.forgotPass,t).then(t=>t).catch(t=>{throw this.error=t,t})}resetPassword(t,e){return this.request.post(t,e).then(t=>t).catch(t=>{throw this.error=t,t})}cancel(){this.trigger("cancel")}}const Hr=new Map;class Br{static get(t,e){if(Hr.has(t))return Hr.get(t);var s=new Br(t,e);return Hr.set(t,s),s}static include(t){return function e(s,r){var i={h:gr,inc:e},{src:n}=s,o=t[n];return o?o(s.scope||r,i):gr("div",{__scope:s.scope||r,attributes:{class:"error"}},[`Included file not found. ${n}`])}}constructor(t,e){this.app=e,this.src=t}load(){var t=this.src;return this.source=this.app.views[t],this.source}render(t,e={}){var s=[],r=(t,e)=>gr("div",{attributes:{class:"error"}},[e.message]),i=this.load();if(!i)return r(0,new Error(`Template error: ${this.src} could not be found`));var n=Br.include(this.app.views);s=s.concat(Object.keys(e).map(s=>{var r=e[s];if(r instanceof Promise)return r.then(e=>{t[s]=e});t[s]=r}).filter(t=>!!t));var o=t=>i(t,{h:gr,inc:n});return gr("div",{attributes:{}},s.length?Promise.all(s).then(()=>o(t)).catch(t=>r(0,t)):o(t))}}const{_:Xr}=Ss;class Gr extends Or{constructor(t,e,s={}){super(),this.root=t,this.views=e,this.currentPageId="index.html",this.request=new Ar,this.session=new Ur(this,s.session),this.router=new Fr(s.routes||[],this),s.sse&&(this.sse=new EventSource("/sse"),this.sse.addEventListener("message",t=>{},!1),this.sse.addEventListener("open",t=>{},!1)),this.router.bind("change",t=>{var e;t&&(e=t.template),this.scope.route=t,this.render({page:e||"index.html",clean:!0})})}set scope(t){t instanceof Ds||(t=new Ds(t,this)),this[m]=t}get scope(){return this[m]||(this[m]=new Ds({},this)),this[m]}get views(){return this._views}set views(t){this._views=t}getTemplate(t){return Br.get(t,this)}navigateTo(t,e=!0){this.router.navigate(t,e)}changeState(){}setErrorState(){}removeState(){}triggerEvent(...t){this.trigger(...t)}send(t,e={}){return this.resolveUrl(t,e)}resolveUrl(t,e={}){return new Promise((s,r)=>{const i=n=>{var o;o=e.route?()=>{this.navigateTo(e.route.url,!0)}:()=>{this.request.send(t,e).then(s,i).catch(i)},this.session.onSuccess=o;const a=()=>{r(n),this.triggerEvent("auth:start",{}),this.navigateTo(this.session.options.login)},h=()=>{this.triggerEvent("auth:end",{}),this.session.unbind("success",h)},c=()=>{this.session.unbind("success",h),this.session.unbind("cancel",c),this.triggerEvent("auth:cancel",{}),r(new Error("Auth Cancelled"))};401==n.status?(this.session.bind("success",h),this.session.bind("cancel",c),this.session.authenticate().then(t=>{t?h():a()},t=>{a()}).catch(t=>{a()})):r(n)};this.request.send(t,e).then(s,i).catch(i)})}setScope(t){return Object.assign(this.scope,t),delete this.vdom,this}resolvers(){return[]}onReady(){}getCurrentTemplate(t){const e=this.currentPageId,s=this.scope;return gr("div",{__scope:s,attributes:{class:"page",name:`${e}`}},(0,this.views[e])(s,t))}render(t={}){const{page:e=this.currentPageId,scope:r=this.scope,clean:i=!1}=t;var n;i&&(this.treeChanged=!0,delete this.vdom),this.currentPageId=e,this.view||(this.view=new br(this.root,{delay:30}));const o=Br.include(this.views);n={h:gr,Scope:Ds,inc:o},this.view.render(async()=>{const t=()=>this.vdom.vnode;if(!this.vdom){const e=await this.getCurrentTemplate(n),r=e._render.bind(e);e._render=Xr.debounce(i=>{r(),i&&e[s](),this.view.render(t)},20,{leading:!1}),this.vdom=e}const e=this.vdom,r=this.resolvers().concat(e[s]()).filter(t=>!!t),i=r=>(e[s](),this.view.render(t,()=>{}),r),o=t=>{throw t};if(r.length){var a=r;await Promise.all(a).then(()=>{}).then(i).catch(o)}return e.vnode},()=>{this._ready||(this._ready=!0,this.onReady()),this.treeChanged=!1,this.run(),t.callback&&t.callback()})}}var Yr={Component:er,Modifier:As,h:gr,View:br,Router:Fr,Util:fr,Tag:class{static define(t,e,s={}){tr.define(t,e,s)}static register(t,e,s={}){tr.define(t,e,s)}constructor(t,e){this.elem=t,this.props=e}[y](t,e,s){return this.props=t,this[w]=null,s&&(this.scope=Object.assign(e.context,s.context),this.updated&&this.updated()),this[w]=e,this}set(t){}render(){if(!this[w])throw new Error("Invalid render call. You must not call render from a lifecycle callback");this[w].render()}}};const Jr=new WeakMap;function Kr(t){var e,s=Jr.get(t);return s||(s={bind(t,s){e||(e={}),e[t]=e[t]||[],e[t].push(s)},unbind(t,s){e&&t in e!=0&&e[t].splice(e[t].indexOf(s),1)},unbindAll(){if(e){for(const t of Object.keys(e))for(const s of e[t])this.unbind(t,s);e=null}},trigger(t,...s){if(e&&t in e!=0)for(const r of e[t])r.apply(this,s)}},Jr.set(t,s)),s}class Qr{static getEmitter(t){return Kr(t)}bind(t,e){Kr(this).bind(t,e)}unbind(t,e){Kr(this).unbind(t,e)}unbindAll(){Kr(this).unbindAll()}trigger(t,...e){Kr(this).trigger(t,...e)}}const Zr="SITE,PAGE,NAME,PARENT,CONF,NODES,HOOKS,STYLES,CONTEXTS,STATES,TICKS,ERROR,OPTIONS,\nCHILDREN,VERSIONS,DESCR,FOLDERS,CURRENT,INDEX,CACHE,HOST,KEY,PREV_KEY,EXEC,CTXID,EL,CONNECTION\nMETHODS,DATA,CHANGES,SRCSET,ROUTE,WORKER".split(",").reduce((t,e)=>(t[e]=Symbol.for(e.trim()),t),{}),ti={DEFAULT:"default",ATTRIBS:"attribs",CANVAS:"canvas",SVG:"SVG",VR:"vr",WEBGL:"webgl",HTML:"html",TRANSITION:"transition",DEFAULT_STATES:["default","error","auth_required","loading"]},{DESCR:ei,NODES:si,PAGE:ri,SITE:ii,PARENT:ni,CONF:oi}=Zr,ai={};class hi extends Qr{static get entities(){return ai}static hasInstance(t){return t in ai}static getInstance(t,e){const s=t.id||t._id;var r=e.klass?e.klass:this;if(ai[s]&&ai[s]instanceof r){var i=ai[s];return i.setArgs(e),i.refresh(t),i}var n=new r(t,e);return ai[s]=n,n}static getEntity(t){return ai[t.id||t._id]}constructor(t,e){super(),this.conf=t||{},this.setArgs(e||{})}refresh(t){this.conf=t,this[si]=null}setArgs(t){this[ri]=t.page,this[ii]=t.site,this[ni]=t.parent}get site(){return this[ii]}set site(t){this[ii]=t}get page(){return this[ri]}set page(t){this[ri]=t}get parent(){return this[ni]}set parent(t){this[ni]=t}get conf(){return this[oi]}set conf(t){this[oi]=t}get ns(){return this.conf.ns}get id(){return this.conf.id}get type(){return this.conf.type}get name(){return this.conf.name}toJSON(){return this[ei]?this[ei].reduce((t,e)=>(t[e]=this[e],t),{}):this}}var ci=/^(?:submit|button|image|reset|file)$/i,li=/^(?:input|select|textarea|keygen)/i,ui=/(\[[^\[\]]*\])/g;function di(t,e,s){if(0===e.length)return s;var r=e.shift(),i=r.match(/^\[(.+?)\]$/);if("[]"===r)return t=t||[],Array.isArray(t)?t.push(di(null,e,s)):(t._values=t._values||[],t._values.push(di(null,e,s))),t;if(i){var n=i[1],o=+n;isNaN(o)?(t=t||{})[n]=di(t[n],e,s):(t=t||[])[o]=di(t[o],e,s)}else t[r]=di(t[r],e,s);return t}function pi(t,e,s){if(e.match(ui))di(t,function(t){var e=[],s=new RegExp(ui),r=/^([^\[\]]*)/.exec(t);for(r[1]&&e.push(r[1]);null!==(r=s.exec(t));)e.push(r[1]);return e}(e),s);else{var r=t[e];r?(Array.isArray(r)||(t[e]=[r]),t[e].push(s)):t[e]=s}return t}function fi(t,e,s){return s=s.replace(/(\r)?\n/g,"\r\n"),s=(s=encodeURIComponent(s)).replace(/%20/g,"+"),t+(t?"&":"")+encodeURIComponent(e)+"="+s}function gi(t){return t&&"object"==typeof t&&!Array.isArray(t)&&null!==t}function mi(t,...e){if(gi(t))for(const s of e)if(gi(s))for(const e in s)gi(s[e])?(t[e]||Object.assign(t,{[e]:{}}),mi(t[e],s[e])):Object.assign(t,{[e]:s[e]});return t}const vi={toTime(t){const e=new Date(null);return e.setSeconds(t),e.toISOString().substr(11,8)},strftime:(t=0,e="%H:%M:%S")=>function(t,e){e instanceof Date||(e=new Date(e||Date.now()));var s=e.getDay(),r=e.getDate(),i=e.getMonth(),n=e.getFullYear(),o=e.getHours(),a=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],h=["January","February","March","April","May","June","July","August","September","October","November","December"],c=function(){var t=new Date(e);return t.setDate(r-(s+6)%7+3),t},l=function(t,e){return(""+(Math.pow(10,e)+t)).slice(1)};const u={"%a":a[s].slice(0,3),"%A":a[s],"%b":h[i].slice(0,3),"%B":h[i],"%c":e.toUTCString(),"%C":Math.floor(n/100),"%d":l(r,2),"%e":r,"%F":e.toISOString().slice(0,10),"%G":c().getFullYear(),"%g":(""+c().getFullYear()).slice(2),"%H":l(o,2),"%I":l((o+11)%12+1,2),"%j":l([0,31,59,90,120,151,181,212,243,273,304,334][i]+r+(i>1&&(n%4==0&&n%100!=0||n%400==0)?1:0),3),"%k":""+o,"%l":(o+11)%12+1,"%m":l(i+1,2),"%M":l(e.getMinutes(),2),"%p":o<12?"AM":"PM","%P":o<12?"am":"pm","%s":Math.round(e.getTime()/1e3),"%S":l(e.getSeconds(),2),"%u":s||7,"%V":function(){var t=c(),e=t.valueOf();t.setMonth(0,1);var s=t.getDay();return 4!==s&&t.setMonth(0,1+(4-s+7)%7),l(1+Math.ceil((e-t)/6048e5),2)}(),"%w":""+s,"%x":e.toLocaleDateString(),"%X":e.toLocaleTimeString(),"%y":(""+n).slice(2),"%Y":n,"%z":e.toTimeString().replace(/.+GMT([+-]\d+).+/,"$1"),"%Z":e.toTimeString().replace(/.+\((.+?)\)$/,"$1")};return t.replace(/%[a-z]/gi,function(t){return u[t]||t})}(e,t),time(t=0,e="%H:%M:%S"){var s=Math.floor(t/60/60),r=Math.floor((t-60*s*60)/60),i=Math.floor(t-60*s*60-60*r);return e?e.replace(/%[a-z]/gi,function(t){return{"%H":(s+"").padStart(2,"0"),"%M":(r+"").padStart(2,"0"),"%S":(i+"").padStart(2,"0")}[t]||t}):(s>0?(s+"").padStart(2,"0")+":":"")+(r+"").padStart(2,"0")+":"+(i+"").padStart(2,"0")},wave(t,e){const s=e.pop()||1;e[0]=e[0]||0,e[1]=e[1]||1,e[2]=e[2]||0;const r=t.time/1e3+s;return TWEEN.Interpolation.Linear(e,r%1)},random:(t=-1,e=1)=>Math.random()*(e-t)+t,clamp:(t,e=-1/0,s=1/0)=>Math.min(Math.max(t,e),s),cycle(t,e=1/0,s=1/0){const r=s-e||1;return t<e&&(t+=r*(1+~~((e-t)/r))),e+(t-e)%r},remap:(t,e,s,r,i)=>(t-e)*(i-r)/(s-e)+r,round:(t,e=2)=>Number(t.toFixed(e)),round2:t=>Math.round(1e3*t/10)/100,uid:(t="k")=>t+("000000"+(Math.random()*Math.pow(36,6)|0).toString(36)).slice(-6),deepCopy(t={}){var e={};for(let s of Object.keys(t))"object"==typeof t[s]?e[s]=vi.deepCopy(t[s]):e[s]=t[s];return e},merge:(...t)=>mi(...t),parseUnit(t,e){e||(e=[0,""]),t=String(t);var s=parseFloat(t,10);return e[0]=s,e[1]=t.match(/[\d.\-\+]*\s*(.*)/)[1]||"",e},getContentDimensions(t){var e=0,s=0;return s=t.offsetLeft+t.offsetWidth,e=t.offsetTop+t.offsetHeight,function t(r){if(r)for(var i=r.length-1;i>=0;i--){let n=r[i];if(!n.tagName)continue;let o=n.offsetLeft||0+n.offsetWidth||0,a=n.offsetTop||0+n.offsetHeight||0;e=Math.max(a,e),s=Math.max(o,s);let h=window.getComputedStyle(n).overflow;"hidden"!=h&&"scroll"!=h&&"auto"!=h&&t(n.children)}}(t.childNodes),{width:s,height:e}},__getContentDimensions(t){var e=[],s=[],r=t.querySelectorAll("*:not(script,iframe)");for(let t=0,i=r.length;t<i;t++){let i=r[t];e.push(i.offsetTop||0+i.offsetHeight||0),s.push(i.offsetLeft||0+i.offsetWidth||0)}var i=Math.max.apply(Math,e);return{width:Math.max.apply(Math,s),height:i}},getFirstElement(t,e="__scrollable__"){return t.firstElementChild?t.firstElementChild:((s=document.createElement("div")).setAttribute("id",e),document.body.append(s),s);var s},measure(t,e){performance.now();var s=e();return performance.now(),s},isEqual:function t(e,s){if(e===s)return!0;var r=Array.isArray(e),i=Array.isArray(s);if(r&&i){if(e.length!=s.length)return!1;for(var n=0,o=e.length;n<o;n++)if(!t(e[n],s[n]))return!1;return!0}if(r!=i)return!1;if(e&&s&&"object"==typeof e&&"object"==typeof s){var a=Object.keys(e);if(a.length!==Object.keys(s).length)return!1;var h=e instanceof Date,c=s instanceof Date;if(h&&c)return e.getTime()==s.getTime();if(h!=c)return!1;var l=e instanceof RegExp,u=s instanceof RegExp;if(l&&u)return e.toString()==s.toString();if(l!=u)return!1;for(n=0,o=a.length;n<o;n++)if(!Object.prototype.hasOwnProperty.call(s,a[n]))return!1;for(n=0,o=a.length;n<o;n++)if(!t(e[a[n]],s[a[n]]))return!1;return!0}return!1},isObject:gi,observeResize:function(t,e){var s=!1,r=function(e){s&&t(e),s=!0},i=new ResizeObserver(r);for(let t of e)t===window?window.addEventListener("resize",r,!0):i.observe(t);return i.destroy=function(){for(let t of e)t===window?window.removeEventListener("resize",r,!0):i.unobserve(t)},i},serialize:function(t,e){"object"!=typeof e?e={hash:!!e}:void 0===e.hash&&(e.hash=!0);for(var s=e.hash?{}:"",r=e.serializer||(e.hash?pi:fi),i=t.querySelectorAll("input, select, textarea"),n=Object.create(null),o=0;o<i.length;++o){var a=i[o];if((e.disabled||!a.disabled)&&a.name&&li.test(a.nodeName)&&!ci.test(a.type)){var h=a.name,c=a.value;if("checkbox"!==a.type&&"radio"!==a.type||a.checked||(c=void 0),e.empty){if("checkbox"!==a.type||a.checked||(c=""),"radio"===a.type&&(n[a.name]||a.checked?a.checked&&(n[a.name]=!0):n[a.name]=!1),null==c&&"radio"==a.type)continue}else if(!c)continue;if("select-multiple"!==a.type)s=r(s,h,c);else{c=[];for(var l=a.options,u=!1,d=0;d<l.length;++d){var p=l[d],f=e.empty&&!p.value,g=p.value||f;p.selected&&g&&(u=!0,s=e.hash&&"[]"!==h.slice(h.length-2)?r(s,h+"[]",p.value):r(s,h,p.value))}!u&&e.empty&&(s=r(s,h,""))}}}if(e.empty)for(var h in n)n[h]||(s=r(s,h,""));return s},humansize:function(t=0){if(0===(t=Math.abs(t)))return"0B";let e=Math.floor(Math.log(t)/Math.log(1024));return(t/Math.pow(1024,e)).toPrecision(3)+" "+(["B","K","M","G","T","P","E","Z","Y"][e]||"")},deepGet:function t(e,s,r){return(s=Array.isArray(s)?s:s.replace(/(\[(\d)\])/g,".$2").replace(/^\./,"").split("."))[0]in e?(e=e[s[0]])&&s.length>1?t(e,s.slice(1),r):e:r},deepSet:function(t,e,s){if((e=Array.isArray(e)?e:e.split(".")).length>1)return t[e[0]]=t[e[0]]||{},setProp(t[e[0]],e.slice(1),s);t[e[0]]=s}};class yi{constructor(t=0,e=0){this.x=t,this.y=e}set(t){return t?(this.x=+t.x||+t.left||0,this.y=+t.y||+t.top||0,this):this}add(t){return t?(this.x+=+t.x||+t.left||0,this.y+=+t.y||+t.top||0,this):this}sub(t){return t?(this.x-=+t.x||+t.left||0,this.y-=+t.y||+t.top||0,this):this}copy(){return new yi(this.x,this.y)}angleFrom(t){return 180*Math.atan2(this.y-t.y,this.x-t.x)/Math.PI}distanceFrom(t){return Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))}toPercent(t){return new yi(this.x/t.width*100,this.y/t.height*100)}getQuadrant(t){const e=t.width,s=t.height,r=(this.x-e/2)*(e>s?s/e:1),i=(this.y-s/2)*(s>e?e/s:1);return Math.round((Math.atan2(i,r)*(180/Math.PI)+180)/90+3)%4}}const wi=Symbol("ctxt"),bi=Symbol(),xi=Symbol();class Ei extends yi{static toPoint(t){var e={x:0,y:0};return 0===t.type.indexOf("touch")?(e.x=t.changedTouches[0].pageX,e.y=t.changedTouches[0].pageY):(e.x=t.clientX+window.pageXOffset,e.y=t.clientY+window.pageYOffset),e}constructor(){super(),this.start=new yi,this.delta=new yi,this.layer=new yi,this.layer.start=new yi,this.percent=new yi,this.layer.percent=new yi,this.delta.percent=new yi,this.quadrant=this.layer.quadrant=0,this.angle=this.layer.angle=this.delta.angle=0,this.distance=this.layer.distance=this.delta.distance=0,this.params={}}set[Symbol.for("start")](t){this[xi]=this.delta.copy(),this[bi]=this[wi].bounds,this.layer.bounds=this[bi],this.start.set(Ei.toPoint(t)),this.layer.start.set(this.start).sub(this[bi])}set[Symbol.for("end")](t){this.set(Ei.toPoint(t));var e=this[bi]||this[wi].bounds;this.bounds=this[wi].window,this.layer.bounds||(this.layer.bounds=e),this.delta.set(this).sub(this.start).add(this[xi]),this.layer.set(this).sub(e);var s=this.bounds.center,r=new yi(this.layer.bounds.width/2,this.layer.bounds.height/2);this.layer.quadrant=this.quadrant=this.layer.getQuadrant(this.layer.bounds),this.angle=this.angleFrom(s),this.delta.angle=this.delta.angleFrom(s),this.layer.angle=this.layer.angleFrom(r),this.distance=this.distanceFrom(s),this.delta.distance=this.delta.distanceFrom(s),this.layer.distance=this.layer.distanceFrom(r),this.percent.set(this.toPercent(this.bounds)),this.layer.percent.set(this.layer.toPercent(this.layer.bounds)),this.delta.percent.set(this.delta.toPercent(this.bounds)),t.detail&&Object.assign(this,t.detail)}setEvent(t,e){this[Symbol.for(t)]=e}get context(){}set context(t){this[wi]=t}}const{TWEEN:_i}=Ss,{HOOKS:ki,INDEX:Si,PARENT:Oi,DESCR:Ti,CTXID:Ci,EL:Ni,ERROR:Mi,NAME:Ai,CONNECTION:ji,CHANGES:Pi,WORKER:Li}=Zr,Ri=new WeakMap,$i=new WeakMap,Ii=new WeakMap,Di=new WeakMap,zi={};class Fi{constructor(t){this[Ti]=t}toJSON(){return this[Ti].reduce((t,e)=>(t[e]=this[e],t),{})}}class qi extends Fi{constructor(){super(["visibilityState","characterSet"])}get visibilityState(){return Ss.document.visibilityState}get characterSet(){return Ss.document.characterSet}}class Wi extends Fi{constructor(){super("width,height,left,top,availTop,availLeft,availHeight,availWidth,colorDepth,orientation,pixelDepth".split(",")),this[Ti].map(t=>{Object.defineProperty(this,t,{get:function(){return screen[t]}})})}}class Vi extends Fi{constructor(){super(["width","height","ratio","isLandscape","isPortrait","center"])}get center(){return new yi(Ss.window.innerWidth/2,Ss.window.innerHeight/2)}get width(){return Ss.window.innerWidth}get height(){return Ss.window.innerHeight}get ratio(){return Ss.window.innerWidth/Ss.window.innerHeight}get isLandscape(){return Ss.window.innerWidth>Ss.window.innerHeight}get isPortrait(){return Ss.window.innerWidth<=Ss.window.innerHeight}get orientation(){return this.isPortrait()?"portrait":"landscape"}}class Ui extends Fi{constructor(){super(["type","max","downlink","rtt","effectiveType"]);const{navigator:t}=Ss.window;this[ji]=t.connection||t.mozConnection||t.webkitConnection}get type(){return this[ji]?this[ji].type:"wifi"}get max(){return this[ji]?this[ji].downlinkMax:1/0}get downlink(){return this[ji]?this[ji].downlink:1/0}get rtt(){return this[ji]?this[ji].rtt:100}get effectiveType(){return this[ji]?this[ji].effectiveType:"4g"}}class Hi{constructor(t){this[Ni]=t,this.format=e=>vi.time(t.duration,e),this.format.toString=()=>vi.time(t.duration)}toString(){return this[Ni].duration||0}get time(){return this.format}toJSON(){return{time:this.time,format:this.format()}}}class Bi{constructor(t){this[Ni]=t,this.format=e=>vi.time(t.currentTime,e),this.format.toString=()=>vi.time(t.currentTime)}toString(){return this[Ni].currentTime||0}get percent(){return this[Ni].currentTime/this[Ni].duration*100}set percent(t){this[Ni].currentTime=t/100*this[Ni].duration}get time(){return this.format}set(t){this[Ni].currentTime=vi.clamp(t,0,this[Ni].duration)}toJSON(){return{format:this.format(),time:this.time,percent:this.percent}}}class Xi{constructor(t,e={}){Object.assign(this,{width:t.offsetWidth,height:t.offsetHeight,top:t.offsetTop,left:t.offsetLeft}),this.bottom=this.top+this.height,this.right=this.left+this.width;const s=t.offsetParent||document.body;for(var r=0,i=t.offsetParent;i;){var n=i.offsetLeft,o=i.offsetTop;isNaN(n)||isNaN(o)||(r+=n),i=i.offsetParent}this.x=r,this.y=r,this.position=new yi(this.x+this.left,this.y+this.top),this.center=new yi(this.x+this.left+this.width/2,this.y+this.top+this.height/2),this.percent={width:t.offsetWidth/s.offsetWidth*100,height:t.offsetHeight/s.offsetHeight*100}}}function Gi(e,s){if(e){var r,i,n;Ii.delete(e),Object.defineProperties(s,{nodeIndex:a(function(){if(void 0===n){if(!e.parentNode)return;n=[].indexOf.call((e.parentNode?e.parentNode.children||e.parentNode.childNodes:null)||[],e)}return n}),bounds:a(function(t,s){return e.getBoundingClientRect()}),initBounds:a(function(t,s){var r=Ii.get(e);return r||(r=e.getBoundingClientRect(),Ii.set(e,r)),r}),offset:a(function(){return r||(r=new Xi(e))}),dataset:a(function(){return e.dataset}),attrs:a(function(){if(i)return i;i={};for(var t=e.attributes,s=0,r=t.length;s<r;s++)i[t[s].name]=t[s].value;return i}),self:a(function(){return e})}),Object.defineProperty(s,"value",{configurable:!0,get:function(){return e.value}}),Object.defineProperty(s,"inView",{configurable:!0,get:function(){var t=s.offset.x-s.scroll.dy>s.window.height+200,e=s.offset.bottom-s.scroll.dy<-200;return!t&&!e}});var o=(e.nodeName||"").toLowerCase();return"audio"!=o&&"video"!=o||function(e,s){e.duration;var r=new Hi(e),i=new Bi(e),n={get:function(){return i},set:function(s){e.currentTime=vi.clamp(t,0,e.duration)}},o={playstate:{get:function(){return e.paused?0:1},set:function(t){e.play&&"function"==typeof e.play?t?e.play():e.pause():e.playstate=t}},paused:{get:function(){return e.paused},set:function(t){this.playstate=t}},muted:{get:function(){return e.muted},set:function(t){e.muted=!!t}},progress:n,currentTime:n,duration:{get:function(){return r},set:function(t){}},volume:{get:function(){return e.volume},set:function(t){e.volume=vi.clamp(t,0,1)}}};Object.keys(o).forEach(function(t){var e=o[t];e.configurable=!0,Object.defineProperty(s,t,e)})}(e,s),s}function a(t){return{configurable:!0,get:t}}}function Yi(t){if(t){var e=t.parentNode;if(e)return Ri.get(e)||Yi(e)}}const Ji=new Ei;var Ki={};class Qi extends Ds{static get(t,e,s){const r=Ri.get(t);if(r)return r;if(e){var i=s||Yi(t)||Ki.root,n=Object.create(i,{});return Object.assign(n,{}),n[Oi]=i,Gi(t,n),Ri.set(t,n),n}}static find(t){return Ki[t]}static clearCache(){Ki={}}static $create(t,e={},s={},r=null){var i=Ki[t];return i?(i.refresh&&i.refresh(),i):((i=new Qi(e,r,t)).id=t,i.$name(s.name||t),Ki[t]=i,s.root&&(Ki.root=i),i)}static $expose(t,e){var s=`$${t}`;Ki.root[s]=e}static valueAtPath(t){return _.get(Ki,t)}constructor(t,e,s){super(t,e,s)}$initialize(){const t=function(){const{renderer:t}=this;return!!t&&t.xr&&t.xr.isPresenting};Object.defineProperties(this,{files:{get:function(){return this.site.files}},mediaqueries:{get:function(){return this.site.mediaqueries}},States:{get:function(){return this.site.states}},session:{get:function(){return this.site.session}},user:{get:function(){return this.site.session.user}},isLoggedIn:{get:function(){return this.site.session.isLoggedIn}},isInVR:{get:t},isImmersive:{get:t}}),this.index=0,this.window=new Vi,this.screen=new Wi,this.document=new qi,this.network=new Ui,this.platform=Ss.window.platform||{},this.mouse={x:0,y:0,dx:0,dy:0,angle:0},this.scroll={x:0,y:0,dx:0,dy:0,yp:0,xp:0,progress:0,paused:0},this.Math=Math,this.Math.rand=vi.random,this.Util=vi,this.time=0,this._event=Ji,this.Easing=_i.Easing,this[Mi]=null}$name(t){if(!t)return this.hasOwnProperty(Ai)?this[Ai]:void 0;this[Ai]=t}getChanged(){var t=this[Pi];return this[Pi]=!1,t}setChanged(){this[Pi]=!0}get(t){return this.cache[t]}set(t,e){return this.cache[t]=e,e}setValue(t,e){return this[t]=e,e}get error(){return this[Mi]||{}}set error(t){this[Mi]=t}get event(){return this._event}set event(t){this._event=t}get root(){return Ki.root}set root(t){return Ki.root=t}get state(){return zi[this.id]||this.site.defaultState||"default"}set state(t){zi[this.id]=t}setState(t){t?zi[this.id]=t:delete zi[this.id]}get cache(){var t=$i.get(this);return t||(t={},$i.set(this,t)),t}get uid(){return this.id}get[ki](){var t=Di.get(this);return t||(t={},Di.set(this,t)),t}get style(){return this[ki].properties}unhook(t){Di.delete(this)}hook(t,e,s){Ri.set(t,this),Gi(t,this),this.refresh=()=>{Gi(t,this)}}$new(t,e=0,s={},r=null){var i=(void 0!==this.id?this.id+"_":"")+t+"_"+e,n=Ki[i];return n&&n.refresh?(n.refresh(),s.exp&&Qi.$expose(s.exp,n),r&&Object.assign(n,r),n):(n=Object.create(this),r&&Object.assign(n,r),n.id=i,n.parent=this,Ki[i]=n,s.exp&&Qi.$expose(s.exp,n),n.$name(s.exp||s.name||t),n)}$set(t,e){Ki[t]=e}}const{_:Zi,TWEEN:tn}=Ss;class en{constructor(t,e,s){this.entity=t,this.props=e,this.context=s,s=this.context,this.expr=new sn(this.props);var r=this.expr;this.tick=()=>{r.exec(s,s.style,s,this,sn.Utils)}}hook(t,e){this.expr,this.entity.addTick("exprs",t,this)}unhook(t){this.entity.removeTick("exprs",t,this)}}class sn{static hook(t,e,s){return new en(t,s,e)}constructor(t){this.conf=t,this._exec=this.conf.src,this.error=Zi.throttle((...t)=>{},5e3)}exec(t,e){if(this._exec)try{return this._exec(t,e,t,this,sn.Utils)}catch(t){this.error("expr error",t,this.conf.src)}else this.error("no _executable function in expression")}get anim(){return this.conf.anim}get utils(){return sn.Utils}}function rn(t,e,s){var r;return function(i,n,o,a){var h=t.y,c=t.x;if(void 0!==n&&(h=o?+n/100*ymax:+n),void 0!==i&&(c=o?+i/100*xmax:+i),h+c!=t.x+t.y)if(a&&a.animate){var l=a.animate,u=l.func,d=u&&"function"==typeof u?u:TWEEN.Easing.Quadratic.InOut;r&&r.stop(),r||(r=new TWEEN.Tween(t).easing(d)).onUpdate(function(){e(this.x,this.y,!0),s()}),r.to({x:c,y:h},+l.dur||1e3).delay(+l.delay||0).start()}else e(c,h)}}sn.Utils={CN:{M:"member",START:"start",END:"end",CLAMP:"clamp",SNAP:"snap",DECAY:"decay",FILTER:"filter"},clamp:(t,e,s,r,i,n,o)=>Math.min(Math.max(t,e),s),snap:(t,e)=>e?Math.round(t/e)*e:t,damping(t,e,s,r,i){if(t!=t)return 0;null===r.cache[s]&&(r.cache[s]=0);let n=r.cache[s]||0;if(n===t)return t;let o=+e;return o||(o=.2),o>1&&(o=1),n+=(t-n)*o,Math.abs(n-t)<.01&&(n=t),r.cache[s]=n,n},tween(t,e,s,r,i,n,o){let a,h;return n.cache[i]||(a={},n.cache[i]=a,a.end={val:t},a.start={val:0},a.tween=h=new tn.Tween(a.end),h.easing(r),h.onComplete(()=>h.playing=!1)),a=n.cache[i],h=a.tween,a.start.val!==t&&(a.start.val=t,h.to(a.start,e).delay(s).easing(r),h.playing||h.start()),a.end.val},math:(t,e,s,r)=>e?e(t):t,calc:(t,e,s)=>t,expression:(t,e,s,r)=>e,scale:(t,e,s,r,i,n,o,a)=>e&&s?t/s*e:t,flow:(t,e,s,r)=>e,imageUrl(t,e){let s=Global.s3Url;return e&&(s=Global.imgUrl),`${t}${e||""}`}},sn.DebugExpr=class{constructor(t){this._uid=t}get utils(){return sn.Utils}};const nn={y:{fr:1},x:{fr:1}};class on{constructor(t,e,s,r){this.conf=_.merge({},nn,s);const i=document.body,n=t||i,o=n===i?window:n,a=t?vi.getFirstElement(t):i,h=Object.assign({},e.scroll);e.scroll=h;var c=n.scrollHeight,l=n.scrollWidth;window.innerWidth,window.innerHeight,h.width=l,h.height=c;const u=t=>{var e=0,r=0;o===window?(e="pageYOffset"in window?window.pageYOffset||0:i.scrollTop||0,s.dirx&&(r="pageXOffset"in window?window.pageXOffset||0:i.scrollLeft||0)):(e=o.scrollTop,s.dirx&&(r=o.scrollLeft)),h.x=r,h.y=e};this.set=rn(h,function(t,e,s){o.scroll(t,e)}),this.tick=()=>{},o.addEventListener("scroll",u),this.destroy=()=>{"__scrollable__"===a.getAttribute("id")?a.remove():(a.style.height="",a.style.width=""),o.removeEventListener("scroll",u)}}}function an(t,e,s,r,i,n){return function(){Math.abs(t.dy-t.y)<.01&&(t.dy=t.y),Math.abs(t.dx-t.x)<.01&&(t.dx=t.x),t.dy+=(t.y-t.dy)*i,t.dx+=(t.x-t.dx)*r,t.yp=t.dy/s*100,t.xp=t.dx/e*100,n()}}const hn={y:{fr:1},x:{fr:1}},cn={y:{fr:1},x:{fr:1}};class ln{constructor(t,e,s,r){this.conf=_.merge({},cn,s);const i=document.body;"auto"!==(t&&window.getComputedStyle(t).getPropertyValue("overflow"))&&(t=i);const n=t||i,o=n===i?window:n,a=t?vi.getFirstElement(t):i,h=Object.assign({},e.scroll);e.scroll=h;var c,l=this.conf.x.fr||.01,u=this.conf.y.fr||.01,d=n.scrollHeight,p=n.scrollWidth;setTimeout(function(){var t=window.innerWidth,e=window.innerHeight;a.style.height="",a.style.width="",c=vi.getContentDimensions(a),d=c.height-e,p=c.width-t,a.style.height=c.height+"px",a.style.width=c.width+"px",h.width=p,h.height=d});const f=an(h,p,d,l,u,function(){}),g=t=>{var e=0,r=0;o===window?(e="pageYOffset"in window?window.pageYOffset||0:i.scrollTop||0,s.dirx&&(r="pageXOffset"in window?window.pageXOffset||0:i.scrollLeft||0)):(e=o.scrollTop,s.dirx&&(r=o.scrollLeft)),h.x=r,h.y=e};this.set=rn(h,function(t,e,s){o.scroll(t,e)},f),o.addEventListener("scroll",g,{passive:!0}),this.tick=()=>{f()},this.destroy=()=>{"__scrollable__"===a.getAttribute("id")?a.remove():(a.style.height="",a.style.width=""),o.removeEventListener("scroll",g)}}}function un(t,e){var s=function(t){var s=function(t){var e=0,s=0,r=0,i=0;return"detail"in t&&(s=t.detail),"wheelDelta"in t&&(s=-t.wheelDelta/120),"wheelDeltaY"in t&&(s=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=s,s=0),r=10*e,i=10*s,"deltaY"in t&&(i=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||i)&&t.deltaMode&&(1==t.deltaMode?(r*=40,i*=40):(r*=800,i*=800)),r&&!e&&(e=r<1?-1:1),i&&!s&&(s=i<1?-1:1),{x:e,y:s,pixelX:r,pixelY:i}}(t);t.delta=s,e(t)},r={capture:!1};this.attach=function(){t.addEventListener("DOMMouseScroll",s,r),t.addEventListener("mousewheel",s,r)},this.attach(),this.detach=function(){t.removeEventListener("DOMMouseScroll",s,r),t.removeEventListener("mousewheel",s,r)}}const dn={y:{fr:1},x:{fr:1}},pn={y:{fr:1,dist:100,move:"travel"},x:{fr:1,dist:100,move:"travel"}},fn={y:{fr:1},x:{fr:1}},gn={native:class{constructor(t,e,s,r){this.conf=_.merge({},hn,s);const i=document.body,n=t||i,o=n===i?window:n,a=t?vi.getFirstElement(t):i,h=r.container||a,c=Object.assign({},e.scroll);e.scroll=c;var l,u=this.conf.x.fr||.01,d=this.conf.y.fr||.01;setTimeout(function(){a.style.height="",a.style.width="";var t=vi.getContentDimensions(a),e=t.height,s=t.width,r=window.innerWidth,i=window.innerHeight;h.style.position="fixed",h.style.left=0,h.style.top=0,c.width=s-r,c.height=e-i,a.style.height=e+"px",a.style.width=s+"px"});const p=an(c,void 0,void 0,u,d,function(){var t=`translate3d(-${c.dx}px, ${-c.dy}px, 0)`;t!==l&&(h.style.transform=l=t)}),f=t=>{var e=0,r=0;o===window?(e="pageYOffset"in window?window.pageYOffset||0:i.scrollTop||0,s.dirx&&(r="pageXOffset"in window?window.pageXOffset||0:i.scrollLeft||0)):(e=o.scrollTop,s.dirx&&(r=o.scrollLeft)),c.x=r,c.y=e};this.set=rn(c,function(t,e,s){o.scrollTop-=e,o.scrollLeft-=t,o.scroll(t,e)},p),o.addEventListener("scroll",f,{passive:!0}),this.tick=()=>{p()},this.destroy=()=>{h.style.position="",h.style.left="",h.style.top="",h.style.transform="","__scrollable__"===a.getAttribute("id")?a.remove():(a.style.height="",a.style.width=""),o.removeEventListener("scroll",f)}}},translate:class{constructor(t,e,s,r){this.conf=_.merge({},dn,s);const i=document.body,n=t||i,o=t?vi.getFirstElement(t):i,a=r.container||o,h=e.scroll;var c,l,u,d,p,f,g,m=this.conf.x.fr||.01,v=this.conf.y.fr||.01;function y(t,e){h.y=vi.clamp(h.y,0,d),h.x=vi.clamp(h.x,0,p),h.x===t&&h.y===e||f&&f.setValues(h.x/-2,h.y/-2)}setTimeout(function(){l=window.innerWidth,u=window.innerHeight,o.style.height="",o.style.width="",c=vi.getContentDimensions(n),d=c.height-u,p=c.width-l,i.style.width=l+"px",i.style.height=u+"px",a.style.position="fixed",a.style.left=0,a.style.top=0,h.width=p,h.height=d,f=new Impetus({source:t||i,friction:.8,update:function(t,e){h.y=-2*e,y(h.x,h.y)}}),g=new un(n,function(t){t.preventDefault(),t.stopPropagation();var e=100*t.delta.y;h.y+=e;var s=100*t.delta.x;h.x+=s,y()})});const w=an(h,p,d,m,v,function(){h.dx,h.dy});this.set=rn(h,function(t,e,s){h.x=t,h.y=e,s&&(h.dx=t,h.dy=e),y(),f&&f.setValues(0,h.y/-2)},w);const b=function(t){40===t.keyCode?h.y+=100:38===t.keyCode&&(h.y-=100),y()};function x(t){t.preventDefault()}document.addEventListener("keydown",b,!1),i.addEventListener("touchmove",x),this.tick=()=>{w()},this.destroy=()=>{g.detach(),f.destroy(),a.style.transform="",i.removeEventListener("touchmove",x),document.removeEventListener("keydown",b,!1)}}},virtual:class{constructor(t,e,s,r){this.conf=_.merge({},pn,s),document.documentElement;const i=document.body,n=t||i,o=t?vi.getFirstElement(t):i,a=r.container||o,h=Object.assign({},e.scroll);var c,l,u,d;e.scroll=h;var p=this.conf.x.fr||.01,f=this.conf.y.fr||.01,g=this.conf.x.move,m=this.conf.y.move,v="move"===g,y="move"===m,w="fixed"===g,b="fixed"===m,x=0,E=0;function k(t,e){h.y=vi.clamp(h.y,0,x),h.x=vi.clamp(h.x,0,E),h.x===t&&h.y===e||u&&u.setValues(h.x/-2,h.y/-2)}setTimeout(function(){var e,r,o,p;c=window.innerWidth,l=window.innerHeight,a.getBoundingClientRect(),s.y&&([e,o]=vi.parseUnit(s.y.dist)),s.x&&([r,p]=vi.parseUnit(s.x.dist)),e&&"vh"===o&&(e=l*(e/100)),p&&"vw"===p&&(r=c*(r/100)),E=r,x=e,h.width=E,h.height=x,u=new Impetus({source:t||i,friction:1,update:function(t,e){h.y=-2*e,h.x=-2*t,k(h.x,h.y)}}),d=new un(n,function(t){t.preventDefault(),t.stopPropagation();var e=100*t.delta.y;h.y+=e;var s=100*t.delta.x;h.x+=s,k(h.x,h.y)})});var S=null;const O=an(h,E,x,p,f,function(){if(v||y){var t=`translate3d(${-(w?0:h.dx)}px, ${-(b?0:h.dy)}px, 0)`;t!==S&&(a.style.transform=S=t)}});this.set=rn(h,function(t,e,s){h.x=t,h.y=e,k(h.x,h.y),s&&(h.dx=h.x,h.dy=h.y),u&&u.setValues(0,h.y/-2)},O);const T=function(t){40===t.keyCode?h.y+=100:38===t.keyCode&&(h.y-=100),h.y=vi.clamp(h.y,0,x),k()};function C(t){}document.addEventListener("keydown",T,!1),i.addEventListener("touchmove",C),this.tick=()=>{O()},this.destroy=()=>{u.destroy(),d.detach(),a.style.transform="",i.removeEventListener("touchmove",C),document.removeEventListener("keydown",T,!1)}}},device:ln,browser:ln,smooth:class{constructor(t,e,s,r={}){this.conf=_.merge({},fn,s);const i=document.body,n=(t&&vi.getFirstElement(t),r.container,e.scroll);n.progress=0,n.scrollProgress=0;const o=this.conf.x.fr||.01,a=this.conf.y.fr||.01;let h,c,l=null;function u(){}setTimeout(()=>{import("./js/lenis.js").then(t=>{const e=()=>{const e=new(0,t.default)({lerp:a/40,infinite:!0,syncTouchLerp:.0015,duration:10});h=e,e.on("scroll",t=>{n.progress=t.progress,n.y=t.progress*t.limit}),l=an(n,void 0,e.limit,o,a,u),this.lenis=e};c=e,e()})}),this.set=rn(n,function(t,e,s){n.x=t,n.y=e,s&&(n.dx=t,n.dy=e),clamp()},l),this.tick=t=>{h&&(h.raf(t),n.progress=h.progress),l&&l()},this.resize=()=>{setTimeout(()=>{h&&(this.destroy(),c&&c()),h&&h.scrollTo(0,{immediate:!0,force:!0})})},this.pause=()=>{h&&h.stop()},this.resume=()=>{h&&h.start()},this.restart=({duration:t=0}={})=>{h?h.scrollTo(0,{immediate:!0}):window.scrollTo(0,0)},this.destroy=()=>{h&&h.destroy()}}},none:on};class mn{static hook(t,e,s){return new mn(t,e,s)}constructor(t,e,s){this.context=e,this.props=s,this.entity=t}hook(t,e,s){const r=this.props||{mode:{value:"none"},none:{}},i=r.mode.value,n=r.mode[i]||{},o=gn[i]||on;this.scroller=new o(t,this.context,n,{}),this.entity.addTick("scroller",t,this.scroller),this.entity.scroller=this.scroller}unhook(){this.scroller.destroy()}}const vn={translate:"transform",rotate:"transform",scale:"transform",skew:"transform","perspective-origin":"transform","transform-origin":"transform",filter:"filter",backdropFilter:"backdropFilter",attrs:"attrs"};class yn{constructor(t,e,s){this.context=e,this.props=s,this.entity=t}hook(t,e,s){const r=this.context,i=r.style,n=(this.entity,r),o=(r.cache,this.props.props);r.window.height,this.tick=()=>{const t=n.scroll.dy,e=n.scroll.height,s=t/e*100;for(let a in o)if(o.hasOwnProperty(a))for(let h in o[a])if(o[a].hasOwnProperty(h)){let c=o[a][h],l=c.ratio?c.ratio(n):0,u=(c.decay&&c.decay(n),(c.offset?c.offset(n):0)||0),d=c.destination?c.destination(n):void 0,p=c.limits,f=0,g=100,m=t,v=0;c._clamp&&(m=Math.min(Math.max(m,c._clamp.min(n)),c._clamp.max(n))),p&&(p.a||p.b)?(f=p.a||0,g=p.b||100,v=s>f?s<g?m-f/100*e:(g-f)/100*e:0,m=v*l):m=t*l,void 0!==d&&(m=d/((g-f)/100*e)*t),m+=u;var r=vn[a];r?i[r].set(h,m,a):i.set(h,m);continue}},this.entity.addTick("scroll",t,this)}unhook(t,e){this.entity.removeTick("scroll",t,this)}}var wn={hook:(t,e,s)=>new yn(t,e,s)};const bn={},xn=Symbol.for("tick"),En=Symbol("ro");class _n{static register(t,e){bn[t]=e}static get(t){return bn[t]}static hook(t,e,s){return new this(s,e,t)}static all(){return bn}constructor(t,e,s){this.conf=t,this.context=e,this.entity=s}get props(){return this.conf}get name(){return this.conf.name+this.conf.id}get options(){return this.conf&&this.conf.properties||{}}onResize(t,...e){return this[En]&&this[En].destroy(),this[En]=vi.observeResize(t,e),this[En]}create(){}destroy(){}attached(){}set tick(t){this[xn]=t,this.entity.removeTick(this.name,this.elem,this),t&&this.entity.addTick(this.name,this.elem,this)}get tick(){return this[xn]}hook(t,e,s){this.elem=t,this.create(t,s),setTimeout(()=>{this.attached(t,s)})}unhook(t,e){this.entity.removeTick(this.name,t,this),this[En]&&this[En].destroy(),this.destroy(t)}}_n.register("attribute",class extends _n{create(t){const{name:e,val:s}=this.options,r=this.context;var i;s&&e&&(this.tick=n=>{const o=s(r)+"";i!==o&&(t.setAttribute(e,o),i=o)})}destroy(t){const{name:e}=this.options;e&&t.removeAttribute(e)}});class kn extends _n{static render(t,e,s,r=1){var i=t.context,n=s.properties||{},o=n.as||"item",a="function"==typeof n.items?n.items(i):[],h=+("function"==typeof n.step?n.step(i):1)||1,c="number"==typeof a?Array.from({length:a},(t,e)=>e+1):Array.from(a.valueOf()),l=[],u=0;try{for(let e=0,s=c.length;e<s;e+=h){if(u>2500)throw"Too many iterations! Max is 500";let s,n=c[e],a=i.$new(r,u);a.item=n,a.index=u,"item"!==o&&(a[o]=n),u+=1,s=Array.isArray(t)?t.map(t=>t.clone?t.clone(a):t):t.clone?t.clone(a):t,l.push(s)}}catch(t){}return l}}_n.register("repeat",kn),Yr.Modifier.register("repeat",kn),_n.register("content",class extends _n{create(t){const{expr:e,interval:s=0}=this.options,r=this.context;if(e){var i,n,o=0;r.count=0,this.tick=a=>{a&&a-(o||0)<s||(o=a,this.text||(this.text=t.innerText),r.count+=1,i=e(r),n!==i&&(t.textContent=i,n=i))}}}destroy(t){this.text&&(t.textContent=this.text)}});class Sn extends _n{static render(t,e,s){const{condition:r}=s.properties||{};try{if(r&&r(e))return[t]}catch(t){}return[]}create(t){}destroy(t){t.style.visibility=""}}_n.register("conditional",Sn),Yr.Modifier.register("conditional",Sn),_n.register("class",class extends _n{create(t){const{condition:e,_true_:s,_false_:r}=this.options,i=this.context;var n,o;(e||s||r)&&(this.tick=a=>{o=e(i),n!==o&&(o?(s&&t.classList.add(s),r&&t.classList.remove(r)):(r&&t.classList.add(r),s&&t.classList.remove(s)),n=o)})}destroy(t){const{_true_:e,_false_:s}=this.options;e&&t.classList.remove(e),s&&t.classList.remove(s)}});const{window:On,document:Tn}=Ss,Cn=!!On.PointerEvent,Nn={MOVE:"move",UP:"up",DOWN:"down",CLICK:"click",click:["click","touchend"],down:Cn?["pointerdown"]:["mousedown","touchstart"],up:Cn?["pointerup"]:["mouseup","touchend"],move:Cn?["pointermove"]:["mousemove","touchmove"],leave:Cn?["pointerleave"]:["mouseleave"],enter:Cn?["pointerenter"]:["mouseenter"],out:Cn?["pointerout"]:["mouseout"],over:Cn?["pointerover"]:["mouseover"],TYPES:{pointerleave:"leave",mouseleave:"leave",pointerenter:"enter",mouseenter:"enter",pointerout:"out",mouseout:"out",pointerover:"over",mouseover:"over",pointerup:"up",mouseup:"up",touchend:"up",pointerdown:"down",mousedown:"down",touchstart:"down",pointermove:"move",mousemove:"move",touchmove:"move"},on:(t,e,s)=>Nn[t]?Array.from(Nn[t]).map(t=>e.addEventListener(t,s,!1)):e.addEventListener(t,s,!1),off:(t,e,s)=>Nn[t]?Array.from(Nn[t]).map(t=>e.removeEventListener(t,s)):e.removeEventListener(t,s)};class Mn{constructor(t){this.context=t,this.events={}}on(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)}trigger(t,...e){if(e[0]&&(e[0].action=t),t in this.events!=0)for(var s=0;s<this.events[t].length;s++)this.events[t][s].apply(this,e)}bind(t,e){this.handler=s=>{s.element=e||t,this.prepare(s),this.trigger(Nn.TYPES[s.type]||s.type,s)};for(let e in this.events)Nn.on(e,t,this.handler)}unbind(t){for(let e in this.events)Nn.off(e,t,this.handler)}prepare(t){this.context.event.setEvent("end",t)}}class An extends Mn{}var jn={EventBase:Mn,NativeEvent:An,ActionsEvent:class extends An{prepare(t){super.prepare(t)}bind(t){super.bind(Tn.body,t)}unbind(t){super.unbind(Tn.body,t)}},MediaEvent:class extends An{},WindowEvent:class extends Mn{bind(t){super.bind(On,t)}unbind(t){super.unbind(On,t)}},DocumentEvent:class extends Mn{bind(t){super.bind(Tn,t)}unbind(t){super.unbind(Tn,t)}},GestureEvent:class extends Mn{constructor(t,e={}){var s,r,i;super(t,e);var n,o,a=!1,h={x:0,y:0},c={x:0,y:0};const l=t=>{c=Ei.toPoint(t),t.element=i,n=Math.abs(c.x-h.x),o=Math.abs(c.y-h.y)},u=e=>{clearTimeout(s),e.target.releasePointerCapture&&e.target.releasePointerCapture(e.pointerId),Nn.off(Nn.MOVE,i,p),Nn.off(Nn.UP,i,u),t.event.setEvent("end",e,t),l(e),a&&this.trigger("dragend",e),r&&this.trigger("release",e),c.x>h.x?this.trigger("swiperight",e):c.x<h.x?this.trigger("swipeleft",e):c.y<h.y?this.trigger("swipeup",e):c.y>h.y&&this.trigger("swipedown",e),c.x===h.x&&c.y===h.y||this.trigger("swipe",e),0===n&&0===o&&this.trigger("tap",e),a=!1,r=!1},d=e=>{e.element=i,c=h=Ei.toPoint(e),t.event.setEvent("start",e,t),e.target.setPointerCapture&&e.target.setPointerCapture(e.pointerId),Nn.on(Nn.MOVE,i,p),Nn.on(Nn.UP,i,u),s=setTimeout(()=>{r=!0,this.trigger("hold",e)},300)},p=e=>{clearTimeout(s),l(e),t.event.setEvent("end",e),a||(a=!0,this.trigger("dragstart",e)),this.trigger("drag",e)};this.unbind=t=>{this.events={},Nn.off(Nn.DOWN,t,d)},this.bind=t=>{i=t,Nn.on(Nn.DOWN,t,d)}}}};class Pn extends Qr{constructor(t){super(),this.group=t}log(...t){this.trigger("log",this.group,...t)}error(...t){this.trigger("error",this.group,...t)}}const Ln=new Pn("events"),Rn={},$n=function({render:t,next:e,scopes:s,site:r}){const i=()=>{setTimeout(()=>"function"==typeof e?e(s):void 0)};"none"!==t?r.render({callback:i}):i()},In={trigger:!0,skipHistory:!0};var Dn={elements(t,e){let s=[];return s=e||(t.element?[t.element]:[t.target]),Array.from(s)},setstate(t,e,s,r,i,n,o){let{state:a,scope:h="page",render:c="dom"}=e,l=Object.assign({toggle:o},In);l.render=!c||"dom"===c;const u=r.site,d=t=>(Ln.error("state change error",t),i?i(n):null);"page"===h&&(Ln.error("set state at page",a.name,l),l.setChildStates=!0),a.resolve(l).then(e=>{if(!e)return;if("page"===h)l.setChildStates=!0,u.changeState(e,l);else if("siblings"===h)l.setChildStates=!0,Array.from(Dn.elements(t,n)).map(r=>{let i=Array.from(r.parentNode.childNodes).filter(e=>e!==t.target);i.length&&u.findElement(s).changeState(e,l,i)});else if("parent"===h){l.setChildStates=!0;let r=u.findElement(s).parent,i=[];Array.from(Dn.elements(t,n)).map(t=>{for(let e of r.nodes)e.contains(t)&&i.push(e)}),r.changeState(e,l,i)}else{l.setChildStates=!0;let r=Dn.elements(t,n);if(r.length){let t="Elem"==s.constructor.name?s:u.findElement(s);return t&&t.changeState(e,l,r)}}const{scroller:r}=u.page;r&&r.resize(),$n({render:c,next:i,scopes:n,site:u})},d).catch(d)},togglestate(t,e,s,r,i,n){Dn.setstate(t,e,s,r,i,n,!0)},removestate(t,e,s,r,i,n){Dn.setstate(t,e,s,r,i,n,"remove")},authlogin(t,e,s,r,i,n){r.site.session.login().then(t=>t).finally(()=>i?i(n):null)},authlogout(t,e,s,r,i,n){r.site.session.logout().then(()=>(i&&i(n),resp)).finally(()=>{})},authcreate(t,e,s,r,i,n){r.site.session.signup(e).then(t=>(i&&i(n),t)).finally(()=>{})},authcancel(t,e,s,r,i,n){const o=r.site;return Ln.log("auth cancel"),o.session.cancel(),i?i(n):null},setvar(t,e,s,r,i,n){let o,{name:a,val:h,render:c="none"}=e;const l=r.site;if(h&&"function"==typeof h&&(h=h(r)),h&&h.toValue&&(h=h.toValue()),void 0!==h){var u=_.get(r,a);if("object"==typeof u&&"function"==typeof u.set)o=u.set(h);else{var d=a.split(".");if(d.length>1){var p=d.pop(),f=_.get(r,d);u=f,f&&"function"==typeof f.setValue?o=f.setValue(p,h):f&&"function"==typeof f.set?o=f.set(p,h):f[p]=h}else o=_.set(r,a,h)}return Promise.resolve(o).then(()=>{$n({render:c,next:i,scopes:n,site:l})})}},callmethod(t,e,s,r,i,n){let{method:o,args:a,render:h="dom"}=e;a&&"function"==typeof a&&(a=[a(r)]);try{var c=_.get(r,o),l=o.split(".");if(l.pop(),l.length){let t=_.get(r,l);Reflect.apply(c,t,a)}}catch(t){}return i?i(n):null},set_class(t,e,s,r,i,n,o){let{cname:a,scope:h}=s;return a?(Dn.elements(e,o).map(s=>{if("siblings"===h)for(let r of Array.from(s.parentNode.childNodes))r!==e.target&&r.classList[t](a);else"parent"===h?s.parentNode&&!s.parentNode.classList.contains("page")&&s.parentNode.classList[t](a):s.classList[t](a)}),n?n(o):null):n?n(o):null},add_class:(t,e,s,r,i,n)=>Dn.set_class("add",t,e,s,r,i,n),remove_class:(t,e,s,r,i,n)=>Dn.set_class("remove",t,e,s,r,i,n),toggle_class:(t,e,s,r,i,n)=>Dn.set_class("toggle",t,e,s,r,i,n),set_attribute(t,e,s,r,i,n){let{name:o,value:a}=e;if(!o)return i?i(n):null;for(let e of Dn.elements(t,n))e.setAttribute(o,a);return i?i(n):null},remove_attribute(t,e,s,r,i,n){let{name:o}=e;if(!o)return i?i(n):null;for(let e of Dn.elements(t,n))e.removeAttribute(o);return i?i(n):null},changescope(t,e,s,r,i,n){const o=r.site;let a=e.scopes,h=null;if(a)for(let t of Array.from(a)){h||(h=[]);let e=o.findElement(t);if(e)for(let t of Array.from(e.nodes))h.push(t)}return i?i(h||n,t):null},pause(t,e,s,r,i,n){for(let e of Dn.elements(t,n))"function"==typeof e.pause&&e.pause();return i?i(n):null},play(t,e,s,r,i,n){for(let e of Dn.elements(t,n))if("function"==typeof e.play)if(e.readyState>e.HAVE_CURRENT_DATA)e.play();else{const t=()=>{e.play(),e.removeEventListener("canplaythrough",t)};e.addEventListener("canplaythrough",t)}return i?i(n):null},toggle_play(t,e,s,r,i,n){for(let e of Dn.elements(t,n))e.paused?"function"==typeof e.play&&e.play():"function"==typeof e.pause&&e.pause();return i?i(n):null},toggle_mute(t,e,s,r,i,n){for(let e of Dn.elements(t,n))e.muted?e.muted=!1:e.muted=!0;return i?i(n):null},set_time(t,e,s,r,i,n){for(let s of Dn.elements(t,n))s.currentTime=(e.time||0)+0;return i?i(n):null},debug:(t,e,s,r,i,n)=>(Dn.elements(t,n),i?i(n):null),delay(t,e,s,r,i,n){let o=parseInt(e.delay)||0;const a=`timer-${String(e.tid).trim()||s}`;let h=Rn[a];if(clearTimeout(h),"function"==typeof i){if(!o)return i(n);h=setTimeout(()=>{i(n)},o),Rn[a]=h}},cancel_delay(t,e,s,r,i,n){const o=String(e.tid).trim()||s,a=Rn[`timer-${o}`];return clearTimeout(a),i?i(n):null},repeat(t,e,s,r,i,n){let{intr:o=1e3,times:a=1,tid:h=s}=e,c=0,l=r.get(`interval-${h}`);if(clearInterval(l),!o||!i)return i?i(n):null;{let t=setInterval(function(){return c>=a&&clearInterval(t),c+=1,i(n)},o);r.set(`interval-${h}`,t)}},navigate(t,e,s,r,i,n){var o=e.url(r);return r.site.router.navigate(o,r),i?i(n):null},scrollto_section:(t,e,s,r,i,n)=>i?i(n):null,scrollto:(t,e,s,r,i,n)=>i?i(n):null,trigger_event(t,e,s,r,i,n){if(e.evname){const t=new CustomEvent(e.evname,{bubbles:!0,detail:{id:s,context:r}});document.body.dispatchEvent(t)}return i?i(n):null},if(t,e,s,r,i,n){if(e.cond)return i?i(n):null},unless(t,e,s,r,i,n){if(!e.cond)return i?i(n):null}};const zn=new WeakMap,Fn={};class qn{constructor(t,e){this.context=e,this.actions=t,this.ctrls={},this.actions.forEach(t=>{var e=(t.name||"").split(",");for(let r of e){var s=Fn[r]||jn.ActionsEvent;this.ctrls[s.name]=this.ctrls[s.name]||new s(this.context),this.ctrls[s.name].on(r,t.handler)}})}unbind(t){for(let e in this.ctrls)this.ctrls[e].unbind(t)}bind(t){for(let e in this.ctrls)this.ctrls[e].bind(t)}hook(t,e,s){if(!s||s.elem===t){this.elem=t;var r=zn.get(t);r||(r=new Ei,zn.set(t,r)),r.context=this.context,this.context.event=r,this.bind(t)}}unhook(t,e){this.unbind(t)}}class Wn{static register(t,e){t.split(",").map(t=>{Fn[t]=e})}static getController(t){return Fn[t]}static hook(t,e,s,r){var i=(s||[]).map(s=>{if(s)return s.event?{name:s.event,handler:Wn.handler(t,e,s.handlers,s.options)}:void 0}).filter(t=>!!t);return new qn(i,e)}static handler(t,e,s,r={}){let i=function(r){var i=function(n){let o=n;var a=function(h){if(a.h||(a.h=s[o]),a.h)return function(s,r,i,n){if(r.off)return"function"==typeof i?i(n):void 0;let o=Dn[r.func];return o?o(s,r.props||{},t,e,i,n):"function"==typeof i?i(n):void 0}(r,a.h,i(n+1),h)};return a};return i(0)()},n=i;return r.debounce>0&&(n=_.debounce(i,Math.abs(r.debounce),{trailing:!0,leading:!1})),r.debounce<0&&(n=_.debounce(i,Math.abs(r.debounce),{trailing:!1,leading:!0})),r.throttle&&!r.debounce&&(n=_.throttle(i,r.throttle)),r.once&&(n=_.once(i)),function(t){let e=t.srcEvent||t;r.pd&&e.preventDefault(),r.sp&&e.stopPropagation(),r.delay?setTimeout(()=>n(t),r.delay):n(t)}}run(t,e,...s){}}Wn.types={},Wn.register("click,down,up,enter,leave,move,focus,blur,input,change",jn.NativeEvent),Wn.register("orientationchange",jn.WindowEvent),Wn.register("visibilitychange",jn.DocumentEvent),Wn.register("keypress,keyup,keydown",jn.DocumentEvent),Wn.register("pause,play,progress,playing,seeking,seeked,ended,timeupdate,canplay,waiting,volumechange",jn.MediaEvent),Wn.register("scroll,scrollstart,scrollstop,scrolltop,scrollend,ready",jn.ActionsEvent),Wn.register("swipe,swipeleft,swiperight,swipeup,swipedown,press,pressup,tap",jn.GestureEvent),Wn.register("drag,dragstart,dragend",jn.GestureEvent),Wn.register("auth:start,auth:end,auth:cancel",jn.ActionsEvent),_n.register("draggable",class extends _n{destroy(t){this.events&&this.events.unbind(t)}attached(t){var e=this.context;const s=this.entity.site;if(e.hasOwnProperty("event")||(e.event=new Ei,e.event.context=e),this.dragActive)return;e.draggable=Object.create(e.event);const r=this.options,{name:i="draggable"}=r;this.__transform||(this.__transform={x:0,y:0});const n=new(Wn.getController("drag"))(e),o=t.parentNode,a=this.__transform,h=r.constraint||{},c=e.style;var l,u,d,p,f,g,m,{snap:v="pointer-over",snapevent:y="drop"}=r.drop||{},w=0,b=0,x=[],E=!1;let _=h.value||"none",k=h[_]||{},S=k.axis,O=k.radius&&"function"==typeof k.radius?k.radius():null;this.events=n;const T=(t,r,n={},o=null)=>{const a=`${i}:${t}`,h=r?s.getContext(r,!0):null;s.triggerEvent(a,Object.assign({name:t,dragged:e,dropped:h},n),o)},C=(t,e)=>{var s=r.drop&&r.drop.position,i="object"==typeof s?s:null,n=0,o=0;i?(n=(+("function"==typeof i.x?i.x():0)||0)+t.bounds.left,o=(+("function"==typeof i.y?i.y():0)||0)+t.bounds.top):"pointer"===s?(n=e.x-f.width/2,o=e.y-f.height/2):(n=t.bounds.left+t.bounds.width/2-f.width/2,o=t.bounds.top+t.bounds.height/2-f.height/2),w=n,b=o},N=()=>{if(E)return;let t,e;r.revert&&"object"==typeof r.revert&&("function"==typeof r.revert.expr?(e=r.revert.expr(),m=N):e=!0,"function"==typeof r.revert.delay&&(t=r.revert.delay())),e&&(m=null,d=setTimeout(this.revert,t||0))};n.on("dragstart",i=>{this.dragActive=E=!0,clearTimeout(d),p=o.getBoundingClientRect(),f=f||e.initBounds,g=Object.assign({},a),e.event,u=e.draggable.dropped=null,t.classList.remove("dropped","dropover"),t.classList.add("dragging"),e.draggable.dragging=!1,e.draggable.dragged=!1,r.drop&&(r.drop.elements||r.drop.selector)&&(r.drop.elements?x=Array.from(r.drop.elements).map(t=>s.findElement(t)).filter(t=>!!t).reduce((t,e)=>t.concat(Array.from(e.nodes)),[]):r.drop.selector&&(x=Array.from(document.querySelectorAll(r.drop.selector))),l=x.map((t,e)=>(t.classList.remove("dropped"),{el:t,i:e,bounds:t.getBoundingClientRect()}))),T("dragstart",null,{},i)}),n.on("drag",s=>{var i,n,o,h=e.event;if(f=f||e.initBounds,e.draggable.dragging=!0,e.draggable.dragged=!0,w=h.x-h.layer.start.x,b=h.y-h.layer.start.y,r.constraint&&("parent"===_&&(w=e.Util.clamp(w,p.left,p.right-f.width),b=e.Util.clamp(b,p.top,p.bottom-f.height)),"window"===_&&(w=e.Util.clamp(w,0,window.innerWidth-f.width),b=e.Util.clamp(b,0,window.innerHeight-f.height))),l&&l.length){if(u=null,t.classList.remove("dropover"),"nearest-target"==v){let t=(n=w,o=b,l.map((t,e)=>(t.distance=Math.sqrt(Math.pow(t.bounds.left+t.bounds.width/2-n,2)+Math.pow(t.bounds.top+t.bounds.height/2-o,2)),t)).sort((t,e)=>t.distance-e.distance));i=t[0]}else if("pointer-over"==v)for(let t=0,e=l.length;t<e;t++){let e=l[t].bounds;if(h.x>=e.left&&h.x<=e.right&&h.y>=e.top&&h.y<=e.bottom){i=l[t];break}}else if("target-over"==v)for(let t=0,e=l.length;t<e;t++){let e=l[t].bounds;if(h.x+f.width<e.right&&h.x>e.left&&h.y+f.height<e.bottom&&h.y>e.top){i=l[t];break}}else for(let t=0,e=l.length;t<e;t++){let e=l[t].bounds;if(h.x<e.right&&h.x+f.width>e.left&&h.y<e.bottom&&h.y+f.height>e.top){i=l[t];break}}i&&t.classList.add("dropover"),x.map(t=>{i&&i.el===t?(i.el.classList.contains("dragover")||(i.el.classList.add("dragover"),T("dragenter",i.el,{},s)),"hover"===y&&C(i,h)):t.classList.contains("dragover")&&(t.classList.remove("dragover"),T("dragleave",t,{},s))})}u=i,c.set("transition","none"),a.x=w-f.left,a.y=b-f.top,this.apply(),T("drag",null,{},s)}),n.on("dragend",s=>{if(E){this.dragActive=E=!1;var r=e.event;if(c.set("transition",""),t.classList.remove("dragging","dropover"),e.draggable.dragging=!1,e.draggable.dragged=!0,u){let i=u.el;i.classList.remove("dragover"),i.classList.add("dropped"),t.classList.add("dropped"),e.draggable.dropped=!0,C(u,r),a.x=w-f.left,a.y=b-f.top,T("drop",i,{},s)}else e.draggable.dropped=!1;T("dragend",null,{},s),this.apply(),setTimeout(N)}}),this.tick=t=>{m&&m(t),c.transform.translate(a.x,a.y,0)},this.apply=()=>{"x"===S&&(a.y=0),"y"===S&&(a.x=0),"circle"===_&&O&&(circularConstraint(),a.y=b-f.top,a.x=w-f.left)},this.revert=()=>{e.draggable.angle=0,e.draggable.distance=0;var s=r.revert&&"previous"===r.revert.position&&g?g:{x:0,y:0};a.x=s.x,a.y=s.y,this.apply(),l&&l.length&&l.map(t=>{t.el.classList.remove("dropped")}),t.classList.remove("dropped")},this.onStateChange=(t,e,s)=>{N()},n.bind(t),this.apply()}}),_n.register("scale",class extends _n{attached(t){var e,{interval:s=100,container:r="parent",fit:i="contain",align:n="none"}=this.options,o=t.parentNode,a=this.context,h=a.style,c=0,l=0,u=0,d=0;this.parent=o,this.onResize(()=>{e=null,this.context.refresh(),this.setSize()},t,o,window),this.setSize=()=>{var t="parent"==r?e||(e={width:o.offsetWidth,height:o.offsetHeight}):a.window,s=a.offset;let h=t.width,p=t.height;var f=s.width,g=s.height;switch(c=h/f,l=p/g,n){case"center":u=(f*c-f)/2,d=(g*l-g)/2;break;case"none":u=d=0}switch(i){case"contain-width":l=c;break;case"contain-height":c=l;break;case"contain":l=c=Math.min(c,l);break;case"cover":l=c=Math.max(c,l);break;case"none":l=c=1}},this.setSize(),this.tick=t=>{h.transform.scale(c-1,l-1,0),h.transform.translate(u,d,0)}}}),_n.register("script",class extends _n{create(t){var e,s,r=this.options.script;if(this.exports={},r)try{if(r(this),"function"!=typeof(s=this.exports))throw"Invalid modifier. Must be an ES6 class definition";this._mod=e=new s(t,this.context)}catch(t){}e&&"function"==typeof e.tick&&(this.tick=e.tick.bind(e))}destroy(t){this._mod&&"function"==typeof this._mod.destroy&&this._mod.destroy(t)}});class Vn extends Float32Array{constructor(t=4){super(t),this[3]=1}fromEuler(t){return quat.fromEuler(this,t[0],t[1],t[2])}set(t,e,s,r){return this[0]=t,this[1]=e,this[2]=s,this[3]=r,this}}Math.PI;class Un extends Float32Array{constructor(t=3){super(t)}clone(){return(new Un).set(this[0],this[1],this[2])}len(){return Math.sqrt(this.sqlen())}sqlen(){let t=this[0],e=this[1],s=this[2];return t*t+e*e+s*s}set(t,e,s){return this[0]=t,this[1]=e,this[2]=s,this}add(t){for(let e=0;e<3;e++)this[e]+=t[e];return this}subtract(t){for(let e=0;e<3;e++)this[e]-=t[e];return this}multiply(t){for(let e=0;e<3;e++)this[e]*=t[e];return this}divide(t){for(let e=0;e<3;e++)this[e]/=t[e];return this}scale(t){for(let e=0;e<3;e++)this[e]*=t;return this}distance(t){let e=this[0]-t[0],s=this[1]-t[1],r=this[2]-t[2];return Math.sqrt(e*e+s*s+r*r)}rotation(t){var e=this.clone().normalize(),s=t.clone().normalize(),r=e.dot(s),i=e.clone().cross(s),n=Math.sqrt(2*(1+r)),o=1/n;return Vn.from([i[0]*o,i[1]*o,i[2]*o,.5*n])}squaredDistance(t){let e=this[0]-t[0],s=this[1]-t[1],r=this[2]-t[2];return e*e+s*s+r*r}negate(){for(let t=0;t<3;t++)this[t]=-this[t];return this}inverse(){for(let t=0;t<3;t++)this[t]=1/this[0];return this}normalize(){let t=this.sqlen();return t>0&&(t=1/Math.sqrt(t),this[0]*=t,this[1]*=t,this[2]*=t),this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]}cross(t){let e=this[0],s=this[1],r=this[2],i=t[0],n=t[1],o=t[2];return this[0]=s*o-r*n,this[1]=r*i-e*o,this[2]=e*n-s*i,this}}class Hn extends Float32Array{static create(t,e,s,r,i,n,o,a,h,c,l,u,d,p,f,g){return(new Hn).set(t,e,s,r,i,n,o,a,h,c,l,u,d,p,f,g)}constructor(t=16){super(t),this[0]=this[5]=this[10]=this[15]=1}toCSS(){return`matrix3d(${this.join(",")})`}clone(){return Hn.from(this)}identity(){for(var t=15;t>=0;t--)this[t]=t%5==0?1:0;return this}set(...t){for(var e=15;e>=0;e--)this[e]=t[e];return this}invert(){return mat4.invert(this,this)}adjoint(){return mat4.adjoint(this,this)}determinant(){return mat4.determinant(this,this)}multiply(t){return mat4.multiply(this,this,t)}add(t){return mat4.add(this,this,t)}subtract(t){return mat4.subtract(this,this,t)}multiplyScalarAndAdd(t,e){return mat4.multiplyScalarAndAdd(this,this,t,e)}exactEquals(t){return mat4.exactEquals(this,t)}equals(t){return mat4.equals(this,t)}translate(t){return mat4.translate(this,this,t)}scale(t){return mat4.scale(this,this,t)}rotate(t,e){return mat4.rotate(this,this,t,e)}rotateX(t){return mat4.rotateX(this,this,t)}rotateY(t){return mat4.rotateY(this,this,t)}rotateZ(t){return mat4.rotateZ(this,this,t)}fromTranslation(t){return mat4.fromTranslation(this,t)}fromScaling(t){return mat4.fromScaling(this,t)}fromRotation(t,e){return mat4.fromScaling(this,t,e)}fromXRotation(t){return mat4.fromXRotation(this,t)}fromYRotation(t){return mat4.fromYRotation(this,t)}fromZRotation(t){return mat4.fromZRotation(this,t)}fromRotationTranslation(t,e){return mat4.fromRotationTranslation(this,t,e)}fromRotationTranslationScale(t,e,s){return mat4.fromRotationTranslation(this,t,e,s)}fromRotationTranslationScaleOrigin(t,e,s,r){return mat4.fromRotationTranslation(this,t,e,s,r)}fromQuat(t){return mat4.fromQuat(this,t)}frustum(t,e,s,r,i,n){return mat4.frustum(this,t,e,s,r,i,n)}perspective(t,e,s,r){return mat4.frustum(this,t,e,s,r)}perspectiveFromFieldOfView(t,e,s){return mat4.perspectiveFromFieldOfView(this,t,e,s)}ortho(t,e,s,r,i,n){return mat4.perspectiveFromFieldOfView(this,t,e,s,r,i,n)}lookAt(t,e,s){return mat4.lookAt(this,t,e,s)}targetTo(t,e,s){return mat4.targetTo(this,t,e,s)}getTranslation(t){return mat4.getTranslation(this,t)}getScaling(t){return mat4.getScaling(this,t)}getRotation(t){return mat4.getRotation(this,t)}}const Bn=Symbol();class Xn{constructor(t,e){this.matrix=new Hn,this.elem=t,this.context=e}set settings(t){this[Bn]=t}get settings(){return this[Bn]}tick(t,e,s){var r,i,n,o,a,h,c=this.settings;o=c.translate&&c.translate(e),a=c.rotate&&c.rotate(e),h=c.scale&&c.scale(e),r=o instanceof Un?o:"number"==typeof o?Un.from([o,0,0]):Array.isArray(o)?Un.from(o):new Un,a instanceof Vn?i=a:Array.isArray(a)?4==a.length?i=Vn.from(a):3==a.length&&(i=new Vn).fromEuler(a):i=new Vn,n=h instanceof Un?h:Array.isArray(h)?Un.from(h):new Un,this.matrix.fromRotationTranslationScale(i,r,n)}}function Gn(t,e,s="M"){const r=t.length;s+=t[0]+","+e[0];for(var i=1;i<r;i++)s+=" L"+t[i]+","+e[i];return s}function Yn(t,e,s="M",r){const i=t.length;for(var n=0;n<i;n++){const i=t[n],o=e[n],a=r||(e[n-1]||0)-o;s+=i-a+" "+(o-a)+" L"+(i-a)+" "+(o+a)+" L"+(i+a)+" "+(o+a)+" L"+(i+a)+" "+(o-a)+"z"}return s}function Jn(t,e,s,r,i,n,o,a){return"M"+t+" "+e+" C"+s+" "+r+" "+i+" "+n+" "+o+" "+a}function Kn(t,e,s,r,i,n,o,a){return" C"+s+" "+r+" "+i+" "+n+" "+o+" "+a}function Qn(t){var e,s,r,i,n,o,a;e=new Array,s=new Array,r=t.length-1,i=new Array,n=new Array,o=new Array,a=new Array,i[0]=0,n[0]=2,o[0]=1,a[0]=t[0]+2*t[1];for(var h=1;h<r-1;h++)i[h]=1,n[h]=4,o[h]=1,a[h]=4*t[h]+2*t[h+1];for(i[r-1]=2,n[r-1]=7,o[r-1]=0,a[r-1]=8*t[r-1]+t[r],h=1;h<r;h++){var c=i[h]/n[h-1];n[h]=n[h]-c*o[h-1],a[h]=a[h]-c*a[h-1]}for(e[r-1]=a[r-1]/n[r-1],h=r-2;h>=0;--h)e[h]=(a[h]-o[h]*e[h+1])/n[h];for(h=0;h<r-1;h++)s[h]=2*t[h+1]-e[h+1];return s[r-1]=.5*(t[r]+e[r-1]),{p1:e,p2:s}}_n.register("transform",class extends _n{create(t){this.transformer=new Xn(t,this.context),this.start(t,this.context)}start(t,e){this.transformer.settings=this.options;var s=0,r=this.options.interval||0,i=e.style;this.tick=t=>{i.transform.matrix=this.transformer.matrix,t&&t-(s||0)<r||(s=t,this.transformer.tick(t,e))}}});var Zn=Object.freeze({catmulrom:function(t,e){var s,r,i,n,o,a;s=new Array,r=new Array,i=t.length;for(var h=0;h<i;h++)s[h]=t[h][0],r[h]=t[h][1];if(e&&(s.unshift(s[i-1]),s.push(s[1]),r.unshift(r[i-1]),r.push(r[1]),i+=2),n=Qn(s),o=Qn(r),a=[],e)for(h=1;h<i-1;h++)a.push((1==h?"M"+s[h]+" "+r[h]:"")+Kn(s[h],r[h],n.p1[h],o.p1[h],n.p2[h],o.p2[h],s[h+1],r[h+1]));else for(h=0;h<i-1;h++)a.push(Jn(s[h],r[h],n.p1[h],o.p1[h],n.p2[h],o.p2[h],s[h+1],r[h+1]));return a.join(" ")},spline:function(t,e,s="M"){const r=t.length,i=Qn(t),n=Qn(e);s+=t[0]+","+e[0];for(var o=0;o<r-1;o++)s+=Kn(t[o],e[o],i.p1[o],n.p1[o],i.p2[o],n.p2[o],t[o+1],e[o+1]);return s},quadratic:function(t,e,s="M"){const r=t.length;s+=t[0]+" "+e[0];for(var i=1;i<r-2;i++){const r=(t[i]+t[i+1])/2,n=(e[i]+e[i+1])/2;s+=" Q"+t[i]+","+e[i]+"  "+r+","+n+" "}return s+" Q"+t[i]+","+e[i]+"  "+t[i+1]+","+e[i+1]},line:Gn,manhattan:function(t,e,s="M"){const r=t.length;s+=t[0]+","+e[0];for(var i=1;i<r;i++){const r=((t[i-1]||0)+t[i])/2;s+=" L"+r+","+e[i-1],s+=" L"+r+","+e[i],s+=" L"+t[i]+","+e[i]}return s},box:function(t,e,s=""){return Yn(t,e,s,4)},diffbox:Yn,bars:function(t,e){const s=t.length;Math.max.apply(null,e),paths="";for(var r=0;r<s;r++){const s=t[r],i=e[r];paths+=" M"+(s-4)+" 0",paths+=" L"+(s-4)+" "+(i+4),paths+=" L"+(s+4)+" "+(i+4),paths+=" L"+(s+4)+" 0z"}return paths},zigzag:function(t,e,s="M"){const r=t.length,i=Math.max.apply(null,e);s+=t[0]+" "+e[0];for(var n=0;n<r;n++){const r=t[n],o=e[n];s+=" L"+(r-4)+" "+i,s+=" L"+(r-4)+" "+(o+4),s+=" L"+(r+4)+" "+(o+4),s+=" L"+(r+4)+" "+i}return s},path:Jn,cpath:Kn,controlPoints:Qn});class to{constructor(t){this.context=t;const e=this.pts=[],s=this.vals=[],r=this.tweens={};this.getTween=t=>{var i=r[t];return i||((i=new TWEEN.Tween({index:t,v:s[t]}).easing(this.easing)).onUpdate(function(){e[this.index]=this.v}),r[t]=i,i)}}set(t,e,s){const{animate:r,pts:i,vals:n,dur:o,delay:a,easing:h}=this;if(r){if(null==n[t])return void(n[t]=i[t]=e);n[t]!=e&&this.getTween(t).to({v:e},o(s)).delay(a(s)).easing(h).start()}else i[t]=e;n[t]=e}get length(){}set length(t){}config(t){t.animate&&"none"!=t.animate?(this.animate=t.animate||{},this.delay=this.animate.delay||(()=>0),this.dur=this.animate.dur||(()=>1e3),this.easing=_.get(TWEEN.Easing,this.animate.ease||"Linear.None")):this.animate=this.delay=this.dur=this.easing=null}destroy(){for(const t of Object.keys(this.tweens))this.tweens[t].stop()}}_n.register("path",class extends _n{create(t,e){const s="_path_modifier_",r=this.context;this.xpts=new to,this.ypts=new to;const{config:i={},points:n={}}=this.options||{},{count:o=()=>10,type:a="line"}=i;var h=o(r);this.xpts.config(i,r,h),this.ypts.config(i,r,h);const c=(n.indexes||[]).reduce((t,e)=>(t[e.at||0]=e,t),{}),l=n.x||(t=>10*t.index),u=n.y||(t=>0),d=(t,e)=>t.at-e.at,p=t=>{const e={};return s=>e[s]||(e[s]=r.$new(t,s,{},{index:s}))},f=p(s+"x"),g=p(s+"y"),m=Zn[a]||Gn,v=[],y=[];for(const t of Object.keys(c))t<0&&y.push(c[t]),t>=h&&v.push(c[t]);var w,b;v.sort(d),y.sort(d),this.tick=e=>{h=o(r),this.xpts.length=this.ypts.length=h;for(let t=0;t<h;t++){const e=g(t),s=f(t),r=c[t]&&c[t].x||l,i=c[t]&&c[t].y||u;this.xpts.set(t,r(s),s),this.ypts.set(t,i(e),e)}var s="M";if(w="",y.length){s="L";for(const t of y){const e=f(t.at),s=g(t.at);w+=(w?"L":"M")+(t.x?t.x(e):0)+","+(t.y?t.y(s):0)}}if(w+=m(this.xpts.pts,this.ypts.pts,s),v.length)for(const t of v){const e=f(t.at),s=g(t.at);w+="L"+(t.x?t.x(e):0)+","+(t.y?t.y(s):0)}b!=w&&(t.setAttribute("d",w),b=w)}}destroy(t){this.xpts.destroy(),this.ypts.destroy()}});const eo=["blur","sepia","grayscale","saturate","invert","contrast","brightness","opacity","hueRotate"],so=["translate","rotate","scale","skew","origin","perspectiveOrigin","perspective"];var ro=[["x","y","z"],["x","y","z"],["x","y","z"],["x","y"],["x","y","z"],["x","y","perspective"],["value"]];const io=Symbol.for("matrix");class no{static hook(t,e,s){return new no(t,e,s)}constructor(t,e,s={}){var r,i,n=new Map,o=new Set,a="";const h=["",""],c=(t,e)=>{e.enumerable=!1,Object.defineProperty(this,t,e)},l=()=>{var t="";for(let e of o)t+=";"+e.toString(),e.clear();for(const e of n.keys()){const r=s[e]||h;t+=`;${e}:${n.get(e)+(r[2]&&r[0]||"")}${r[1]||""}`}return t},u=(t,e)=>{var s;c(t,{get:()=>(s||(s=e(t),o.add(s)),s),set(){}})};u("transform",t=>new ao(t,s.transform,this)),u("filter",t=>oo(t,eo,this,s.filter)),u("backdropFilter",t=>oo(t,eo,this,s.filter)),c("props",{get:()=>s}),c("entity",{get:()=>t}),c("apply",{value:(t=i.style)=>{if(!r)return;if(i.setStyleProps)return void i.setStyleProps((()=>{const t={};for(let e of o)Object.assign(t,e.toVector()),e.clear();for(const e of n.keys()){const r=s[e]||h;t[e]={value:n.get(e)+(r[2]&&r[0]||0),unit:r[1]||""}}return n.clear(),t})());const e=l();n.clear(),a!=e&&(t.cssText=e,a=e)}}),c("collect",{value:l}),c("changed",{get:t=>r,set(t){r=t}}),c("elem",{get:()=>i,set(t){i=t}}),c("map",{get:()=>n}),this.set=(t,e)=>{r=!0,n.set(t,e)}}hook(t,e,s){this.elem=t,this.entity.addStyle(this)}unhook(){this.entity.removeStyle(this)}}function oo(t,e,s,r=[]){var i=new Map,n=new Map(e.map((t,e)=>[t,{value:r[e]&&r[e][0],unit:r[e]&&r[e][1]||""}])),o=function(...t){s.changed=!0;for(var r=0,n=t.length;r<n;r++){var o=e[r];i.set(o,(i.get(o)||0)+t[r])}};return o.set=function(t,e){s.changed=!0,i.set(t,(i.get(t)||0)+e)},e.forEach((t,e)=>{var s=n.get(t);o[`${t}_unit`]=s.unit,Object.defineProperty(o,t,{get:()=>(i.get(t)||0)+(s.value||0),set(e){o.set(t,e)}})}),o.toVector=function(){return e.map((t,e)=>{var s=n.get(t);return(i.get(t)||0)+(s.value||0)})},o.join=function(t){return o.toVector().join(t)},o.toString=function(){var e=`${t}:`;for(var s of i.keys()){const t=n.get(s);e+=`${s}(${(i.get(s)||0)+(t.value||0)}${t.unit})`}return e},o.clear=i.clear.bind(i),o}class ao{constructor(t,e,s){this.parent=s,this.three=!0,e=e||[];var r=(t,e,s)=>{this[t]=oo(t,e,this,s)};so.map((t,s)=>{r(t,ro[s],e[s]||Array(ro[s].length).fill(["scale"===t?1:0]))}),this.clear=()=>{this.translate.clear(),this.rotate.clear(),this.scale.clear(),this.skew.clear(),this.perspective.clear()},this.set=(t,e,s)=>{this[s].set(t,e)}}set matrix(t){this[io]=t,this.changed=!0}get matrix(){return this[io]}set changed(t){this.parent.changed=!0}toVector(){return{transform:{translate:this.translate.toVector(),rotate:this.rotate.toVector(),scale:this.scale.toVector()}}}toString(){const t=this[io],e=this.translate,s=this.rotate,r=this.scale;var i;return t?(t.translate(e.toVector()),t.rotateX(s.x),t.rotateY(s.y),t.rotateZ(s.z),t.scale(r.toVector()),i=`transform: ${t.toCSS()}`):i=this.three?`transform: translate3d(${e.x}${e.x_unit}, ${e.y}${e.y_unit}, ${e.z}${e.z_unit})\n\t\t\t\t\t\t\t\t  rotateX(${s.x}${s.x_unit}) rotateY(${s.y}${s.y_unit})\n\t\t\t\t\t\t\t\t  rotateZ(${s.z}${s.z_unit}) scale3d(${r.join(",")})`:`transform: translate(${e.x}${e.x_unit}, ${e.y}${e.y_unit})\n\t\t\t\t\t\t\t\t  rotate(${s.z}${s.z_unit}) scale(${r.x},${r.y})`,i}}class ho{constructor(t,e,s){this.context=e,this.props=s,this.entity=t}hook(t,e,s){t.params=this.props}unhook(t,e){}}var co={hook:(t,e,s)=>new ho(t,e,s)};class lo{static hook(t,e,s){return new lo(t,e,s)}constructor(t,e,s={}){this.props=s,this.entity=t,this.context=e}get properties(){return this.evaledProps?this.evaledProps:("function"==typeof this.props?this.evaledProps=this.props(this.context):this.evaledProps=this.props,this.evaledProps||{})}get id(){return this.entity.id}get name(){return this.entity.name}template(){const t=this.properties.src;return"string"==typeof t?this.getTemplate(t):t&&t.uid?this.getBlock(t.uid):void 0}get css(){return this.properties.props}get params(){return this.properties.params}get block(){}getTemplate(t){return this.entity.site.getTemplate(t)}getBlock(t){return this.entity.site.getBlockTemplate(t)}get(t){return this.properties[t]}}class uo{static getFreq(t,e){const s=.5*e,r=Math.log(s/10)/Math.LN2;return Math.pow(2,r*((t||.4)-1))*s}static getQ(t){return 1e3*function(t){return t*t*t*t}(t/2)}constructor(t,e,s){this.conf=t,this.elem=e,this.parent=s}get props(){return this.conf.props||{}}get config(){return this.props.config}get name(){return this.conf.fname}set props(t){Object.assign(this.conf.props,t),this.reset&&this.reset()}set config(t){Object.assign(this.conf.props.config,t),this.reset&&this.reset()}define(t){Object.keys(t).forEach(e=>{Object.defineProperty(this,e,{configurable:!0,get:t[e],set:t=>{}})})}get output(){return this.node}get input(){return this.node}connect(t){this.source=t[0],this.source.output.connect(this.input)}disconnect(){this.source&&this.source.output.disconnect()}destroy(){}get ctx(){return this.parent.constructor.ctx}}const po=Symbol(),fo=Symbol();class go extends Array{get average(){return this[po]||0}get sum(){return this[fo]||0}set average(t){this[po]=t}set sum(t){this[fo]=t}}const mo=Symbol();class vo{constructor(t){var e;const{source:s}=t;var r=t.settings;if(!s||"analyser"!==s.name)return this.tick=()=>{},this;const i=s.data,n=s.peaks,{data:o,peaks:a}=t;var h,c,l,u;this.reset=()=>{r=t.settings,h=r.worker,c=r.mid,h&&(h.width,h.height),l=i.length,u={mid:c},e=function(t){return{plot(e){t&&t.postMessage({draw:e})}}}(h)},this.reset();const d=()=>{a.length=o.length=l;for(let t=0;t<l;t++){const e=i[t],s=n[t];let r=o[t];r||(r={x:0,y:0,z:0,value:0},o[t]=r);let h=a[t];h||(h={x:0,y:0,z:0,value:0},a[t]=h),r.value=e,h.value=s}e&&e.plot({data:o,peaks:a,params:u})};this.tick=()=>{e&&d()}}}const yo=new WeakMap,wo=new Map;var bo;class xo{static register(t,e){wo.set(t,e)}static get(t){return wo.get(t)}static has(t){return wo.has(t)}static all(){return wo}static get ctx(){if(bo)return bo;const t=window.AudioContext||window.webkitAudioContext;return bo=new t}constructor(t,e,s){this.conf=t,this.elem=e,this.parent=s,this.nodes=(this.conf.nodes||[]).reduce((t,s)=>{var r=xo.get(s.fname);return r&&t.set(s.id,new r(s,e,this)),t},new Map);const r=Array.from(this.nodes.values());this.each=t=>r.forEach(t),this.map=t=>r.map(t)}init(){const t=this.elem;var e=!1;const s=t=>{e||this.ctx.resume().then(()=>{this.each(t=>t.init()),this.connect(),e=!0}).catch(t=>{})};s(),t.addEventListener("play",s),this.destroyEvents=()=>{t.removeEventListener("play",s)}}connect(){const t=this.conf.nodes||[],e=t=>"src"==t.id?this:this.nodes.get(t.id);t.forEach(({id:t,ins:s})=>{const r=this.nodes.get(t);if(r){s.length||(s=[{id:"src",i:"in"}]);var i=s.map(e);r.connect(i)}});const s=this.conf.dests||[];if(!s[0])throw new Error("Atleast one destination must be provided");this.dests=s.map(({id:t})=>{const e=this.nodes.get(t);if(e)return e.output.connect(this.destination),e}).filter(Boolean)}get destination(){return this.ctx.destination}get input(){}get output(){return yo.has(this.elem)||yo.set(this.elem,this.ctx.createMediaElementSource(this.elem)),yo.get(this.elem)}get ctx(){return this.constructor.ctx}get site(){return this.parent.entity.site}destroy(){this.each(t=>t.disconnect()),this.dests&&this.dests.forEach(t=>{t.output.disconnect()}),this.destroyEvents&&this.destroyEvents()}get props(){return this.conf}get name(){return this.conf.name+this.conf.id}get options(){return this.conf&&this.conf.properties||{}}}xo.register("node",uo),xo.register("gain",class extends uo{init(){this.ctx;var t=this.ctx.createGain();t.gain.value=this.config.gain||1,this.node=t,this.reset=()=>{t.gain.value=this.config.gain}}set gain(t){this.node.value=t}}),xo.register("biquad",class extends uo{init(){const t=this.ctx,e=t.createBiquadFilter(),s=this.reset=()=>{const{type:s,gain:r=1,q:i=1,frequency:n=2.5}=this.config;e.type=s,e.frequency.value=uo.getFreq(n,t.sampleRate),e.gain.value=r,e.Q.value=1e3*uo.getQ(i/2)};this.node=e,s()}}),xo.register("equalizer",class extends uo{init(){const t=this.ctx;this.node=t.createGain(),this.outNode=t.createGain();const e=[32,64,125,250,500,1e3,2e3,4e3,8e3,16e3];var s=Object.values(this.config.bands);const r=[],i=(t,i)=>{((t,r,i)=>{t.type=0==i?"lowshelf":i==s.length-1?"highshelf":"peaking";const n=Math.round(i/s.length*10);t.frequency.value=e[n]||16e3,t.gain.value=r.gain,t.Q.value=1})(r[i],t,i)},n=()=>{this.remove(),s.forEach((e,s)=>{const n=t.createBiquadFilter();(r[s-1]||this.node).connect(n),r.push(n),i(e,s)}),r[r.length-1].connect(this.outNode),this.nodes=r};this.reset=()=>{(s=Object.values(this.config.bands)).length!==r.length?n():s.forEach(i)},this.remove=()=>{if(this.node.disconnect(),r.length){for(let t of r)t.disconnect();r.length=0}},n()}get output(){return this.outNode}get input(){return this.node}connect(t){this.source=t[0],this.source.output.connect(this.input)}}),xo.register("analyser",class extends uo{constructor(...t){super(...t);const{res:e}=this.config,s=new Uint8Array(new go(e).fill(0)),r=new Uint8Array(new go(e).fill(0));let i=0,n=0,o=0,a=0;Object.defineProperty(r,"avg",{enumerable:!1,get:()=>i,set(t){i=t}}),Object.defineProperty(r,"average",{enumerable:!1,get:()=>i,set(t){i=t}}),Object.defineProperty(r,"sum",{enumerable:!1,get:()=>n,set(t){n=t}}),Object.defineProperty(s,"avg",{enumerable:!1,get:()=>o,set(t){o=t}}),Object.defineProperty(s,"average",{enumerable:!1,get:()=>o,set(t){o=t}}),Object.defineProperty(s,"sum",{enumerable:!1,get:()=>a,set(t){a=t}}),this[mo]={avg:0,sum:0},this.define({data:()=>s,peaks:()=>r})}init(){const t=this.ctx,e={ByteFrequency:"getByteFrequencyData",TimeDomain:"getByteTimeDomainData"};var s,r,i,n,o;const a=this.data,h=this.peaks,c=[],l=this.node=t.createAnalyser();(this.reset=()=>{const{res:t,fft:a,height:h,maxdec:c,mindec:u,method:d,smoothing:p=.8}=this.config;i=h,r=e[d]||e.ByteFrequency,s=Math.round(Math.abs(t)),l.fftSize=a<=128?128:a,l.smoothingTimeConstant=p,l.maxDecibels=c,l.minDecibels=u,o=new Uint8Array(l.frequencyBinCount),n=Math.floor(o.length/s)})(),this._tick=t=>{l[r](o);let e=0,u=0;for(let t=0;t<s;t++){let r=o[t*n]/256*i;t>=0&&t<=s&&(a[t]=r),e+=r;let l=h[t]||0;const d=c[t]||.1;c[t]=1.1*d,l>0&&(l-=Math.floor(d),l<0&&(l=0)),l<r&&(l=r,c[t]=.1),h[t]=l,u+=l}a.avg=e/s,a.sum=e,h.avg=u/s,h.sum=u}}tick(t){this._tick&&this._tick(t)}}),xo.register("meter",class extends uo{constructor(...t){super(...t);const{length:e=50}=this.config,s={volume:0,channels:[]};for(let t=0;t<2;t++){const t={volume:0,peaks:new Array(e).fill(0),peaksd:new Array(e).fill(0),data:new Array(e).fill(0)};s.channels.push(t)}this.define({data:()=>s})}init(){const t=this.ctx,e=[],s=[],r=this.ctx.createGain();if(this.props.off)return;for(let s=0;s<2;s++){const s=t.createAnalyser();s.smoothingTimeConstant=.3,s.fftSize=1024,e.push(s)}const i=t.createChannelSplitter();i.connect(e[0],0,0),i.connect(e[1],1,0),r.connect(i);const n=this.data;this.destroy=()=>{i.disconnect()},this.node=r,this._tick=t=>{const r=this.config.length||50,i=(this.config.fall||80)/100;let o=0;for(let t=0;t<2;t++){const a=e[t];a.array||(a.array=new Uint8Array(a.frequencyBinCount));const{array:h}=a;a.getByteFrequencyData(h);const{length:c}=h,l=Math.floor(c/r),u=h.reduce((t,e)=>t+e,0);s[t]||(s[t]=0);const d=u/c;s[t]+=((d||0)-s[t])*i,o+=d;const p=n.channels[t];p.peaks.length=p.peaksd.length=p.data.length=r,p.volume=s[t],p.peaks.push(d),p.peaksd.push(p.volume),p.peaks.shift(),p.peaksd.shift();for(let t=0;t<r;t++){const e=h[t*l]/256*100;p.data[t]=e}}n.volume=o/2}}tick(t){this._tick&&this._tick(t)}connect(t){this.source=t[0],this.source.output.connect(this.input)}}),xo.register("spanner",class extends uo{init(){this.ctx;const t=this.ctx.createStereoPanner();this.node=t,this.reset=()=>{const{pan:e=0}=this.config;this.props.off?t.pan.value=0:t.pan.value=e},this.reset()}set pan(t){this.node.pan.value=t}}),xo.register("visualizer",class extends uo{constructor(...t){super(...t),this.data=new Array,this.peaks=new Array,this.settings={}}init(){const t=this.ctx;this.node=t.createGain(),this.outNode=t.createGain(),(this.reset=()=>{this.settings.mid=this.config.mid,this.getWorker().then(()=>{this.visualizer&&this.visualizer.reset&&this.visualizer.reset()})})(),this._tick=t=>{this.visualizer&&this.visualizer.tick()}}async getWorker(){delete this.settings.worker;const t=this.config.canvas&&this.config.canvas[0];if(t){const[e,s]=this.parent.site.getComponentById(t);s&&s.getWorker&&(this.settings.worker=await s.getWorker())}}tick(t){this._tick&&this._tick(t)}get output(){return this.outNode}get input(){return this.node}connect(t){this.source=t[0],this.source&&this.source.output.connect(this.input),this.visualizer=new vo(this)}});class Eo{constructor(t,e,s){this.conf=t,this.elem=e,this.parent=s}get props(){return this.conf.props||{}}get config(){return this.props.config}get name(){return this.conf.fname}set props(t){Object.assign(this.conf.props,t),this.reset&&this.reset()}set config(t){Object.assign(this.conf.props.config,t),this.reset&&this.reset()}define(t){Object.keys(t).forEach(e=>{Object.defineProperty(this,e,{configurable:!0,get:t[e],set:t=>{}})})}get output(){return this.node}get input(){return this.node}connect(t){this.source=t[0],this.source.output.connect(this.input)}disconnect(){this.source&&this.source.output.disconnect()}destroy(){}get ctx(){}}const _o=new Map;class ko{static register(t,e){_o.set(t,e)}static get(t){return _o.get(t)}static has(t){return _o.has(t)}static all(){return _o}static get ctx(){}constructor(t,e,s){this.conf=t,this.elem=e,this.parent=s,this.nodes=(this.conf.nodes||[]).reduce((t,s)=>{var r=ko.get(s.fname);return r&&t.set(s.id,new r(s,e,this)),t},new Map);const r=Array.from(this.nodes.values());this.each=t=>r.forEach(t),this.map=t=>r.map(t)}init(){this.elem}connect(){const t=this.conf.nodes||[],e=t=>"src"==t.id?this:this.nodes.get(t.id);t.forEach(({id:t,ins:s})=>{const r=this.nodes.get(t);if(r){s.length||s.push({id:"src",i:"in"});var i=s.map(e);r.connect(i)}});const s=this.conf.dests||[];if(!s[0])throw new Error("Atleast one destination must be provided");this.dests=s.map(({id:t})=>{const e=this.nodes.get(t);if(e)return e.output.connect(this.destination),e})}get destination(){return this.ctx.destination}get input(){}get output(){this.elem}get site(){return this.parent.entity.site}destroy(){this.each(t=>t.disconnect()),this.dests&&this.dests.forEach(t=>{t.output.disconnect()}),this.destroyEvents&&this.destroyEvents()}get props(){return this.conf}get name(){return this.conf.name+this.conf.id}get options(){return this.conf&&this.conf.properties||{}}}ko.register("noise",class extends Eo{init(){this.reset=()=>{},this.reset()}});const So=new Map;class Oo{static register(t,e){So.set(t,e)}static get(t){return So.get(t)}static has(t){return So.has(t)}static all(){return So}static get ctx(){}constructor(t,e,s){this.conf=t,this.elem=e,this.parent=s,this.filters=Object.keys(this.conf).reduce((t,s)=>{const r=Oo.get(s);return r&&t.set(s,new r(this.conf[s],e,this)),t},new Map);const r=Array.from(this.filters.values());this.each=t=>r.forEach(t),this.map=t=>r.map(t),e.filters=this.filters}init(){}connect(){this.each(t=>t.connect())}disconnect(){this.each(t=>t.disconnect())}get destination(){return this.ctx.destination}get input(){}get output(){this.elem}get site(){return this.parent.entity.site}destroy(){this.each(t=>t.destroy())}get props(){return this.conf}get name(){return this.conf.name+this.conf.id}get options(){return this.conf&&this.conf.properties||{}}}const To=new WeakMap,Co={},No=Symbol.for("tick");class Mo{static register(t,e){Co[t]=e}static registerNode(t,e,s){Co[t].register(e,s)}static get(t){return Co[t]}static hook(t,e,s){return new this(s,e,t)}static all(){return Co}static getFiltersFor(t){return To.get(t)}constructor(t,e,s){this.conf=t,this.context=e,this.entity=s}get props(){return this.conf}create(t,e){e&&e.destroy(),this.filters=Object.keys(this.conf).reduce((e,s)=>{const r=Mo.get(s);return r&&(e[s]=new r(this.conf[s],t,this)),e},{}),To.set(t,this.filters);const s=Object.keys(this.filters).map(t=>this.filters[t]);this.each=t=>s.forEach(t),this.each(t=>{s.map(t=>t.map(t=>{this.context.parent.define({[t.name]:t})}))}),this.init=()=>{this.each(t=>t.init()),s.map(t=>t.map(t=>{}));const t=s.map(t=>t.map(t=>t.tick&&t.tick.bind(t))).flat().filter(t=>!!t);this.tick=e=>t.forEach(t=>t(e))}}destroy(t){this.each(t=>t.destroy())}attached(t,e){this.init()}set tick(t){this[No]=t,this.entity.removeTick(this.name,this.elem,this),t&&this.entity.addTick(this.name,this.elem,this)}get tick(){return this[No]}hook(t,e,s){this.elem=t,this.create(t,s),setTimeout(()=>{this.attached(t,s)})}unhook(t,e){this.entity.removeTick(this.name,t,this),this.destroy(t),To.delete(t)}}Mo.register("audio",xo),Mo.register("canvas",ko),Mo.register("webgl",Oo);const{NODES:Ao,HOOKS:jo,STYLES:Po,CONTEXTS:Lo,STATES:Ro,TICKS:$o}=Zr,Io=[],Do=["events","exprs","scroll","scroller","modifiers","properties","logic","nodes","params"],zo={exprs:sn,events:Wn,scroll:wn,scroller:mn,properties:no,logic:lo,nodes:Mo,params:co};Object.assign(zo,_n.all());class Fo extends hi{get selector(){return this.conf.selector||`.${this.conf.name}`}get domselector(){return this.selector}addTick(t,e,s){this[$o]||(this[$o]=new Set),this[$o].add(s)}addStyle(t){this.styleset||(this.styleset=new Set),this.styleset.add(t)}removeStyle(t){this.styleset&&this.styleset.delete(t)}removeTick(t,e,s){this[$o]&&this[$o].delete(s)}getTicks(t){return this[$o]}getHook(t,e){var s=e[jo],r=this.conf[t]||{},i=e.state.id;const n="logic"!==t;var o=n&&"function"==typeof r.default?r.default(e):r.default,a="default"!==i?n&&"function"==typeof r[i]?r[i](e):r[i]:null,h=n?o===a?o:a?_.merge({},o,a):o:a||o,c={};const l=(t,r)=>{var i,n=s[t];n&&(i=n.props),vi.isEqual(i,r)&&n?c[t]=n:(s[t]=zo[t].hook(this,e,r),c[t]=s[t])};return Array.isArray(h)&&!zo[t]?h.forEach(t=>{l(t.name,t)}):l(t,h),c}getHooks(t,e){var s={},r=this.conf;return r.ctxt?(Do.map(e=>{r.hasOwnProperty(e)&&Object.assign(s,this.getHook(e,t))}),e&&"function"==typeof e.hook&&(e.entity=this,s.component=e),s):s}getAttrs(t,e){var s=Object.assign({},t),r=e.state;return r&&"default"!==r&&s.class&&(s.class+=` ${r.className}`),s}getParams(t){if(!this.conf.styles)return;const e=t.state,s=e&&e.id||"default",r=this.conf.styles.default||{},i=this.conf.styles[s];return Object.assign({},r,i)}get states(){if(!this[Ro]){this[Ro]=(this.conf.states||[]).map(t=>this.site.findState(t)).filter(t=>!!t);var t=this.site.findState(ti.DEFAULT);this[Ro].unshift(t),Object.defineProperty(this[Ro],"default",{enumerable:!1,get:function(){return t}})}return this[Ro]}hasState(t){for(let e of this.states)if(t.id===e.id)return!0}changeState(t,e,s){this.hasState(t)&&this.setState(t,e,s);var r=this.children||[];s?Array.from(s).map(s=>{r.forEach(r=>{r.changeState(t,e,s.children)})}):r.forEach(s=>{s.changeState(t,e)})}setState(t,e={},s=null){this.inprogress=!0,s=s||this.getnodes();const r=t=>{this.site.nodecache.delete(this)};for(let i of Array.from(s)){let s=t,n=Qi.get(i);if(!n)continue;let o=n.state;if("remove"===e.toggle){if(o!==t)continue;s=null}else if(o===s&&!e.toggle)continue;o===s?e.toggle&&(n.setState(null),r()):(n.setState(s),r())}setTimeout(()=>{this.inprogress=!1},50)}getnodes(){if(this[Ao])return this[Ao];var t=this.domselector;if(!t)return Io;if(this.isWebGL){if(!this.site.WEBGL_DOC)return Io;this[Ao]=this.site.WEBGL_DOC.getElements(t.replace(".",""))}else if(this.isCanvas){if(!this.site.CANVAS_DOC)return Io;this[Ao]=this.site.CANVAS_DOC.getElements(t)}else this[Ao]=document.querySelectorAll(t)||[];return this[Lo]=Array.from(this[Ao]).map(t=>Qi.get(t)).filter(t=>!!t),this[Ao]}getTransform(t){let e=t.state;return(this.conf.properties[e?e.id:"default"]||{}).transform.transform}get nodes(){return this.getnodes()}tick(t){var e=this.getTicks();if(e)for(let s of e)s.tick(t);const s=this.styleset;if(s)for(const t of s)t.apply()}}class qo extends Array{static from(t,e){return Object.keys(t||{}).reduce((s,r)=>(e?e(s,t[r]):s.push(t[r]),s),new qo)}push(t){t.name&&(this[t.name]=t),t.id&&(this[t.id]=t),super.push(t)}add(t,e){e&&(this[e]=t),this.push(t)}prepend(t,e){e&&(this[e]=t),this.unshift(t)}get(t){return this[t]}}class Wo extends Fo{constructor(t,e){super(t,e),this.isWebGL="webgl"==this.ns,this.isCanvas="canvas"==this.ns,this.isSVG="svg"==this.ns,this.isLogic="logic"==this.ns}get children(){return[]}get parent(){return this.conf.par&&this.page.elements[this.conf.par]||this.page}}const{CACHE:Vo,CONF:Uo,HOST:Ho,EXEC:Bo,KEY:Xo,PREV_KEY:Go,DESCR:Yo}=Zr;class Jo{constructor(t,e){this[Ho]=e,this.refresh(t)}refresh(t){this[Uo]=t,this[Xo]=this.getCacheKey(),this[Vo]=null,this.init()}get conf(){return this[Uo]}get key(){return this[Xo]}get exec(){return this[Bo]}set exec(t){return this[Bo]=t}init(){var t=this.conf.exec;if(!t){const e=Object.values(this.conf.args);t=t=>this._exec(t,...e)}this[Bo]=t}get isSelfScoped(){return"self"===this.conf.settings._scope}get id(){return this.conf.id}get name(){return this.conf.settings._name||this.id}get value(){return this[Ho].value}get host(){return this[Ho]}getCacheKey(t){return this[Go]=this[Xo],`_ch_${this.id}_${t||Date.now()}`}get cache(){return this[_cache_]||(this[_cache_]={}),this[_cache_]}getCache(t){var e;e=this.isSelfScoped?this.cache:t.cache,this[Go]&&delete e[this[Go]];const s=this[Xo];return e[s]||(e[s]={lastTime:t.time}),e[s]}}const{ROUTE:Ko,DESCR:Qo,CHILDREN:Zo}=Zr;class ta extends Fo{constructor(t,e){super(t,e),this._selector=".page";const s=Yr.h;this.options={h:s,incl:t=>s("include",{logic:{src:t}},[]),getContentFor:(t,e)=>this.contentFor(t,e),getModifiersFor:t=>this.getModifiersFor(t),getScroller:t=>e=>this.getScroller(t,e),getScroll:t=>e=>this.getScroll(t,e),getProps:t=>(e,s)=>this.getProps(t,e,s),getAttrs:(t,e)=>(s,r)=>this.getAttrs(e,t,s,r),getConfigFor:t=>(e,s)=>this.getConfigFor(t,e,s),getParams:t=>(e,s)=>this.getParams(t,e,s)}}get[Qo](){return["id","name","type"]}refresh(t){super.refresh(t),this[Zo]=null,delete this[Ko]}get domselector(){return this._selector}get template(){return this.conf.template}get route(){if(void 0===this[Ko]){var t=this.conf.settings&&this.conf.settings.url;this[Ko]=t?JSON.parse(t):null}return this[Ko]}get children(){if(this[Zo])return this[Zo];var t={site:this.site,page:this};return this[Zo]=qo.from(this.conf.entities,(e,s)=>{var r=Wo.getInstance(s,t);e.push(r)}),this[Zo]}get entities(){return this.conf.entities}get elements(){return this.children}get cssProps(){return this.conf.cssProps}get jsProps(){return this.conf.jsProps}get templateSettings(){return this.conf.settings}getEntity(t){return this.conf.entities[t]}contentFor(t,e){const s=this.getEntity(t);if(s.content){const t=s.content(e,this.options),r=e.state+"";return t&&(t[r]||t.default)||""}}getModifiersFor(t,e){const s=this.getEntity(t);return s&&s.modifiers&&s.modifiers.default?s.modifiers.default:null}getConfigFor(t,e){const s=this.getEntity(t);return s&&s.config&&s.config.default?s.config.default:null}getEventsFor(t,e){return this.elements.get(t).getHook("events",e)}getExpressionsFor(t,e){return this.elements.get(t).getHook("exprs",e)}getScroller(t,e){return t===this.id?mn.hook(e,{conf:this.conf.scroll},document.body):vi.measure("scroller for entity",()=>this.elements.get(t).getHook("scroller",e))}getScroll(t,e){return vi.measure("scroll hook",()=>this.elements.get(t).getHook("scroll",e))}getProps(t,e,s){var r=t==this.id?this:this.elements.get(t);if(r){var i=r.getHooks(e,s);return r==this&&(i.key=r.id),i}if(s&&"function"==typeof s.hook){var n=new Fo({id:t},{page:this,site:this.site});return this.elements.add(n,t),n.getHooks(e,s)}}getAttrs(t,e,s){var r=t==this.id?this:this.elements.get(t);return e["data-eid"]=t,r?r.getAttrs(e,s):e}getParams(t,e){var s=t==this.id?this:this.elements.get(t);return s?s.getParams(e):{}}async loadTemplate(){if(!this.template){const t=await import(`/${this.conf.url}`);Object.assign(this.conf,t.default)}}async resolve(t){await this.loadTemplate();var e,s=this.templateSettings;if(s&&s.collection&&(e=await s.collection(t)||[],t.collection=function(t,e){const s=t.items,r={get(t,r){if(r in t)return t[r];if(r in s){const t=s[r];return t instanceof Jo?t.exec(e):t}}};return new Proxy(t,r)}({items:e,length:e.length},t)),"item"==this.conf.type){let s;if(t.route){var r=t.route&&t.route.params.slug;r&&(s=e.get(r))}else s=e[0];t.item=s}return this.conf.type,Promise.resolve({})}render(t,e=[]){return(this.jsProps||[]).map(e=>{const{_fname:s,_ftype:r,_flist:i}=e;var n,o=!1,a=e=>"function"==typeof e?e(t):e;s&&Object.defineProperty(t,s,{configurable:!0,get(){if(o)return a(n);var e=t.parent?t.parent[s]:void 0;return void 0===e?"test default":a(e)},set(t){o=!0,n=t}})}),e.forEach(e=>{t[e.key]=e.val}),this.template(t,this.options)}tick(t){super.tick(t);for(var e=this.children,s=0,r=e.length;s<r;s++)e[s].tick(t)}}class ea extends ta{}const{METHODS:sa,CONF:ra,SITE:ia}=Zr,na=function(t=Object){return class extends t{static get[Symbol.species](){return t}constructor(t,e){super(),this[ra]=t,this.setArgs(e),this.init(t,e),this[sa]={},this.attachMethods()}setArgs(t){}init(t,e){this[ia]=e.site,this.initData()}initData(){}get site(){return this[ia]}get conf(){return this[ra]}get name(){return this.conf.name}get id(){return this.conf.id}get currentProps(){return this.conf.properties.default.properties}get settings(){return this.currentProps.settings||{}}refresh(t){t&&(this[ra]=t,this.initData(),this.attachMethods())}render(){this.site.render()}toFunc(t){return"function"==typeof t?t:new Function("context",`return ${t}`)}unsetMethod(t){delete this[t],delete this[sa][t]}setMethod(t){if(!t)return;const e=t.klass;if(!(t.settings&&t.settings._name&&e))return;const s=t.settings._name;var r;if(this[sa][s])(r=this[sa][s]).refresh(t);else{let s=this.constructor[e];if(!s)return;r=new s(t,this)}return this[s]&&"function"==typeof this[s]&&(this["__"+s]=this[s].bind(this)),this[sa][s]=this[s]=r,s}attachMethods(){this[sa]||(this[sa]={});const t=this.currentProps.methods||{},e=Object.keys(t).map(e=>this.setMethod(t[e])),s=Object.keys(this[sa]);for(let t of s)-1===e.indexOf(t)&&this.unsetMethod(t,this[sa][t])}get methods(){return this[sa]}cache(t){}}},oa=Symbol("index"),aa=Array.prototype.slice;class ha extends(na(Array)){constructor(t,e){super(t,e)}initData(){this.length=0,(this.currentProps.list||[]).forEach(t=>{this.push(t)}),this.index=this.currentProps.index||0}get index(){return this[oa]||0}set index(t){this[oa]=vi.cycle(+t,0,this.length)}get current(){return this[this.index]}set current(t){var e;e="number"==typeof t?t:this.indexOf(t),this.index=e}get first(){return this[0]}get last(){return this[this.length-1]}get random(){return this[Math.floor(Math.random()*this.length)]}get shuffle(){for(var t=aa.call(this),e=t.length-1;e>0;e--){var s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t}}ha.expression=class extends Jo{_exec(t,e){return e}};class ca extends(na(Object)){}const{TWEENJS:la,TWEEN:ua}=Ss,da=Symbol("max"),pa=Symbol("min"),fa=Symbol("options"),ga=Symbol("value");class ma extends(na(Number)){initData(){this[fa]=this.currentProps.settings.options;var t=this[fa];this[da]=t.max?this.toFunc(t.max):function(){return 1/0},this[pa]=t.min?this.toFunc(t.min):function(){return-1/0},this.set(this.currentProps.settings.num)}set(t,e){const s=this[fa],r=s.rounding||"none",i=s.bounds||"clamp",n=this.site.context,o=[this[pa](n),this[da](n)],a=Math.max(...o),h=Math.min(...o);var c=e?+(this.value+t):t;"none"!==i&&(c="wraparound"===i?vi.cycle(c,h,a):vi.clamp(c,h,a)),c="none"!==r?(Math[r]||(t=>t))(c):c,this[ga]=c}set value(t){this.setValue(t)}get value(){return this[ga]}toString(){return this.value}valueOf(){return this.value}[Symbol.toPrimitive](t){return this.value}}const va=la(function(){return 0});va.Interpolation.None=function(t,e){const s=t.length-1,r=Math.round(s*e);return e<0?t[0]:e>1?t[s]:t[r]};class ya extends Jo{_exec(t,e,s,r,i,n,o){s=1e3*(s||1);const a=this.getCache(t);let h;a.TWEEN||(a._time=0,this.create(a,t,e,s,r,i,n)),(void 0===o||isNaN(+o))&&(o=t.time),a._time=h=+o;const c=Math.floor(h/s);void 0!==i&&c>i&&(h=s);const l=(h+r/2*1e3)%s;a.curTime=l;for(let t of a.tweens)if(l>=t.startat&&l<t.endat){t.update(l);break}return a.val}}ma.sin=class extends Jo{_exec(t,e,s){return Math.sin(t.time/1e3*s*this.value+e)}},ma.cos=class extends Jo{_exec(t,e,s){return Math.cos(t.time/1e3*s*this.value+e)}},ma.tan=class extends Jo{_exec(t,e,s){return Math.tan(t.time/1e3*s*this.value+e)}},ma.force=class extends Jo{_exec(t,e,s,r){const i=t.time/1e3*s*this.value+e,n=this.getCache(t);return void 0===n.val&&(n.val=0),n.val+=i,r&&n.val>r&&(n.val=0),n.val}},ma.square=class extends Jo{_exec(t,e,s){return Math.sign(Math.sin(t.time/1e3*s*this.value+e/2))}},ma.triangle=class extends Jo{_exec(t,e,s){const r=(t.time/1e3*s*this.value+e)/2;return 2*Math.abs(r%2-1)-1}},ma.sawtooth=class extends Jo{_exec(t,e,s){const r=(t.time/1e3*s*this.value+e/2)/2;return 2*Math.abs(r%1-1)-1}},ma.random=class extends Jo{_rand(t,e){return Math.random()*(e-t)+t}_exec(t,e,s,r,i,n){const o=this.value;if(!o)return 0;const a=this.getCache(t),h=t.time/1e3*s*this.value+e,c=2*Math.round(h/2);return a.p!==c&&(a.p=c,a.value=this._rand(+r,+i),n&&(a.val||(a.val=0),a.to||(a.to={val:a.value}),a.to.val=a.value,a.tween=a.tween||(()=>{const t=new ua.Tween(a);return t.to(a.to,Math.abs(1e3*+n/o)),t.easing(ua.Easing.Quadratic.InOut).repeat(0),t})(),a.tween.start())),(n?a.val:a.value)||0}},ma.interpolate=class extends ya{create(t,e,s,r,i,n,o,a){const h=[];this._TWEENS=[],"number"==typeof s&&(s=[0,s]),t.TWEEN=va;const c={};c.val=s,t.val=c.val[0];const l=o||"None",u=va.Interpolation[l]||va.Interpolation.None,d=new va.Tween(t),p=va.Easing.Linear.None;d.interpolation(u),d.to(c,r).repeat(0).easing(p),d.start(0),d.startat=0,d.endat=r,h.push(d),this._TWEENS.push(d),t.duration=r,t.tweens=h}refresh(t){if(super.refresh(t),this._TWEENS){for(let t in this._TWEENS)t&&t.stop&&t.stop();this._TWEENS.length=0}}},ma.expression=class extends Jo{_exec(t,e){return e}},ma.vector=class extends Jo{_exec(t,e,s,r){const i=this.getCache(t);i.vec||(i.vec=new Un);var n=i.vec;return n.set(e,s,r),n}},ma.pulse=class extends Jo{_exec(t,e,s,r=[]){let i=(t.time/1e3*s/10*this.value+e)%1;return i<0&&(i+=1),r[Math.floor(i*r.length)]}};const wa=Array.prototype.slice,ba=Array.prototype.sort,xa=Array.prototype.filter,Ea=Array.prototype.find;class _a{constructor(t){"object"!=typeof t?this.url=t:Object.assign(this,t)}toString(){return this.url}}class ka{constructor(t,e){if(e&&e.schema){var s=t=>t&&t.ref&&t.id?e.site.findFile(t.id):new _a(t);for(let r of e.schema){let e=t[r._fname],i=r._ftype,n="list"===r._flist;switch(n&&!Array.isArray(e)&&(e=[]),i){case"image":case"file":case"audio":case"video":e=n?e.map(s):s(e)}this[r._fname]=e}}else Object.assign(this,t)}}class Sa extends ha{initData(){const t=this.currentProps.list||[];this.replace(t),this.index=this.settings.index||0}replace(t){this.length=0,t.forEach(t=>{this.push(t)})}push(t){super.push(new ka(t,this))}get schema(){const t=this.settings;return t.schema?t.schema:[]}}Sa.filter=class extends Jo{_exec(t,e,s){return e?xa.call(this.host,t=>s instanceof RegExp?String(t[e]).match(s):t[e]===s):this.host}},Sa.pluck=class extends Jo{_exec(t,e){return e?this.host.map(t=>t[e]):[]}},Sa.groupby=class extends Jo{_exec(t,e){return e?this.host.reduce((t,s)=>{var r=s[e];return(t[r]=t[r]||[]).push(s),t},{}):{}}},Sa.sortby=class extends Jo{_exec(t,e){return e?ba.call(this.host,(t,s)=>t[e]-s[e]):this.host}},Sa.shuffle=class extends Jo{_exec(t,e){for(var s=wa.call(this.host),r=s.length-1;r>0;r--){var i=Math.floor(Math.random()*(r+1));[s[r],s[i]]=[s[i],s[r]]}return s}},Sa.chunk=class extends Jo{_exec(t,e){var s=this.host,r=[];if(!e)return s;for(var i=0;i<s.length;i+=e)r.push(wa.call(s,i,e+i));return r}},Sa.slice=class extends Jo{_exec(t,e,s){var r=this.host;return wa.call(r,e,e+s)}},Sa.last=class extends Jo{_exec(t){return this.host[this.host.length-1]}},Sa.first=class extends Jo{_exec(t){return this.host[0]}},Sa.at=class extends Jo{_exec(t,e){return this.host[e]}},Sa.find=class extends Jo{_exec(t,e,s){return e?Ea.call(this.host,t=>s instanceof RegExp?String(t[e]).match(s):t[e]===s):this.host}},Sa.random=class extends Jo{_exec(t){return this.host[Math.floor(Math.random()*this.host.length)]}},Sa.expression=class extends Jo{_exec(t,e){return e}},Sa.sum=class extends Jo{_exec(t,e){return e?this.host.reduce((t,s)=>t+ +s[e],0):0}},Sa.avg=class extends Jo{_exec(t,e){return e?this.host.reduce((t,s)=>t+ +s[e],0)/this.host.length:0}};class Oa extends Array{}class Ta extends(na(Array)){initData(){this.length=0,(this.source||[]).forEach(t=>{this.push(new Oa(...t))})}get source(){return(this.currentProps.settings.data||{}).rows}}Ta.filter=class extends Jo{_exec(t){}},Ta.slice=class extends Jo{_exec(t,e,s){return this.host.slice(e,s)}};class Ca extends(na(String)){}Ca.filter=class extends Jo{_exec(t){}};const Na=Symbol("props");class Ma extends(na(Object)){init(t,e){this.initData()}initData(){this.currentProps.settings.from;var t=(this.currentProps.settings.data||{}).src||{};if(this[Na])for(let t of this[Na])delete this[t];this[Na]=Object.keys(t),Object.assign(this,t)}set name(t){}refresh(t){super.refresh(t),this.initData()}}Ma.filter=class extends Jo{_exec(t){}};const Aa=Symbol("raf");class ja extends(na(Array)){initData(t,e){let s=this.currentProps.settings,r=s.intervals||"1000";this.initTimer(r,s.options)}fireEvents(t){this.site.triggerEvent(`${this.name}-${t}`)}initTimer(t,e={}){var s;cancelAnimationFrame(this[Aa]);const r=this,i=t=>(r.length=r.current=r.elapsed=0,"string"==typeof t&&(t=t.split(",")),Array.isArray(t)||(t=[t]),t=t.map(t=>+t).filter(t=>!!t),r.time=t.reduce(function(t,e){return t+e},0),t.map(t=>{this.push({time:t,elapsed:0,toString(){return this.elapsed/this.time*100}})}),t);this.start=e=>{cancelAnimationFrame(s);var n=i(e||t);if(!n.length)return;this.fireEvents("start");let o,a=0,h=0,c=n[0];var l=t=>{o||(o=t),h=t-o,r.elapsed+=h-a;let e=r[r.current];r.elapsed>=c?(e.elapsed=e.time,r.current+=1,r.current>=n.length&&(r.current=0,c=0),this.fireEvents("done"),c+=n[r.current]||0):e&&(e.elapsed=Math.abs(e.time-(c-h))),r.elapsed<r.time?this[Aa]=s=requestAnimationFrame(l):(r.elapsed=r.time,this.fireEvents("end")),a=h};this[Aa]=s=requestAnimationFrame(l)},e.autostart?this.start():i(i)}toString(){return this.elapsed/this.time*100}}const Pa=Symbol("view"),La=Symbol("promise"),Ra=Symbol("meta"),$a=Symbol("name"),Ia=Symbol("data");class Da{constructor(t){Object.assign(this,t)}}class za extends Array{constructor(t,{items:e=[],meta:s={}}={}){super(),this[$a]=t,this[Ra]=s;var r=new Map;const i=(t,e)=>(t.forEach(t=>{t=new Da(t),e.push(t),r.set(t.id,t),r.set(t.slug,t),t.children&&t.children.length&&(t.children=i(t.children,[]))}),e);i(e,this),Object.defineProperty(this,"items",{enumerable:!1,configurable:!1,get:()=>r})}get(t){return this.items.get(t)}where(t){return _.find(this,t)}}const Fa=Symbol(),qa={},Wa={},Va={number:ma,collection:Sa,json:Ma,csv:Ta,array:ha,string:Ca,timer:ja,remote:class extends Sa{constructor(t,e){super(t,e),this.status="loading",this[Pa]=this.settings.view}get view(){return this[Pa]}set_view(t){var e=this.settings.route,s=e&&this.site.router.routes.find(t=>t.url===e);return this[Pa]=t,s.resolve({view:t}).then(t=>{this.replace(t)})}set(t,e){var s=this[`set_${t}`];if(s)return s.call(this,e);this[t]=e}},service:class extends ca{constructor(t,e){super(t,e)}get value(){return this.initialize()}fetch(){if(this[La])return this[La];const{query:t,resource:e={}}=this.settings;if(!t)return;const s=`/${e.name}/graphql`;return this.status="loading",this[La]=this.site.request.post(s,{query:t},{}).then(t=>(this.status="done",Object.keys(t.data||{}).reduce((e,s)=>(e[s]=new za(s,t.data[s]||{}),e),{}))),this[La]}initialize(){return this[Ia]?Promise.resolve(this[Ia]):this.fetch().then(t=>(this[Ia]=t,Object.keys(t).forEach(e=>{Object.defineProperty(this,e,{configurable:!0,get:()=>t[e]})}),this[Ia]))}loadSchema(){this.fetch()}refresh(t){super.refresh(t),this.loadSchema()}},object:ca};class Ua extends Fo{constructor(t,e){super(t,e)}static getInstance(t,e){var s=Va[t.type];return e.klass=s,super.getInstance(t,e)}}class Ha extends Fo{constructor(t,e){super(t,e),this.init()}init(){var t=this.qs.replace(/^@media\s?/,""),e=window.matchMedia(t);this.matches=e.matches,e.onchange=t=>{this.matches=e.matches}}refresh(t){super.refresh(t),this.init()}get qs(){return this.conf.qs}get[Zr.DESCR](){return["name","matches","qs"]}toString(){return this.matches}}function Ba(t){for(var e=new Array(t.length),s=0;s<t.length;s++)"object"==typeof t[s]&&(e[s]=new RegExp("^(?:"+t[s].pattern+")$"));return function(s,r){for(var i="",n=r&&r.encode||encodeURIComponent,o=0;o<t.length;o++){var a=t[o];if("string"!=typeof a){var h,c=s?s[a.name]:void 0;if(Array.isArray(c)){if(!a.repeat)throw new TypeError('Expected "'+a.name+'" to not repeat, but got array');if(0===c.length){if(a.optional)continue;throw new TypeError('Expected "'+a.name+'" to not be empty')}for(var l=0;l<c.length;l++){if(h=n(c[l],a),!e[o].test(h))throw new TypeError('Expected all "'+a.name+'" to match "'+a.pattern+'"');i+=(0===l?a.prefix:a.delimiter)+h}}else if("string"!=typeof c&&"number"!=typeof c&&"boolean"!=typeof c){if(!a.optional)throw new TypeError('Expected "'+a.name+'" to be '+(a.repeat?"an array":"a string"));a.partial&&(i+=a.prefix)}else{if(h=n(String(c),a),!e[o].test(h))throw new TypeError('Expected "'+a.name+'" to match "'+a.pattern+'", but got "'+h+'"');i+=a.prefix+h}}else i+=a}return i}}class Xa{constructor(t,e){var s;this.conf=t,this.router=e,this.re=new RegExp(t.re||"","i"),s=(t.tokens||[]).map(t=>{try{return JSON.parse(t||"")}catch(e){return t}}),this._params=t.keys.reduce((t,e)=>(t[e]="",t),{}),this.toPath=Ba(s)}get url(){return this.conf.url}get methods(){return this.conf.methods}get keys(){return this.conf.keys}get params(){return this._params}set params(t){Object.assign(this._params,t)}toUrl(t){return this.toPath(t)}resolve(t){var e=this.toUrl(t);return this.router.resolve(e)}}class Ga extends Qr{constructor(t,e){super(),this.root="",this.site=e,this.routes=(t||[]).map(t=>new Xa(t,this));const{window:s,document:r}=Ss,{location:i,history:n,URL:o}=s;var a=t=>{this.trigger("change",t)},h=(t,e)=>{if(t&&t.path){var r=this.getPath(t.path);(i=this.find(r))&&this.trigger("change",i)}else if(e.state){var i,n=s.location.hash.replace("#","");n&&((i=this.find(n))&&i.handler&&i.handler(i.params,i),a(i))}else this.site.goTo(this.prevPage||"index")};const c=t=>{t.preventDefault(),h(t.state,t)};s.addEventListener("load",t=>{n.state&&"default"===n.state.state||h(n.state,t)}),s.addEventListener("popstate",c),this.destroy=()=>{s.removeEventListener("popstate",c),this.unbindAll()},setTimeout(()=>{},2e3)}get hash(){const{window:t}=Ss;return(t.location.hash||"").replace("#","")}find(t){return this.routes.find(e=>{var s=e.re.exec(t);if(s)return e.params=e.keys.reduce((t,e,r)=>(t[e]=s[r+1],t),{}),!0})}getPath(t){return t&&"/index"!=t&&"/home"!=t||(t="/"),t}get current(){return this.find(this.hash)}clearSlashes(t){return t.toString().replace(/\/$/,"").replace(/^\//,"")}add(t,...e){var s,r=new Xa(t,this);return"function"==typeof e[0]?(e[0],s=e[1]):s=e[0],r.template=s,this.routes.push(r),r}remove(t){var e=this.routes.indexOf(t);e>=0&&this.routes.splice(e,1)}navigate(t=""){const{window:e}=Ss;t=this.getPath(t);var s=this.find(t);this.prevPage=this.site.currentPageId,s&&(history.pushState({path:t},null,t),s.handler?s.handler(s):this.trigger("change",s),e.scrollTo(0,0))}resolve(t){return this.site.resolveUrl(t)}}const Ya=Symbol("params"),Ja=Symbol.for("describe");class Ka extends hi{constructor(t,e){super(),this.conf=t,this.setArgs(e),this.init()}get[Ja](){return["id","name","params","className"]}get properties(){return this.conf.props&&this.conf.props.properties||{}}get settings(){return this.properties.settings||{}}get options(){return this.properties.options||{}}get router(){return this.site.router}get params(){return this[Ya]}set params(t){this[Ya]=Object.assign({},this[Ya],t)}init(){const{settings:t,options:e}=this;this.params=t.params?t.params.reduce((t,e)=>{if(e.key)return t[e.key]=e.val(this.site.context)||"",t},{}):{},this.route&&this.router.remove(this.route),this.toUrl=this.route=null;const s=()=>{this.site.changeState(this,{}).then(()=>{this.site.render()})};var r=t.history&&t.history.path;r&&(this.route=this.router.add(JSON.parse(r),t=>{this.params=t,s()}));var i=e.resolve&&e.resolve.url;i&&(this.toUrl=Ba(i));var n=e.resolve&&e.resolve.route;n&&(this.toUrl=t=>this.router.routes.find(t=>t.url===n).toPath(t))}refresh(t){this.conf=t,this.clearCaches(),this.init()}clearCaches(){}setArgs(t){this.site=t.site}get isPseudo(){return":"===this.conf.slug.charAt(0)}get className(){return this.name===ti.DEFAULT?"":this.isPseudo?`st_${this.id}`:this.conf.slug}toJSON(){return{name:this.name}}toString(){return this.id}resolve(t={}){var e=this.options;if("remove"===t.toggle)return Promise.resolve(this);var s=Object.assign({method:"POST"},t,e.resolve),r=this.toUrl?this.toUrl(this.params):null;return new Promise((t,e)=>{var i=()=>{t(this)};r?this.site.resolveUrl(r,s).then(t=>{i()}).catch(t=>{e(t)}):i()})}}class Qa{constructor(t,e){t.config&&t.config.name;const s=t.events.map((t,e)=>({pts:t.at,event:t,index:e}));this.tick=t=>{for(let e of s)t>=e.pts[0]&&t<e.pts[1]?e.current||(this.trigger(e),e.current=!0):e.current=!1}}trigger(t){}}class Za{constructor(t,e){this.conf=t,this.parent=e,this.cues=new Qa(t,e)}hook(t,e,s){const r=e=>this.cues.tick(t.currentTime/t.duration*100);t.addEventListener("timeupdate",r),this.destroy=()=>t.removeEventListener("timeupdate",r)}unhook(t){this.destroy()}}const{CHILDREN:th,CONF:eh,PARENT:sh,VERSIONS:rh,DESCR:ih,FOLDERS:nh,CURRENT:oh,INDEX:ah,SRCSET:hh}=Zr,ch={};class lh extends hi{setArgs(t){this.site=t.site,t.parent&&(this.parent=t.parent)}static attachDescriptors(t,e){if(e.length){var s=e.reduce((t,e)=>("dir"===e.type&&(t[e.name]={configurable:!0,enumerable:!1,get:function(){return e}}),t),{});return Object.defineProperties(t,s),t[nh]=s,s}}static findByUrl(t=""){const e=t.split("?")[0];return ch[e]}static findById(t){return ch[t]}static collect(t,e){const s=[];return e.parent||(e.parent=s),(t||[]).map(t=>s.push((lh.types[t.type]||lh).getInstance(t,e))),lh.attachDescriptors(s,s),s}static getInstance(t,e){const s=super.getInstance(t,e),r=s.url.split("?")[0];return ch[s.id]=ch[r]=s,lh.attachDescriptors(s,s.children),s}refresh(t){super.refresh(t),delete this[th],delete this[rh],delete this[hh]}get path(){return this.conf.path}get url(){return this.conf.url}get srcset(){if(!this[hh]){let t=this.conf.versions||[];t.length?this[hh]=[...new Map([[this.width,this.url]].concat(t.flatMap(t=>[[t.width,t.url]].concat((t.resolutions||[]).map(t=>[t.width,t.url]))))).entries()].sort((t,e)=>t[0]-e[0]).map(([t,e])=>`${e} ${t}w`).join(", "):this[hh]=this.url}return this[hh]}get type(){return this.conf.type}get attr(){return this.conf.attr||{}}get meta(){return this.conf.meta||{}}get children(){if(!this[th]){var t={site:this.site,parent:this};this[th]=lh.collect(this.conf.children,t)}return this[th]}get versions(){return this[rh]||(this[rh]=(this.conf.versions||[]).reduce((t,e)=>(t[e.name]=new uh(e,this),t),{})),this[rh]}get[ih](){return["url","type","name","attr","meta"].concat(Object.keys(this[nh]||{}))}map(t){this.children.map(t)}[Symbol.toPrimitive](t){return this.url}}class uh{constructor(t,e){this[eh]=t,this[sh]=e}get[ih](){return["name","url","srcset","width","height","size","type","srcset"]}get type(){return this[sh].type}get name(){return this[eh].name}get url(){return this[eh].url}get srcset(){return this[hh]||(this[hh]=[...new Map([[this.width,this.url]].concat((this[eh].resolutions||[]).map(t=>[t.width,t.url]))).entries()].sort((t,e)=>t[0]-e[0]).map(([t,e])=>`${e} ${t}w`).join(", ")),this[hh]}get width(){return this[eh].width}get height(){return this[eh].width}get size(){return this[eh].size}toJSON(){return this[ih].reduce((t,e)=>(t[e]=this[e],t),{})}toString(){return this.url}}class dh extends lh{get cueEvents(){return this.conf.cue?new Za(this.conf.cue,this):null}get[ih](){return["name","url","type","srcset","versions","attr","meta"]}}class ph extends dh{get duration(){return this.meta.duration}get[ih](){return(super[ih]||[]).concat("duration")}}lh.types={dir:class extends lh{get[ih](){return["name","current","files","children","index"]}valueOf(){return this.children}indexOf(t){return this.children.indexOf(t)}get files(){return this.children}get index(){return this[ah]||0}set index(t){this[ah]=vi.cycle(Math.round(t+0),0,this.children.length)}get current(){return this.children[this.index]}set current(t){var e;e="number"==typeof t?t:this.children.indexOf(t),this.index=e}},image:class extends dh{get width(){return this.conf.width}get height(){return this.conf.height}get colors(){return this.conf.colors||[]}get[ih](){return(super[ih]||[]).concat("width","height","colors")}},audio:ph,video:class extends ph{get width(){return this.conf.width}get height(){return this.conf.height}get[ih](){return(super[ih]||[]).concat("duration","width","height")}}};const fh={css:{}};class gh{static register(...t){for(let e of t){const{name:t}=e;t in fh.css&&gh.unregister(e);try{e.inherits=!0,CSS.registerProperty&&CSS.registerProperty(e),fh.css[t]=e}catch(t){}}}static unregister(...t){for(let e of t){const{name:t}=e;try{CSS.unregisterProperty&&CSS.unregisterProperty(t),delete fh.css[t]}catch(t){}}}static all(){return fh}}class mh{constructor(t){this.vars=t}find(t){return this.vars.get(t)}reset(t){t?this.vars.get(t.id):this.vars.forEach(t=>{})}get values(){let t=document.documentElement;const e=getComputedStyle(t);return this.vars.reduce((t,s)=>(t[s.id]=e.getPropertyValue(`--${s.id}`),t),{})}set(t,s){document.documentElement.style.setProperty("--mouse-x",e.clientX+"px")}}class vh extends Fo{constructor(t,e){super(t,e)}get root(){}get value(){const t=document.documentElement;return getComputedStyle(t).getPropertyValue(`--${this.id}`)}}const yh=Symbol.for("tick"),wh=Symbol("ro");class bh extends Yr.Component{set tick(t){this[yh]=t,this.entity&&this.entity.removeTick("component",this.elem,this),t&&this.entity.addTick("component",this.elem,this)}get tick(){return this[yh]}onResize(t,...e){return this[wh]&&this[wh].destroy(),this[wh]=vi.observeResize(t,e),this[wh]}unhook(t){this[wh]&&this[wh].destroy(),this.entity.removeTick("component",this.elem,this),delete this[wh],delete this.entity,super.unhook(t)}}const xh={},Eh={};class _h{static register(t,e,s={}){if(t in xh)throw new Error("An object definition by that name already exists.");xh[t]=e,Eh[t]=s}static all(){return Eh}static has(t){return t in xh}static get(t,e){return xh[t]}constructor(){}}const kh=Symbol("logger"),Sh=Symbol("route"),Oh=Symbol("pages"),Th=Symbol("templates"),Ch=Symbol("files"),Nh=Symbol("objects"),Mh=Symbol("styles"),Ah=Symbol("states"),jh=Symbol("mediaquery"),Ph=Symbol("compiledata"),Lh=Symbol("router"),Rh=Symbol("css"),$h=Symbol("vars"),Ih=Symbol.for("describe"),Dh=new Set;var zh=new WeakMap;class Fh extends Gr{constructor(t,e){super(e,{},{}),this.conf=t;const s=Qi.$create("site",{site:this},{root:!0},this);Object.defineProperty(s,"route",{configurable:!0,get:()=>this.route,set:t=>{throw new Error("Route cannot be assigned to context")}}),Object.defineProperty(this,"context",{get:function(){return s},set:function(t){s=t}}),s.$initialize(),this.mode="preview",this._runtimeMode="live",this.currentPageId="index",this.scope=s,this.initialize(t)}get runtimeMode(){return this._runtimeMode}set runtimeMode(t){this._runtimeMode,this._runtimeMode=t}get[Ih](){return["session","variables","router","mediaqueries","page"]}get logger(){return this[kh]||console}set logger(t){this[kh]=t}log(...t){this.logger.log(...t)}warn(...t){this.logger.warn(...t)}error(...t){this.logger.error(...t)}registerNode(t,e,s){return Mo.registerNode(t,e,s)}getCustomShader(t){return _h.get(t)}get nodecache(){return zh}clearNodeCaches(){zh=new WeakMap}get settings(){return this.conf.settings||{}}get baseContext(){return this.context}get route(){return this[Sh]}set route(t){this[Sh]=t}initialize(t,e="index"){this.currentPageId=e,t&&(this.conf=t,this[Oh]=null,this[Ah]=null,this[Nh]=null,this[Mh]=null,this[Ch]=null,this[Ph]=null,this[Lh]=null,this[$h]=null),this.initContext(),this.initCustomProperties(),this.initRoutes()}initObjects(){const t=this.context;for(const e of Dh)delete t[e];if(Dh.clear(),this.objects)for(let e of this.objects)e.name in t||(t[e.name]=e,Dh.add(e.name))}initRoutes(){this.router&&this.router.destroy(),this.route=null,this.router=new Ga(this.settings.routes,this),this.router.add({keys:[],re:"^\\/?(?![\\s\\S])"},this.pages.index),this.router.bind("change",(t,e)=>{this.route=t,t.template&&(this.currentPageId=t.template.id,this.vdom=null),this.render()});var t=t=>{var e=t.route;if(e)return this.router.add(e,t)};this.pages.filter(t=>"list"==t.conf.type).map(t),this.pages.filter(t=>"item"==t.conf.type).map(t)}goTo(t){this.currentPageId=t,this.render({clean:!0})}initCustomProperties(){this[Rh]&&gh.unregister(...this[Rh]),this[Rh]=this.pages.reduce((t,e)=>{var s=e.cssProps;return s&&s.length?t.concat(s):t},[]),this.initVariables(),gh.register(...this[Rh])}initVariables(){this.variables=new mh(this.cssvars)}initPlatform(){}initConnection(){const{navigator:t}=Ss.window,e=t.connection||t.mozConnection||t.webkitConnection;e&&(this.connectionChanged=this.connectionChanged||(t=>{this.triggerEvent("connection:change",{})}),e.ontypechange=this.connectionChanged)}initContext(){const t=this.context,{document:e}=Ss;this.mouseMove=this.mouseMove||(e=>{var s,r,i=t.mouse,n=i.x,o=i.y;s=i.x=e.pageX,r=i.y=e.pageY,i.angle=180*Math.atan2(r-o,s-n)/Math.PI}),e.addEventListener("pointermove",this.mouseMove,!1),this.settings.disableMouseMove||e.addEventListener("pointermove",this.mouseMove,!1);var s=this.settings.auth;s&&s.enabled&&(this.session=t.session=new Ur(s,t,this)),this.initObjects(),this.initConnection()}getCollection(t,e,s){return qo.from(this.conf[t]||{},(t,s)=>{t.push(e.getInstance(s,{site:this}))})}get mediaqueries(){return this[jh]||(this[jh]=this.getCollection("mediaqueries",Ha,jh)),this[jh]}get cssvars(){return this[$h]||(this[$h]=this.getCollection("cssvars",vh)),this[$h]}get objects(){return this[Nh]||(this[Nh]=this.getCollection("objects",Ua)),this[Nh]}get pages(){return this[Oh]||(this[Oh]=this.getCollection("pages",ta)),this[Oh]}get templates(){return this[Th]||(this[Th]=this.getCollection("templates",ea)),this[Th]}get styles(){return this[Mh]||(this[Oh]=this.getCollection("styles",ea)),this[Mh]}get states(){const t={site:this};return this[Ah]||(this[Ah]=this.getCollection("states",Ka),ti.DEFAULT_STATES.forEach(e=>{this[Ah].get(e)||this[Ah].add(new Ka({id:e,name:e},t),e)})),this[Ah]}get files(){return this[Ch]||(this[Ch]=lh.collect(this.conf.files,{site:this})),this[Ch]}get defaultState(){return this.states.default}getElementById(t){const{document:e}=Ss;return e.querySelector(`[data-eid="${t}"]`)}getComponentById(t){const{document:e}=Ss,s=e.querySelector(`[data-eid="${t}"]`);return bh.find(s)}findElement(t){return this.page.elements.get(t)}findState(t){return this.states.get(t)}findObject(t){return this.objects.get(t)}findVariable(t){return this.cssvars.get(t)}findEntity(t){return this.pages[t]||this.page.elements.get(t)}findFile(t){var e=s=>{var r=s.find(e=>e.id===t);if(r)return r;for(let t of s){let s=t.children;if(s&&s.length&&(r=e(s)))return r}};return e(this.files)}findFileByUrl(t){return lh.findByUrl(t)}findClosestComponent(t,e){var s=e=>{if(e){if(e.elem==t)return e;for(let t of e.childNodes||[]){let e=s(t);if(e)return e}}},r=t=>{if(t)return t.name===e?t:t.parentNode?r(t.parentNode):void 0};return r(s(this.vdom))}getTemplate(t){return this.templates[t]}getBlockTemplate(t){return this.pages[t]||null}getContext(t,e=!0){return Qi.get(t,e)}findContext(t){return Qi.find(t)}contextValueAt(t){return Qi.valueAtPath(t)}createExpression(t){return new sn.DebugExpr(t)}getFiltersFor(t){return Mo.getFiltersFor(t)}refreshEntity(t){var e=t.id;this.page.elements.get(e).refresh(t.conf)}refreshVars(t){this[$h]=null,this.initVariables(t)}resolveUrl(t,e={}){return new Promise((s,r)=>{const i=this.states.loading,n=()=>{this.removeState(i),this.render()},o=()=>{n(),r()},a=t=>{this.removeState(i),s(t)},h=s=>{var r;const i=()=>{r=this.states.auth_required,this.cancelStateChange=l,this.triggerEvent("auth:start",{}),this.changeState(r),this.render()},c=()=>{this.cancelStateChange=null,r&&this.removeState(r),this.triggerEvent("auth:end",{}),this.session.unbind("success",c),this.request.send(t,e).then(a,h).catch(h)},l=()=>{this.session.unbind("success",c),this.session.unbind("cancel",l),this.removeState(r),this.triggerEvent("auth:cancel",{}),o()};401==s.code?(this.session.bind("success",c),this.session.bind("cancel",l),this.session.authenticate().then(t=>{t?c():i()},t=>{i()}).catch(t=>{i()})):(()=>{(r=this.states.error)?(this.cancelStateChange=()=>{o()},this.setErrorState(s)):o(),n()})()};(()=>{this.changeState(i),this.render()})(),this.request.send(t,e).then(a,h).catch(h)})}setErrorState(t){const e=this.states.error;e.error=t,this.page.changeState(e,{}),this.render()}removeState(t){return this.page.changeState(t,{toggle:"remove"})}changeState(t,e){return t.resolve(e).then(t=>this.page.changeState(t,e)).catch(t=>{throw this.setErrorState(t),t})}changePageState(t,e,s={}){const r=this.pages.get(t),i=this.states.get(e);return i.resolve(s).then(t=>{r.changeState(i),this.render()})}changeEntityState(t,e,s){var r;r="Style"===t?this.findStyle(e):this.findElement(e);var i=this.findState(s);r&&i&&r.setState(i),this.render()}triggerEvent(t,e,s){const{document:r}=Ss,i=new CustomEvent(t,{detail:e});i.srcEvent=s,r.body.dispatchEvent(i)}get root(){return this._root_el}set root(t){this.warn("setting root el",t),this._root_el=t}resolvers(){return this.log("resolvers",this.objects),this.objects.map(t=>t.initialize&&t.initialize()).filter(t=>!!t)}get page(){return this.pages[this.currentPageId]}async getCurrentTemplate(t){const e=this.page;return e?(await e.resolve(this.context),e.render(this.context)):Yr.h("div",{key:"temp-page"})}onReady(){this.run(),this.trigger("ready")}get fps(){return 1e3/120}setAnimationLoop(t){window.cancelAnimationFrame(this.rafid),t(this._animationFrame)}addTick(t){this.__globalTickers||(this.__globalTickers=[]),this.__globalTickers.push(t)}run(){const{window:t,TWEEN:e}=Ss;t.cancelAnimationFrame(this.rafid),this.fps;const{page:s,context:r,pages:i}=this,n=i.filter(t=>"block"==t.type),o=this.objects.filter(t=>"tick"in t),a=[s].concat(n,o),h=t=>{if(!s)return;e.update(t),r.time=t;for(const e of a)e.tick(t);const i=this.__globalTickers||[];for(const e of i)e(t)};this._animationFrame=h;const c=e=>{this.rafid=t.requestAnimationFrame(c),h(e)};this.rafid=t.requestAnimationFrame(c)}}const{window:qh,document:Wh}=Ss;qh.ResizeObserver=qh.ResizeObserver||class{constructor(t){this.observables=[],this.check=()=>{for(let e of this.observables){const s=e.el.clientHeight,r=e.el.clientWidth;e.height===s&&e.width===r||(t(e.el),e.height=s,e.width=r)}this.isPaused||(this.tid=setTimeout(this.check,500))},this.check()}observe(t){this.observables.push({el:t,height:t.clientHeight,width:t.clientWidth})}unobserve(){this.observables=[],clearTimeout(this.tid)}};const Vh=new WeakMap,Uh=new WeakMap;class Hh{constructor(t,e){this.canvas=t,this.worker=e}postMessage(t){this.worker.postMessage(t)}get width(){const t=window.devicePixelRatio||1;return this.canvas.width/t}get height(){const t=window.devicePixelRatio||1;return this.canvas.height/t}}const Bh=async function(t,e={}){var s=Vh.get(t);s||(s=t.transferControlToOffscreen(),Vh.set(t,s));const r=window.devicePixelRatio||1;var i=Uh.get(t);return i||(i=new Worker("/workers/offscreen.js"),Uh.set(t,i),i.postMessage({canvas:s,ratio:r},[s])),i.addEventListener("message",t=>{}),new Hh(t,i)},Xh=Symbol("tweens"),Gh=Symbol.for("host"),Yh="object";class Jh{constructor(t,e){Object.assign(this,t),this[Xh]={},this[Gh]=e,this.changed=!0}get host(){return this[Gh]}get transition(){return this.host.transition}isAnimated(t,e){return!this._transitionsDisabled&&void 0!==this[t]&&"number"==typeof e}disableTransitions(){this._transitionsDisabled=!0}enableTransitions(){this._transitionsDisabled=!1}set(t,e){if(this[t]===e)return!0;if(this.isAnimated(t,e))return this.setAnimated(t,e);if(typeof e!==Yh)this[t]=e,this.changed=!0;else{typeof this[t]!==Yh&&(this[t]=new Jh(e,this.host));for(let s in Object.keys(e))this[t].set(s,e[s])}}updateTweenProps(t,e){t.easing(e.ease||TWEEN.Easing.Linear.None),t.delay(1e3*e.delay),t.duration(1e3*e.duration)}createTween(t,e){var s=new TWEEN.Tween(e);return s._to={},s.to(s._to,1e3*t.duration),s.onUpdate(()=>{this.changed=name}),s.onComplete(()=>{}),s}getTween(t,e,s){this[Xh][t]||(this[Xh][t]=this.createTween(e,s));var r=this[Xh][t];return this.updateTweenProps(r,e),r}setAnimated(t,e,s,r){var i,n;s||(s=this),void 0===s[t]&&(s[t]=0),this.transition[t]?(n=this.transition[t],i=this.getTween(t,n,s)):this.transition.all&&(n=this.transition.all,i=this.getTween("all",n,s)),i?(i.stop(),i._to[t]=e,i.start()):s[t]=e}}function Kh(t,e,s,r,i){var n=function(e){var r=1-e;return 3*r*r*e*t+3*r*e*e*s+e*e*e},o=function(t){var s=1-t;return 3*s*s*t*e+3*s*t*t*r+t*t*t},a=function(e){var r=1-e;return 3*(2*(e-1)*e+r*r)*t+3*(-e*e*e+2*r*e)*s};return function(t){var e,s,r,h,c,l,u=t;for(r=u,l=0;l<8;l++){if(h=n(r)-u,Math.abs(h)<i)return o(r);if(c=a(r),Math.abs(c)<1e-6)break;r-=h/c}if(s=1,(r=u)<(e=0))return o(e);if(r>s)return o(s);for(;e<s;){if(h=n(r),Math.abs(h-u)<i)return o(r);u>h?e=r:s=r,r=.5*(s-e)+e}return o(r)}}const Qh=Symbol("transition");class Zh{constructor(){this.attrs=new Jh({},this),this.style=new Jh({},this)}setAttribute(t,e){this.attrs.set(t,e)}getAttribute(t){return this.attrs[t]}removeAttribute(t){delete this.attrs[t]}replaceChild(t){}removeChild(t){}insertBefore(t,e){}get parentNode(){}get childNodes(){return this.children}get properties(){return this._props}set properties(t){this._props=t}set transition(t){this[Qh]=t;const e={ease:TWEEN.Easing.Quadratic.InOut,"ease-in":TWEEN.Easing.Quadratic.In,"ease-out":TWEEN.Easing.Quadratic.Out,"ease-in-out":TWEEN.Easing.Cubic.InOut,linear:TWEEN.Easing.Linear.None,stepFunc:function(t){return function(e){return Math.floor(e*t)/t}}};for(let s of Object.keys(t)){let r=t[s];if("string"!=typeof r)if("object"==typeof r.easing){if(r.easing.bezier){let t=r.easing.bezier.args[0],e=1e3/60/(1e3*r.duration)/4;r.ease=Kh(...t,e)}else if(r.easing.func){let t=r.easing.func.args[0],e=TWEEN.Easing[t[0]]||TWEEN.Easing.Linear,s=e[t[1]]||e.None;r.ease=s}else if(r.easing.steps){let t=r.easing.steps.args[0];r.ease=e.stepFunc(t)}}else r.ease=e[r.easing]}}get transition(){return this[Qh]||{}}appendChild(t){this.children||(this.children=[]),this.children.push(t)}drawChildren(t){var e;if(this.children)for(e of this.children)e.draw(t)}drawPath(t){}drawFill(t){t.fill(this.path)}draw(t){t.fillStyle=this.style.fill,this.drawPath(),this._draw(t),this.changed=!1,this.drawChildren(t),this.attrs.changed=!1}_draw(t){(this.path||this.text)&&this.drawFill(t)}}const tc=function(t,e){return void 0===t?e:Math.abs(t)},ec={shape:Zh,rect:class extends Zh{constructor(){super()}drawPath(t){if(this.attrs.changed&&(this.path=null),this.path)return this.path;this.path=new Path2D;var e=this.attrs,s=(this.style,this.path),r=!1;e.rx&&(r=!0);var i=e.x,n=e.y,o=e.width||100,a=e.height||100;if(r){var h=tc(e.rx,0),c=tc(e.ry,h),l=c,u=h;s.moveTo(i+h,n),s.arcTo(i+o,n,i+o,n+a,c),s.arcTo(i+o,n+a,i,n+a,l),s.arcTo(i,n+a,i,n,u),s.arcTo(i,n,i+o,n,h)}else s.rect(i,n,o,a)}},root:Zh};var sc=[],rc=new WeakMap;const ic={createElement:function(t){var e=new(ec[t]||ec.shape)(t);return sc.push(e),e},createTextNode:function(){},getElements:function(t){var e=[];for(let s of sc)s.attrs.class===t&&e.push(s);return e}};var nc=class{constructor(t,e,s,r={}){const i=window.vdom;this.tree=t,i.canvas(t(s),{document:ic}),this.el=e,rc.set(e,this)}update(t){const e=window.vdom;var s=e.diff(this.tree,t);e.patch(this.root,s),this.tree=t}draw(t){this.ctxt||(this.ctxt=this.el.getContext("2d"),this.width=this.el.width,this.height=this.el.height),this.ctxt.clearRect(0,0,this.width,this.height)}tick(t){this.root&&this.draw(t)}};bh.register("canvas",class extends bh{constructor(t,e,s){super(t,e,[]),this.tree=s,this.emitter=Qr.getEmitter(this)}async getWorker(){return this.elem?await Bh(this.elem):new Promise((t,e)=>{this.emitter.bind("created",async()=>{const e=await Bh(this.elem);t(e)})})}updated(t,e){}attached(t){const{width:e,height:s}=t.getBoundingClientRect(),r=window.devicePixelRatio||1;t.width=e*r,t.height=s*r,this.view=new nc(this.tree,t,this.context,this.entity),this.emitter.trigger("created"),this.tick=t=>{this.view.tick(t)}}},"canvas");const{vdom:oc,TWEEN:ac}=Ss;var hc;async function cc({site:t}){if(hc)return hc;const e=await import("./workers/modules/webgl.js"),s=(hc=e.default).nodes;return Object.keys(s).forEach(e=>{t.registerNode("webgl",e,s[e])}),t.WEBGL_DOC=hc,hc}class lc{constructor(t,e,s,r){this.canvas=t,this.context=s,this.entity=r,this.template=e,this.initialize()}set template(t){const e=this.context.id+"_scene";this._template=gr("scene",{__scope:this.context,attributes:{class:"scene",id:e}},t)}get template(){return this._template}get site(){return this.entity.site}update(t,e){this.context=t,this.template=e,this.initialized&&this.patch()}tick(t){this.__tick&&this.__tick(t)}async initialize(){const t=await cc(this.entity),e=this.template;await Promise.all(bh.renderTree(e));let s=e.vnode,r=oc.create(s,{document:t});this.root=r;const i=this.context.$new("webgl",0),{renderer:n,canvas:o,scene:a,context:h,camera:c,tick:l}=t.createScene(r,this.canvas,i,this.entity);this.__tick=()=>{l(i)},this.patch=async()=>{const e=this.template;await Promise.all(bh.renderTree(e));const r=e.vnode,i=oc.diff(s,r);oc.patch(this.root,i,{document:t}),this.root.update({renderer:n,canvas:o,scene:a,context:h}),s=r},this.initialized=!0}}bh.register("webgl",class extends bh{constructor(t,e,s){super("canvas",e,[]),this.tree=s,this.emitter=Qr.getEmitter(this)}async getWorker(){return this.canvas?await Bh(this.canvas):new Promise((t,e)=>{this.emitter.bind("created",async()=>{const e=await Bh(this.canvas);t(e)})})}updated(t,e){this.view=e.comp&&e.comp.view,this.view.update(this.context,this.tree),this.tick=t=>{this.view.tick(t)}}attached(t){const{width:e,height:s}=t.getBoundingClientRect(),r=window.devicePixelRatio||1;t.width=e*r,t.height=s*r,this.canvas=t,this.view=new lc(t,this.tree,this.context,this.entity),this.emitter.trigger("created"),this.tick=t=>{this.view.tick(t)}}detached(...t){}},"webgl"),bh.register("harmony-stage",class extends bh{constructor(t,e,s){super("harmony-stage",e,s),this.tree=s,this.emitter=Qr.getEmitter(this)}updated(t,e){}attached(t){const{width:e,height:s}=t.getBoundingClientRect(),r=window.devicePixelRatio||1;t.width=e*r,t.height=s*r,this.canvas=t,this.emitter.trigger("created")}},"harmony");var uc=new Float32Array(16),dc=new Float32Array(16);class pc{static create(t,e,s){t=t||[0,0,-1],e=e||[0,0,0],s=s||[0,1,0];var r=new pc(quat.create(),vec3.create(),1);return r.lookAt(t,e,s),r}constructor(t,e,s){this.rotation=t,this.center=e,this.distance=s,this._vm=mat4.create()}view(t){return t||(t=this._vm),dc[0]=dc[1]=0,dc[2]=-this.distance,mat4.fromRotationTranslation(t,quat.conjugate(uc,this.rotation),dc),mat4.translate(t,t,vec3.negate(uc,this.center)),t}lookAt(t,e,s){mat4.lookAt(uc,t,e,s),mat3.fromMat4(uc,uc),quat.fromMat3(this.rotation,uc),vec3.copy(this.center,e),this.distance=vec3.distance(t,e)}pan(t){var e=this.distance;uc[0]=-e*(t[0]||0),uc[1]=e*(t[1]||0),uc[2]=e*(t[2]||0),vec3.transformQuat(uc,uc,this.rotation),vec3.add(this.center,this.center,uc)}zoom(t){this.distance+=t,this.distance<0&&(this.distance=0)}quatFromVec(t,e){var s=e[0],r=e[1],i=(e[2],s*s+r*r);i>1&&(i=1),t[0]=-e[0],t[1]=e[1],t[2]=e[2]||Math.sqrt(1-i),t[3]=0}rotate(t,e){this.quatFromVec(uc,t),this.quatFromVec(dc,e),quat.invert(dc,dc),quat.multiply(uc,uc,dc),quat.length(uc)<1e-6||(quat.multiply(this.rotation,this.rotation,uc),quat.normalize(this.rotation,this.rotation))}}bh.register("css-cube",class extends bh{constructor(t,e,s){super("div",e,s),this.name=t}},"css3d"),bh.register("css-plane",class extends bh{constructor(t,e,s,r){super("div",e,s,r),this.name=t}},"css3d");class fc{constructor(t){this.transforms={translate:{x:0,y:0,z:0,dx:0,dy:0,dz:0},rotate:{x:0,y:0,z:0,dx:0,dy:0,dz:0},scale:{x:1,y:1,z:1},origin:{x:0,y:0,z:0},zoom:100},this.node=t,this.camera=pc.create()}get node(){return this._node}set node(t){this._node=t,setTimeout(()=>{this.transforms.center={x:t.offsetWidth/2,y:t.offsetHeight/2},this.world=t.childNodes[0],this.camerael=this.world.childNodes[0],this.env=this.camerael.childNodes[0]})}getTransform(){var t=this.transforms.translate,e=this.transforms.rotate,s=this.transforms.scale,r=this.transforms.origin,i=(this.transforms.center,`${r.x}px ${r.y}px ${r.z}px`);return{transform:(new WebKitCSSMatrix).translate(t.dx,t.dy,t.dz||1e-4).rotate(e.dx,e.dy,e.dz).scale(s.x,s.y,s.z),"transform-origin":i}}applyTransform(t){Object.assign(this.transforms,t.transform);var e=this.getTransform();Object.assign(this.camerael.style,e)}tick(t,e,s){s.hasOwnProperty("mouse")||(s.mouse=Object.create(s.mouse,{}));var r=s.parent.mouse;let{x:i,y:n}=e.transform.scale;var o=s.bounds;s.mouse.x=(r.x-o.left-o.width/2)*(1-i||0),s.mouse.y=(r.y-o.top-o.height/2)*(1-n||0),s.mouse.dx=(r.dx-o.left-o.width/2)*(1-i||0),s.mouse.dy=(r.dy-o.top-o.height/2)*(1-n||0)}}bh.register("css-scene",class extends bh{constructor(t,e,s){var r=[h("div",{attributes:{class:"world"},style:{width:"100%",height:"100%",transformStyle:"preserve-3d"}},[h("div",{attributes:{class:"camera"},style:{width:"100%",height:"100%",transformStyle:"preserve-3d"}},[h("div",{attributes:{class:"env"},style:{width:"100%",height:"100%",transformStyle:"preserve-3d"}},s)])])];super("div",Object.assign(e,{}),r),this.name=t}transform(t){this.scene.applyTransform(t)}addTick(){var t=this.context,e=t.style;this.tick=s=>{this.scene.tick(s,e,t)}}created(t){}attached(t){this.scene=new fc(t,this.context),this.addTick()}updated(t,e){return this.scene=e.scene,this.scene.context=this.context,this.scene.node=t,this.addTick(),t}toJSON(){return{name:this.name,id:this.props.id,transform:this.scene.transforms}}},"css3d");const{h:gc}=Yr;bh.register("youtube",class extends bh{constructor(t,e,s){var r=()=>({class:"frame",width:"100%",height:"100%",src:(super.attributes||{}).src,frameborder:0,gesture:"media",allow:"encrypted-media",allowfullscreen:!0});super("div",e,function(t){return[gc("iframe",{attributes:r}),s]})}get attributes(){return{class:((super.attributes||{}).class||"youtube")+" video"}}attached(t){}},"custom");const{h:mc}=Yr;bh.register("vimeo",class extends bh{constructor(t,e,s){var r=()=>({class:"frame vimeoiframe",width:"100%",height:"100%",src:(super.attributes||{}).src,frameborder:0,gesture:"media",allow:"encrypted-media",allowfullscreen:!0});super("div",e,t=>[mc("iframe",{attributes:r}),s])}get attributes(){return{class:((super.attributes||{}).class||"youtube")+" video"}}attached(t){}},"custom");const{h:vc}=Yr;bh.register("instagram",class extends bh{constructor(t,e,s){super("div",e,function(t){return[vc("div",{attributes:{class:"feed"}}),s]})}get attributes(){return{class:((super.attributes||{}).class||"")+" instagram"}}attached(t){super.attributes}},"custom"),bh.register("leaflet",class extends bh{constructor(t,e,s){super("div",e,s)}get attributes(){return{class:((super.attributes||{}).class||"")+" leaflet"}}attached(t){this.elem=t,this.install()}install(){var t=document.getElementsByTagName("head")[0];this.createElement("link",{href:"https://unpkg.com/leaflet@1.2.0/dist/leaflet.css",rel:"stylesheet"},t),this.createElement("script",{src:"https://unpkg.com/leaflet@1.2.0/dist/leaflet.js",async:!0,defer:!0,crossorigin:!0},t).onload=()=>{this.renderMap()}}renderMap(){const t=super.attributes||{},{lat:e=37.41527,lng:s=-122.07764,zoom:r=11}=t;var i=this.createElement("div",{class:"leaflet-map",style:{width:"100%",height:"100%"}},this.elem);const n=L.map(i,{}).setView([e,s],r);return L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',subdomains:["a","b","c"]}).addTo(n),L.marker([e,s]).bindPopup('<a href="#" target="_blank">popup</a>').addTo(n),this.onResize(t=>{n.invalidateSize()},i),this.map=n,this.container=i,n}updated(t){this.renderMap()}destroy(){this.map&&(this.map.remove(),this.container.remove(),delete this.map)}},"custom");const{h:yc}=Yr;bh.register("googlemaps",class extends bh{constructor(t,e,s){super("div",e,function(t){return[yc("div",{attributes:{class:"google-map-ctr"},style:{width:"100%",height:"100%"}}),s]}),this.name=t,this.markers=[]}get attributes(){return{class:((super.attributes||{}).class||"")+" googlemaps"}}attached(t){this.install()}install(){const t=super.attributes||{};if(t.access_key){var e=`https://maps.googleapis.com/maps/api/js?key=${t.access_key}`;this.script=this.createElement("script",{src:e},document.getElementsByTagName("head")[0]),this.script.onload=()=>{this.renderMap()}}}renderMap(t=this.elem.querySelector(".google-map-ctr")){const e=super.attributes||{},{lat:s=37.41527,lng:r=-122.07764,zoom:i=11}=e,n={lat:+s,lng:+r};this.map||(this.map=new google.maps.Map(t,{zoom:+i,center:n}));const o=this.map;return o.setCenter(n),o.setZoom(i),this.markers.push(new google.maps.Marker({position:n,map:o})),this.onResize(t=>{google.maps.event.trigger(o,"resize"),o.setCenter(n)},t),o}updated(t,e){if(this.script=e.script,!this.script)return this.install();this.renderMap()}destroy(){if(this.map){for(let t of this.markers)t.setMap(null);this.markers.length=0}}},"custom");const{h:wc}=Yr;bh.register("mapbox",class extends bh{constructor(t,e,s){super("div",e,function(t){return[wc("div",{attributes:{class:"mapbox-map"},style:{width:"100%",height:"100%"}}),s]})}get attributes(){return{class:((super.attributes||{}).class||"")+" leaflet"}}attached(t){this.elem=t,this.install()}install(){var t=document.getElementsByTagName("head")[0];this.createElement("link",{href:"https://api.tiles.mapbox.com/mapbox-gl-js/v0.42.2/mapbox-gl.css",rel:"stylesheet"},t),this.createElement("script",{src:"https://api.tiles.mapbox.com/mapbox-gl-js/v0.42.2/mapbox-gl.js",async:!0,defer:!0,crossorigin:!0},t).onload=()=>{this.renderMap()}}renderMap(t=this.elem.querySelector(".mapbox-map")){const e=super.attributes||{},{lat:s=37.41527,lng:r=-122.07764,zoom:i=11,style_url:n="mapbox://styles/mapbox/streets-v9",access_key:o=""}=e;if(o){var a=[+r,+s];this.map||(mapboxgl.accessToken=String(o).trim(),this.map=new mapboxgl.Map({container:t,center:a,zoom:i,style:n}));var h=this.map;h.setCenter(a),h.setZoom(i),this.controls=[[new mapboxgl.NavigationControl,"top-left"],[new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0})],[new mapboxgl.ScaleControl({maxWidth:80,unit:"imperial"})],[new mapboxgl.FullscreenControl]];for(let t of this.controls)h.addControl(...t);var c=(new mapboxgl.Marker).setLngLat(a).addTo(h);return this.markers=[c],this.onResize(t=>{h.resize()},t),h}}updated(t,e){this.map=e.map,this.renderMap()}destroy(){if(this.map){for(let t of this.controls)this.map.removeControl(t[0]);for(let t of this.markers)t.remove()}}},"custom");const{h:bc}=Yr;bh.register("soundcloud",class extends bh{constructor(t,e,s){super("div",e,[bc("iframe",{attributes:()=>{var t=super.attributes||{};let{trackid:e="",hide_related:s=!1,auto_play:r=!1,show_comments:i=!0,show_user:n=!0,show_reposts:o=!1,show_teaser:a=!0,visual:h=!0}=t,c={hide_related:s,auto_play:r,show_comments:i,show_user:n,show_reposts:o,show_teaser:a,visual:h};var l=c.visual?300:166;return{src:`https://w.soundcloud.com/player/?url=https://api.soundcloud.com/tracks/${e}&${Object.keys(c).map(t=>`${t}=${c[t]}`).join("&")}`,height:l,class:"frame",width:"100%",frameborder:0,scrolling:"no"}}}),s])}get attributes(){return{class:((super.attributes||{}).class||"")+" soundcloud"}}},"custom");const{h:xc}=Yr;bh.register("twitter",class extends bh{constructor(t,e,s){super("div",e,[xc("a",{attributes:()=>{var t=super.attributes||{};let{feedid:e="TwitterDev",width:s="100%",height:r="100%",lang:i="",theme:n="",color:o=""}=t;return{href:`https://twitter.com/${String(e).trim()}?ref_src=twsrc%5Etfw`,width:s,height:r,class:"twitter-timeline","data-lang":i,"data-theme":n,"data-link-color":o}}},[xc("script",{attributes:{async:!0,src:"https://platform.twitter.com/widgets.js",charset:"utf-8"}})]),s])}get attributes(){return{class:((super.attributes||{}).class||"")+" twitterfeed"}}},"custom");const{h:Ec}=Yr;bh.register("pagination",class extends bh{constructor(t,e,s){super("div",e,t=>{this.context.current||(this.context.current=12);var e=this.context.current,r=function(t){var e,s=t-2,r=t+2+1,i=[],n=[];for(let t=1;t<=20;t++)(1==t||20==t||t>=s&&t<r)&&i.push(t);for(let t of i)e&&(t-e===2?n.push(e+1):t-e!==1&&n.push("...")),n.push(t),e=t;return n}(e).map(t=>"..."==t?Ec("span",{},[t]):Ec("a",{attributes:{href:"#",class:t==e?"selected":""},on:{click:s=>{s.preventDefault(),e!=t&&(this.context.current=t,this.render())}}},[t]));return[Ec("div",{attributes:{class:"pages-list"}},r),s]})}},"custom");class _c{constructor(t,e){this.items=["loading"],setTimeout(()=>{this.items=Array.from({length:501},(t,e)=>e+1),this.site.render()},1e3)}*[Symbol.iterator](){for(let t of this.items)yield t}}(class{static register(t,e,s={}){if(t in Va)throw new Error("An object definition by that name already exists.");Va[t]=function(t){return class extends ca{constructor(t,e){super(t,e)}initData(){if(qa[this.name]){const t=this[Fa]=qa[this.name];return void(t.refresh&&"function"==typeof t.refresh&&t.refresh(this.settings,this))}try{this[Fa]=new t(this.settings,this)}catch(t){this.error=t}qa[this.name]=this[Fa]}initialize(){if(this[Fa]&&this[Fa].initialize)return this[Fa].initialize()}define(t){Object.keys(t).forEach(e=>{const s=t[e];"function"==typeof s&&Object.defineProperty(this,e,{configurable:!0,value:s}),s&&("get"in s||"set"in s)&&Object.defineProperty(this,e,Object.assign({configurable:!0},s))})}}}(e),Wa[t]=s}static all(){return Wa}}).register("rest",_c,{props:{endpoint:{type:"url",default:""},auth:{type:"boolean",default:!0}},methods:{filter:{params:{type:"expression"}},accessor:{path:{type:"string"}}}});const kc="wordpress",{h:Sc}=Yr;class Oc extends bh{}Oc.register("wp-collection",class extends Oc{constructor(t,e,s){const r=t=>Sc("span",{attributes:{class:"wp error"}},t);super("div",e,t=>{const i=e.config&&e.config(t)||{},n=i.collection,o=i.source&&i.source.uid;if(!o||!n)return[r("A source and collection must be provided")];const a=o&&t.site.objects.get(o);if(!a)return[r(`No resource by the name '${n}'`)];if("loading"==a.status)return[Sc("span",{attributes:{class:"wp loading"}},"loading")];const h=a&&a[n];return h?(t.collection={resource:a,items:h,name:n},s(t)):[r("Resource could not be loaded")]})}},{ns:kc}),Oc.register("wp-list",class extends Oc{constructor(t,e,s,r={}){super("div",e,t=>{const i=Object.assign({},r,e.config&&e.config(t)),{collection:n}=t;if(!n)return[Sc("span",{attributes:{class:"error"}},["the list tag must be a child of a collection tag"])];const o=void 0===i.nested||i.nested,a=(n.name,t=>{const e=t.item;return o&&e.children&&e.children.length?[s(t),c(e.children)]:s(t)}),h=t=>e=>[Sc("repeat",{__scope:e,_h:(e,s)=>({logic:new lo(null,e,{expr:t,as:"item"})})},t=>o?[Sc("li",{},a)]:a(t))],c=e=>o?[Sc("ul",{},h(e))]:h(e)(t);return c(n.items)})}},{ns:kc});class Tc extends Oc{constructor(t,e,s,r={}){super("div",e,i=>{var n=Object.assign({},r,e.config&&e.config(i)),{html:o,name:a}=n;if(!a)return["Attribute name must be provided"];if(!i.item)return[`${t} must be used in the context of a wordpress collection`];const h=i.item[a];return o?[s,Sc("content",{},[h])]:[s,h]})}}Oc.register("wp-attr",Tc,{ns:kc}),Oc.register("wp-title",Tc,{ns:kc,name:"title",html:!0}),Oc.register("wp-name",Tc,{ns:kc,name:"name"}),Oc.register("wp-content",Tc,{ns:kc,html:!0,name:"content"}),Oc.register("wp-excerpt",Tc,{ns:kc,html:!0,name:"excerpt"}),Oc.register("wp-date",Tc,{ns:kc,name:"date"}),Oc.register("wp-category-list",class extends Oc{constructor(t,e,s){super("div",e,t=>[Sc("repeat",{__scope:t,_h:(t,e)=>(t.items=t.item.categories||[],{logic:new lo(null,t,{expr:t.items,as:"item"})})},t=>{var e=s(t);return!e&&e.length?[Sc("a",{attributes:{href:`/${t.item.slug}`}},[t.item.title])]:e})])}},{ns:kc,nested:!1}),Oc.register("wp-permalink",class extends Oc{constructor(t,e,s){super("a",e,s)}get attributes(){var t=super.attributes||{};return Object.assign({href:this.context.item.permalink},t)}},{ns:kc}),Oc.register("wp-image",class extends Oc{constructor(t,e,s){super("img",e)}get attributes(){const t=super.attributes||{},e=(this.context.item||{}).image||{};var{url:s,details:r={}}=e;if(!s)return t;var i,n=s,o=e.title;return r.sizes&&(i=["full","large","medium_large","medium"].map(t=>{let e=r.sizes[t];return e?`${e.source_url} ${e.width}w`:""}).filter(t=>!!t).join(" ")),Object.assign({src:n,srcset:i,sizes:"100w",alt:o},t)}},{ns:kc});const Cc=new class{constructor(t={}){Object.keys(t).forEach(e=>{globals.set(e,t[e])})}async initialize(t,e,s){if(!t.site){var r=await import("./scripts/site.js");t.site=r.default}var i=t.site;if(i){if(Array.isArray(i.pages)){var n=i.pages.reduce((t,e)=>(t[e.id]=e,t),{});i.pages=n}var o=new Fh(i,e,this);o.logger=s,Object.defineProperty(this,"site",{get:function(){return o}}),await o.render({clean:!0})}}importModules(t){return Promise.all(t.map(importModule))}};Cc.initialize(window.siteconf||{},document.getElementById("root"))}();